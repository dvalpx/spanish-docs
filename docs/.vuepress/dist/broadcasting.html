<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Broadcasting | Documentación de Laravel en Español</title>
    <meta name="description" content="Documentación de Laravel en Español">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Catamaran:300,700|Miriam+Libre">
    
    <link rel="preload" href="/assets/css/0.styles.172acefb.css" as="style"><link rel="preload" href="/assets/js/app.670d7e7c.js" as="script"><link rel="preload" href="/assets/js/15.8a736f30.js" as="script"><link rel="prefetch" href="/assets/js/10.890657ad.js"><link rel="prefetch" href="/assets/js/11.886ca6a1.js"><link rel="prefetch" href="/assets/js/12.0d2fa60e.js"><link rel="prefetch" href="/assets/js/13.9645d1cc.js"><link rel="prefetch" href="/assets/js/14.b601f515.js"><link rel="prefetch" href="/assets/js/16.4ecd6c92.js"><link rel="prefetch" href="/assets/js/17.0f287924.js"><link rel="prefetch" href="/assets/js/18.a3ca4e9a.js"><link rel="prefetch" href="/assets/js/19.e237c464.js"><link rel="prefetch" href="/assets/js/2.e950dd9a.js"><link rel="prefetch" href="/assets/js/20.6c81b2f5.js"><link rel="prefetch" href="/assets/js/21.ab56b213.js"><link rel="prefetch" href="/assets/js/22.5db63cfd.js"><link rel="prefetch" href="/assets/js/23.6d6d19fa.js"><link rel="prefetch" href="/assets/js/24.771ff8be.js"><link rel="prefetch" href="/assets/js/25.61bfdf54.js"><link rel="prefetch" href="/assets/js/26.049ed12f.js"><link rel="prefetch" href="/assets/js/27.d2927876.js"><link rel="prefetch" href="/assets/js/28.ea6eee97.js"><link rel="prefetch" href="/assets/js/29.1b8672f3.js"><link rel="prefetch" href="/assets/js/3.d15edf81.js"><link rel="prefetch" href="/assets/js/30.378a4977.js"><link rel="prefetch" href="/assets/js/31.8e5176cc.js"><link rel="prefetch" href="/assets/js/32.8fdeb297.js"><link rel="prefetch" href="/assets/js/33.b615bcb8.js"><link rel="prefetch" href="/assets/js/34.3b36c043.js"><link rel="prefetch" href="/assets/js/35.ef8dd300.js"><link rel="prefetch" href="/assets/js/36.4e90af03.js"><link rel="prefetch" href="/assets/js/37.6131dd1b.js"><link rel="prefetch" href="/assets/js/38.b4345420.js"><link rel="prefetch" href="/assets/js/39.c4e3c17b.js"><link rel="prefetch" href="/assets/js/4.333c2311.js"><link rel="prefetch" href="/assets/js/40.f780e123.js"><link rel="prefetch" href="/assets/js/41.4a1a10ae.js"><link rel="prefetch" href="/assets/js/42.8969bd07.js"><link rel="prefetch" href="/assets/js/43.557e2bb4.js"><link rel="prefetch" href="/assets/js/44.5151c083.js"><link rel="prefetch" href="/assets/js/45.e944dba1.js"><link rel="prefetch" href="/assets/js/46.9a35689c.js"><link rel="prefetch" href="/assets/js/47.228f7fa9.js"><link rel="prefetch" href="/assets/js/48.47aaf80a.js"><link rel="prefetch" href="/assets/js/49.94e9af6a.js"><link rel="prefetch" href="/assets/js/5.dfd255c8.js"><link rel="prefetch" href="/assets/js/50.62d3bcc7.js"><link rel="prefetch" href="/assets/js/51.44dc5c59.js"><link rel="prefetch" href="/assets/js/52.259aa4a1.js"><link rel="prefetch" href="/assets/js/53.5f5cc6de.js"><link rel="prefetch" href="/assets/js/54.aecf28b6.js"><link rel="prefetch" href="/assets/js/55.9eb54728.js"><link rel="prefetch" href="/assets/js/56.59d4faa4.js"><link rel="prefetch" href="/assets/js/57.b8edd47a.js"><link rel="prefetch" href="/assets/js/58.0b43b12f.js"><link rel="prefetch" href="/assets/js/59.9a35b2b7.js"><link rel="prefetch" href="/assets/js/6.08b745f4.js"><link rel="prefetch" href="/assets/js/60.7d49176e.js"><link rel="prefetch" href="/assets/js/61.147bff06.js"><link rel="prefetch" href="/assets/js/62.3440b436.js"><link rel="prefetch" href="/assets/js/63.02a68d7e.js"><link rel="prefetch" href="/assets/js/64.039a514c.js"><link rel="prefetch" href="/assets/js/65.b4001712.js"><link rel="prefetch" href="/assets/js/66.18b0a11f.js"><link rel="prefetch" href="/assets/js/67.f84e9d1d.js"><link rel="prefetch" href="/assets/js/68.3d907f1f.js"><link rel="prefetch" href="/assets/js/69.503b03bf.js"><link rel="prefetch" href="/assets/js/7.4f2afe0c.js"><link rel="prefetch" href="/assets/js/70.3fb14c22.js"><link rel="prefetch" href="/assets/js/71.2a8bb910.js"><link rel="prefetch" href="/assets/js/72.325984f7.js"><link rel="prefetch" href="/assets/js/73.1b173d90.js"><link rel="prefetch" href="/assets/js/74.6ab9d1bd.js"><link rel="prefetch" href="/assets/js/75.81c87089.js"><link rel="prefetch" href="/assets/js/76.4c6ad92e.js"><link rel="prefetch" href="/assets/js/77.ca20fa7b.js"><link rel="prefetch" href="/assets/js/78.cb6a269d.js"><link rel="prefetch" href="/assets/js/79.529c080d.js"><link rel="prefetch" href="/assets/js/8.23b9f04b.js"><link rel="prefetch" href="/assets/js/80.1001e373.js"><link rel="prefetch" href="/assets/js/81.98ee983b.js"><link rel="prefetch" href="/assets/js/9.288ef444.js">
    <link rel="stylesheet" href="/assets/css/0.styles.172acefb.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Documentación de Laravel en Español</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Inicio</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Inicio</a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading"><span>Primeros Pasos</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Conceptos De Arquitectura</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Fundamentos</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Frontend</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Seguridad</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>Profundizando</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/artisan.html" class="sidebar-link">Consola Artisan</a></li><li><a href="/broadcasting.html" class="active sidebar-link">Broadcasting</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/broadcasting.html#introduccion" class="sidebar-link">Introducción</a></li><li class="sidebar-sub-header"><a href="/broadcasting.html#descripcion-general" class="sidebar-link">Descripción General</a></li><li class="sidebar-sub-header"><a href="/broadcasting.html#definiendo-la-transmision-de-eventos" class="sidebar-link">Definiendo La Transmisión De Eventos</a></li><li class="sidebar-sub-header"><a href="/broadcasting.html#autorizando-canales-2" class="sidebar-link">Autorizando Canales</a></li><li class="sidebar-sub-header"><a href="/broadcasting.html#transmitiendo-eventos" class="sidebar-link">Transmitiendo Eventos</a></li><li class="sidebar-sub-header"><a href="/broadcasting.html#recibiendo-transmisiones" class="sidebar-link">Recibiendo Transmisiones</a></li><li class="sidebar-sub-header"><a href="/broadcasting.html#canales-de-presencia" class="sidebar-link">Canales De Presencia</a></li><li class="sidebar-sub-header"><a href="/broadcasting.html#eventos-del-cliente" class="sidebar-link">Eventos Del Cliente</a></li><li class="sidebar-sub-header"><a href="/broadcasting.html#notificaciones" class="sidebar-link">Notificaciones</a></li></ul></li><li><a href="/cache.html" class="sidebar-link">Caché</a></li><li><a href="/collections.html" class="sidebar-link">Collecciones</a></li><li><a href="/events.html" class="sidebar-link">Eventos</a></li><li><a href="/filesystem.html" class="sidebar-link">Almacenamiento De Archivos</a></li><li><a href="/helpers.html" class="sidebar-link">Helpers</a></li><li><a href="/mail.html" class="sidebar-link">Correos Electrónicos</a></li><li><a href="/notifications.html" class="sidebar-link">Notificaciones</a></li><li><a href="/packages.html" class="sidebar-link">Desarrollo de Paquetes</a></li><li><a href="/queues.html" class="sidebar-link">Colas De Trabajo</a></li><li><a href="/scheduling.html" class="sidebar-link">Programación de tareas</a></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Bases De Datos</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>ORM Eloquent</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Pruebas</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Paquetes oficiales</span> <span class="arrow right"></span></p> <!----></div></li></ul> </div> <div class="page"> <div class="content"><div><h1 id="broadcasting"><a class="header-anchor" href="#broadcasting" aria-hidden="true">#</a> Broadcasting</h1> <ul><li><a href="#introduction">Introducción</a> <ul><li><a href="#configuration">Configuración</a></li> <li><a href="#driver-prerequisites">Prerrequisitos Del Driver</a></li></ul></li> <li><a href="#concept-overview">Descripción General</a> <ul><li><a href="#using-example-application">Usando Una Aplicación De Ejemplo</a></li></ul></li> <li><a href="#defining-broadcast-events">Definiendo Eventos De Transmisión</a> <ul><li><a href="#broadcast-name">Nombre De La Transmisión</a></li> <li><a href="#broadcast-data">Datos De La Transmisión</a></li> <li><a href="#broadcast-queue">Cola De La Transmisión</a></li> <li><a href="#broadcast-conditions">Condiciones De La Transmisión</a></li></ul></li> <li><a href="#authorizing-channels">Autorizando Canales</a> <ul><li><a href="#defining-authorization-routes">Definiendo Rutas De Autorización</a></li> <li><a href="#defining-authorization-callbacks">Definiendo Callbacks de Autorización</a></li> <li><a href="#defining-channel-classes">Definiendo Clases De Canales</a></li></ul></li> <li><a href="#broadcasting-events">Transmitiendo Eventos</a> <ul><li><a href="#only-to-others">Sólo A Otros</a></li></ul></li> <li><a href="#receiving-broadcasts">Recibiendo Transmisiones</a> <ul><li><a href="#installing-laravel-echo">Instalando Laravel Echo</a></li> <li><a href="#listening-for-events">Escuchando Eventos</a></li> <li><a href="#leaving-a-channel">Dejando Un Canal</a></li> <li><a href="#namespaces">Nombres De Espacio</a></li></ul></li> <li><a href="#presence-channels">Canales De Presencia</a> <ul><li><a href="#authorizing-presence-channels">Autorizando Canales De Presencia</a></li> <li><a href="#joining-presence-channels">Uniéndose A Canales De Presencia</a></li> <li><a href="#broadcasting-to-presence-channels">Transmitiendo A Canales De Presencia</a></li></ul></li> <li><a href="#client-events">Eventos Del Cliente</a></li> <li><a href="#notifications">Notificaciones</a></li></ul> <p><a name="introduction"></a></p> <h2 id="introduccion"><a class="header-anchor" href="#introduccion" aria-hidden="true">#</a> Introducción</h2> <p>En muchas aplicaciones web modernas, los WebSockets son usados para implementar interfaces de usuarios actualizadas en tiempo real. Cuando algún dato es actualizado en el servidor, un mensaje es típicamente enviado a través de una conexión WebSocket para ser manejado por el cliente. Esto proporciona una alternativa más robusta y eficiente para monitorear continuamente tu aplicación en busca de cambios.</p> <p>Para asistirte en la construcción de ese tipo de aplicaciones, Laravel hace fácil &quot;emitir&quot; tus <a href="/docs/%7B%7Bversion%7D%7D/events">eventos</a> a través de una conexión WebSocket. Emitir tus eventos te permite compartir los mismos nombres de eventos entre tu código del lado del servidor y tu aplicación JavaScript del lado de cliente.</p> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>Antes de sumergirnos en la emisión de eventos, asegurate de haber leído toda la documentación de Laravel sobre <a href="/docs/%7B%7Bversion%7D%7D/events">eventos y listeners</a>.</p></div></div> <p><a name="configuration"></a></p> <h3 id="configuracion"><a href="#configuracion" aria-hidden="true" class="header-anchor">#</a> Configuración</h3> <p>Toda la configuración de transmisión de eventos de tu aplicación está almacenada en el archivo de configuración <code>config/broadcasting.php</code>. Laravel soporta múltiples drivers de transmisión: <a href="https://pusher.com" target="_blank" rel="noopener noreferrer">Pusher<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, <a href="/docs/%7B%7Bversion%7D%7D/redis">Redis</a> y un driver <code>log</code> para desarrollo local y depuración. Adicionalmente, un driver <code>null</code> es incluido, que te permite deshabilitar totalmente las emisiones. Un ejemplo de configuración para cada uno de los drivers está incluido en el archivo de configuración <code>config/broadcasting.php</code>.</p> <h4 id="proveedor-de-servicios-broadcast"><a href="#proveedor-de-servicios-broadcast" aria-hidden="true" class="header-anchor">#</a> Proveedor De Servicios Broadcast</h4> <p>Antes de transmitir cualquier evento, necesitarás primero registrar <code>App\Providers\BroadcastServiceProvider</code>. En aplicaciones de Laravel nuevas, sólo necesitas descomentar este proveedor en el arreglo <code>providers</code> de tu archivo de configuración <code>config/app.php</code>. Este proveedor te permitirá registrar las rutas de autorización del broadcast y los callbacks.</p> <h4 id="token-csrf"><a href="#token-csrf" aria-hidden="true" class="header-anchor">#</a> Token CSRF</h4> <p><a href="#installing-laravel-echo">Laravel Echo</a> necesitará acceso al token CSRF de la sesión actual. Debes verificar que el elemento HTML <code>head</code> de tu aplicación define una etiqueta <code>meta</code> que contiene el token CSRF:</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>csrf-token<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{{ csrf_token() }}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><a name="driver-prerequisites"></a></p> <h3 id="prerrequisitos-del-driver"><a href="#prerrequisitos-del-driver" aria-hidden="true" class="header-anchor">#</a> Prerrequisitos Del Driver</h3> <h4 id="pusher"><a href="#pusher" aria-hidden="true" class="header-anchor">#</a> Pusher</h4> <p>Si estás transmitiendo tus eventos mediante <a href="https://pusher.com" target="_blank" rel="noopener noreferrer">Pusher<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, debes instalar el SDK de PHP de Pusher mediante el administrador de paquetes Composer:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>composer require pusher/pusher-php-server <span class="token string">&quot;~3.0&quot;</span>
</code></pre></div><p>Luego, debes configurar tus credenciales de Pusher en el archivo de configuración <code>config/broadcasting.php</code>. Un ejemplo de configuración de Pusher está incluido en este archivo, permitiéndote especificar rápidamente tu clave de Pusher, contraseña y ID de la aplicación. La configuración de <code>pusher</code> del archivo <code>config/broadcasting.php</code> también te permite especificar <code>options</code> adicionales que son soportadas por Pusher, como el cluster:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token single-quoted-string string">'options'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
    <span class="token single-quoted-string string">'cluster'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'eu'</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'encrypted'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token boolean">true</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre></div><p>Al usar Pusher y <a href="#installing-laravel-echo">Laravel Echo</a>, debes especificar <code>pusher</code> como tu transmisor deseado al instanciar la instancia de Echo en tu archivo <code>resources/js/bootstrap.js</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code>import <span class="token keyword">Echo</span> from <span class="token double-quoted-string string">&quot;laravel-echo&quot;</span><span class="token punctuation">;</span>

window<span class="token punctuation">.</span>Pusher <span class="token operator">=</span> <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'pusher-js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

window<span class="token punctuation">.</span><span class="token keyword">Echo</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Echo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    broadcaster<span class="token punctuation">:</span> <span class="token single-quoted-string string">'pusher'</span><span class="token punctuation">,</span>
    key<span class="token punctuation">:</span> <span class="token single-quoted-string string">'your-pusher-key'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="redis"><a href="#redis" aria-hidden="true" class="header-anchor">#</a> Redis</h4> <p>Si estás usando el transmisor de Redis, debes instalar la librería Predis:</p> <div class="language-php extra-class"><pre class="language-php"><code>composer <span class="token keyword">require</span> predis<span class="token operator">/</span>predis
</code></pre></div><p>El transmisor de Redis transmitirá mensajes usando las característica pub / sub de Redis; sin embargo, necesitarás unir esto con un servidor de WebSocket que puede recibir mensajes desde Redis y emitirlos a tus canales de WebSocket.</p> <p>Cuando el transmisor de Redis publica un evento, éste será publicado en los nombres de canales especificados en el evento y la carga será una cadena codificada de JSON que contiene el nombre del evento, una carga <code>data</code> y el usuario que genero el ID de socket del evento (si aplica).</p> <h4 id="socket-io"><a href="#socket-io" aria-hidden="true" class="header-anchor">#</a> Socket.IO</h4> <p>Si vas a unir el transmisor de Redis con un servidor Socket.IO, necesitarás incluir la librería de Socket.IO en tu aplicación. Puedes instalarla mediante el gestor de paquetes NPM:</p> <div class="language-php extra-class"><pre class="language-php"><code>npm install <span class="token operator">--</span>save socket<span class="token punctuation">.</span>io<span class="token operator">-</span>client
</code></pre></div><p>Luego, necesitarás instanciar Echo con el conector <code>socket.io</code> y un <code>host</code>.</p> <div class="language-php extra-class"><pre class="language-php"><code>import <span class="token keyword">Echo</span> from <span class="token double-quoted-string string">&quot;laravel-echo&quot;</span>

window<span class="token punctuation">.</span>io <span class="token operator">=</span> <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'socket.io-client'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

window<span class="token punctuation">.</span><span class="token keyword">Echo</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Echo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    broadcaster<span class="token punctuation">:</span> <span class="token single-quoted-string string">'socket.io'</span><span class="token punctuation">,</span>
    host<span class="token punctuation">:</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>hostname <span class="token operator">+</span> <span class="token single-quoted-string string">':6001'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Finalmente, necesitarás ejecutar un servidor de Socket.IO compatible. Laravel no incluye la implementación de un servidor Socket.IO; sin embargo, un servidor de Socket.IO de la comunidad es actualmente mantenido en el repositorio de GitHub <a href="https://github.com/tlaverdure/laravel-echo-server" target="_blank" rel="noopener noreferrer">tlaverdure/laravel-echo-server<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <h4 id="prerrequisitos-de-la-cola"><a href="#prerrequisitos-de-la-cola" aria-hidden="true" class="header-anchor">#</a> Prerrequisitos De La Cola</h4> <p>Antes de transmitir eventos, también necesitarás configurar y ejecutar un <a href="/docs/%7B%7Bversion%7D%7D/queues">listener de colas</a>. Toda la transmisión de eventos es realizada mediante trabajos en cola para que el tiempo de respuesta de tu aplicación no se vea necesariamente afectado.</p> <p><a name="concept-overview"></a></p> <h2 id="descripcion-general"><a href="#descripcion-general" aria-hidden="true" class="header-anchor">#</a> Descripción General</h2> <p>La transmisión de eventos de Laravel te permite transmitir tus eventos del lado del servidor de Laravel a tu aplicación JavaScript del lado del cliente usando un enfoque basado en drivers a los WebSockets. Actualmente, Laravel viene con drivers de <a href="https://pusher.com" target="_blank" rel="noopener noreferrer">Pusher<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> y Redis. Los eventos pueden ser fácilmente consumidos en el lado del cliente usando el paquete de JavaScript <a href="#installing-laravel-echo">Laravel Echo</a>.</p> <p>Los eventos son transmitidos mediante &quot;canales&quot;, que pueden ser definidos como públicos o privados. Cualquier visitante en tu aplicación puede suscribirse a una canal público sin necesidad de autenticación o autorización; sin embargo, para poder suscribirse a canales privados, un usuario debe estar autenticado y autorizado para escuchar en dicho canal.</p> <p><a name="using-example-application"></a></p> <h3 id="usando-una-aplicacion-de-ejemplo"><a href="#usando-una-aplicacion-de-ejemplo" aria-hidden="true" class="header-anchor">#</a> Usando Una Aplicación De Ejemplo</h3> <p>Antes de sumergirnos en cada componente de la transmisión de eventos, vamos a ver un resumen usando una tienda virtual como ejemplo. No discutiremos los detalles sobre configurar <a href="https://pusher.com" target="_blank" rel="noopener noreferrer">Pusher<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> o <a href="#installing-laravel-echo">Laravel Echo</a> dado que éstos será discutido a detalle en otras secciones de esta documentación.</p> <p>En nuestra aplicación, vamos a asumir que tenemos una página que permite a los usuarios ver el estado de envío de sus ordenes. Vamos también a asumir que un evento <code>ShippingStatusUpdated</code> es ejecutado cuando un estado de envío es procesado por la aplicación:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token function">event</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ShippingStatusUpdated</span><span class="token punctuation">(</span><span class="token variable">$update</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="interfaz-shouldbroadcast"><a href="#interfaz-shouldbroadcast" aria-hidden="true" class="header-anchor">#</a> Interfaz <code>ShouldBroadcast</code></h4> <p>Cuando un usuario está viendo una de sus ordenes, no que queremos que tengan que refrescar la página para ver las actualizaciones del estado. En su lugar, queremos transmitir las actualizaciones a la aplicación a medida que son creadas. Así que, necesitamos marcar el evento <code>ShippingStatusUpdated</code> con la interfaz <code>ShouldBroadcast</code>. Esto instruirá a Laravel para que transmita el evento cuando es ejecutado:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Events</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Broadcasting<span class="token punctuation">\</span>Channel</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Queue<span class="token punctuation">\</span>SerializesModels</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Broadcasting<span class="token punctuation">\</span>PrivateChannel</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Broadcasting<span class="token punctuation">\</span>PresenceChannel</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Broadcasting<span class="token punctuation">\</span>InteractsWithSockets</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Contracts<span class="token punctuation">\</span>Broadcasting<span class="token punctuation">\</span>ShouldBroadcast</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">ShippingStatusUpdated</span> <span class="token keyword">implements</span> <span class="token class-name">ShouldBroadcast</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * Information about the shipping status update.
    *
    * @var string
    */</span>
    <span class="token keyword">public</span> <span class="token variable">$update</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p>La interfaz <code>ShouldBroadcast</code> requiere que nuestro evento defina un método <code>broadcastOn</code>. Este método es responsable de retornar los canales en los que el evento debería transmitir. Un stub vacío para este metodo está definido en las clases de eventos generadas, así que sólo necesitamos rellenar sus detalles. Sólo queremos que el creador de la orden sea capaz de ver las actualizaciones de estado, así que transmitiremos el evento en un canal privado que está enlazado a la orden:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">/**
* Get the channels the event should broadcast on.
*
* @return \Illuminate\Broadcasting\PrivateChannel
*/</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">broadcastOn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">PrivateChannel</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'order.'</span><span class="token punctuation">.</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">update</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">order_id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="autorizando-canales"><a href="#autorizando-canales" aria-hidden="true" class="header-anchor">#</a> Autorizando Canales</h4> <p>Recuerda, los usuarios deben ser autorizados para escuchar en canales privados. Podemos definir las reglas de autorización de nuestro canal en el archivo <code>routes/channels.php</code>. En este ejemplo, necesitamos verificar que cualquier usuario intentando escuchar en el canal privado <code>order.1</code> es realmente el creador de la orden:</p> <div class="language-php extra-class"><pre class="language-php"><code>Broadcast<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'order.{orderId}'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">,</span> <span class="token variable">$orderId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">id</span> <span class="token operator">===</span> Order<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">findOrNew</span><span class="token punctuation">(</span><span class="token variable">$orderId</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">user_id</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>El método <code>channel</code> acepta dos argumentos: el nombre del canal y un callback que retorna <code>true</code> o <code>false</code> indicando si el usuario está autorizado para escuchar en el canal.</p> <p>Todos los callbacks de autorización recibien al usuario actualmente autenticado como primer argumento y cualquier paremetro adicional como siguientes argumentos. En este ejemplo, estamos usando el placeholder <code>{orderId}</code> para indicar que la porción &quot;ID&quot; del nombre del canal es un wildcard.</p> <h4 id="escuchar-transmisiones-de-eventos"><a href="#escuchar-transmisiones-de-eventos" aria-hidden="true" class="header-anchor">#</a> Escuchar Transmisiones De Eventos</h4> <p>Luego, todo lo que queda es escuchar el evento en nuestra aplicación de JavaScript. Podemos hacer esto usando Laravel Echo. Primero, usaremos el método <code>private</code> para suscribirnos a un canal privado. Luego, podemos usar el método <code>listen</code> para escuchar el evento <code>ShippingStatusUpdated</code>. Por defecto, todas las propiedades públicas del evento serán incluidas en el evento de transmisión:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">Echo</span><span class="token punctuation">.</span><span class="token keyword">private</span><span class="token punctuation">(</span>`order<span class="token punctuation">.</span><span class="token variable">$</span><span class="token punctuation">{</span>orderId<span class="token punctuation">}</span>`<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'ShippingStatusUpdated'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>update<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><a name="defining-broadcast-events"></a></p> <h2 id="definiendo-la-transmision-de-eventos"><a href="#definiendo-la-transmision-de-eventos" aria-hidden="true" class="header-anchor">#</a> Definiendo La Transmisión De Eventos</h2> <p>Para informar a Laravel que un evento dado debería ser transmitido, implementa la interfaz <code>Illuminate\Contracts\Broadcasting\ShouldBroadcast</code> en la clase del evento. Esta interfaz ya está importada en todas las clases de eventos generadas por el framework para que así puedas agregarla fácilmente a tus eventos.</p> <p>La interfaz <code>ShouldBroadcast</code> requiere que implementes un sólo método: <code>broadcastOn</code>. El método <code>broadcastOn</code> debería retornar un canal o un arreglo de canales en los que el evento debería transmitirse. Los canales deben ser instancias de <code>Channel</code>, <code>PrivateChannel</code> o <code>PresenceChannel</code>. Las instancias de <code>Channel</code> representan canales públicos a los que cualquier usuario puede suscribirse mientras que <code>PrivateChannels</code> y <code>PresenceChannels</code> representan canales privados que requieren <a href="#authorizing-channels">autorización</a>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Events</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Broadcasting<span class="token punctuation">\</span>Channel</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Queue<span class="token punctuation">\</span>SerializesModels</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Broadcasting<span class="token punctuation">\</span>PrivateChannel</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Broadcasting<span class="token punctuation">\</span>PresenceChannel</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Broadcasting<span class="token punctuation">\</span>InteractsWithSockets</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Contracts<span class="token punctuation">\</span>Broadcasting<span class="token punctuation">\</span>ShouldBroadcast</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">ServerCreated</span> <span class="token keyword">implements</span> <span class="token class-name">ShouldBroadcast</span>
<span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token package">SerializesModels</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token variable">$user</span><span class="token punctuation">;</span>

    <span class="token comment">/**
    * Create a new event instance.
    *
    * @return void
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span>User <span class="token variable">$user</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">user</span> <span class="token operator">=</span> <span class="token variable">$user</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
    * Get the channels the event should broadcast on.
    *
    * @return Channel|array
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">broadcastOn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">PrivateChannel</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'user.'</span><span class="token punctuation">.</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p>Luego, sólo necesitas <a href="/docs/%7B%7Bversion%7D%7D/events">ejecutar el evento</a> como normalmente lo harías. Una vez que el evento ha sido ejecutado, <a href="/docs/%7B%7Bversion%7D%7D/queues">un trabajo en cola</a> transmitirá automáticamente el evento a través de tu driver de transmisión especificado.</p> <p><a name="broadcast-name"></a></p> <h3 id="nombre-de-la-transmision"><a href="#nombre-de-la-transmision" aria-hidden="true" class="header-anchor">#</a> Nombre De La Transmisión</h3> <p>Por defecto, Laravel transmitirá el evento usando el nombre de clase del evento. Sin embargo, puedes personalizar el nombre de la transmisión definiendo un método <code>broadcastAs</code> en el evento:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">/**
* The event's broadcast name.
*
* @return string
*/</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">broadcastAs</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token single-quoted-string string">'server.created'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Si personalizas el nombre de la transmisión usando el método <code>broadcastAs</code>, debes asegurarte de registrar tu listener prefijándolo con un caracter <code>.</code>. Esto instruíra a Echo a no agregar el nombre de espacio de la aplicación al evento:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'.server.created'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><a name="broadcast-data"></a></p> <h3 id="datos-de-la-transmision"><a href="#datos-de-la-transmision" aria-hidden="true" class="header-anchor">#</a> Datos De La Transmisión</h3> <p>Cuando un evento es transmitido, todas sus propiedades <code>public</code> son automáticamente serializadas y transmitidas como carga del evento, permitiéndote acceder a cualquiera de sus datos públicos desde tu aplicación de JavaScript. Así que, por ejemplo, si tu evento tiene una sola propiedad pública <code>$user</code> que contiene un modelo de Eloquent, la carga de transmisión del evento sería:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token punctuation">{</span>
    <span class="token double-quoted-string string">&quot;user&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token double-quoted-string string">&quot;id&quot;</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token double-quoted-string string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token double-quoted-string string">&quot;Patrick Stewart&quot;</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Sin embargo, si deseas tener mayor control sobre la carga transmitida, puedes agregar un método <code>broadcastWith</code> a tu evento. Este método debería retornar el arreglo de datos que deseas transmitir como la carga del evento:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">/**
* Get the data to broadcast.
*
* @return array
*/</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">broadcastWith</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token single-quoted-string string">'id'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">id</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><a name="broadcast-queue"></a></p> <h3 id="cola-de-transmision"><a href="#cola-de-transmision" aria-hidden="true" class="header-anchor">#</a> Cola De Transmisión</h3> <p>Por defecto, cada evento transmitido es colocado en la cola por defecto para la conexión de cola por defecto especificada en tu archivo de configuración <code>queue.php</code>. Puedes personalizar la cola usada por el transmisor definiendo una propiedad <code>broadcastQueue</code> en la clase de tu evento. Esta propiedad debería especificar el nombre de la cola que deseas usar al transmitir:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">/**
* The name of the queue on which to place the event.
*
* @var string
*/</span>
<span class="token keyword">public</span> <span class="token variable">$broadcastQueue</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'your-queue-name'</span><span class="token punctuation">;</span>
</code></pre></div><p>Si quieres transmitir tu evento usando la cola <code>sync</code> en lugar del driver de cola por defecto, puedes implementar la interfaz <code>ShouldBroadcastNow</code> en lugar de <code>ShouldBroadcast</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Contracts<span class="token punctuation">\</span>Broadcasting<span class="token punctuation">\</span>ShouldBroadcastNow</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">ShippingStatusUpdated</span> <span class="token keyword">implements</span> <span class="token class-name">ShouldBroadcastNow</span>
<span class="token punctuation">{</span>
    <span class="token comment">//</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p><a name="broadcast-conditions"></a></p> <h3 id="condiciones-de-la-transmision"><a href="#condiciones-de-la-transmision" aria-hidden="true" class="header-anchor">#</a> Condiciones De La Transmisión</h3> <p>Algunas veces quieres transmitir tu evento sólo si una condición dada es verdadera. Puedes definir estas condiciones agregando un método <code>broadcastWhen</code> a la clase de tu evento:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">/**
* Determine if this event should broadcast.
*
* @return bool
*/</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">broadcastWhen</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">value</span> <span class="token operator">&gt;</span> <span class="token number">100</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><a name="authorizing-channels"></a></p> <h2 id="autorizando-canales-2"><a href="#autorizando-canales-2" aria-hidden="true" class="header-anchor">#</a> Autorizando Canales</h2> <p>Los canales privados requieren que autorizes que el usuario actualmente autenticado puede escuchar en el canal privado. Esto es logrado haciendo una solicitud HTTP a tu aplicación de Laravel con el nombre del canal y permitiendo a tu aplicación de terminar si el usuario puede escuchar en dicho canal. Al usar <a href="#installing-laravel-echo">Laravel Echo</a>, la solicitud HTTP para autorizar suscripciones a canales privados será realizada automáticamente; sin embargo, si necesitas definir las rutas necesarias para responder a estas solicitudes.</p> <p><a name="defining-authorization-routes"></a></p> <h3 id="definiendo-rutas-de-autorizacion"><a href="#definiendo-rutas-de-autorizacion" aria-hidden="true" class="header-anchor">#</a> Definiendo Rutas De Autorización</h3> <p>Afortunadamente, Laravel hace que sea fácil definir las rutas para responder a las solicitudes de autorización de canales. En el <code>BroadcastServiceProvider</code> incluido con tu aplicación de Laravel, verás una llamada al método <code>Broadcast::routes</code>. Este método registrará la ruta <code>/broadcasting/auth</code> para manejar las solicitudes de autorización:</p> <div class="language-php extra-class"><pre class="language-php"><code>Broadcast<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>El método <code>Broadcast::routes</code> automáticamente coloca sus rutas dentro del grupo de middleware <code>web</code>; sin embargo, puedes pasar un arreglo de atributos de ruta al método si te gustaría personalizar los atributos asignados:</p> <div class="language-php extra-class"><pre class="language-php"><code>Broadcast<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token variable">$attributes</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="personalizando-endpoints-de-autorizacion"><a href="#personalizando-endpoints-de-autorizacion" aria-hidden="true" class="header-anchor">#</a> Personalizando Endpoints De Autorización</h4> <p>Por defecto, Echo usará el endpoint <code>/broadcasting/auth</code> para autorizar acceso a canales. Sin embargo, puedes especificar tus propios endpoints de autorización pasando la opción de configuración <code>authEndpoint</code> a tu instancia de Echo:</p> <div class="language-php extra-class"><pre class="language-php"><code>window<span class="token punctuation">.</span><span class="token keyword">Echo</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Echo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    broadcaster<span class="token punctuation">:</span> <span class="token single-quoted-string string">'pusher'</span><span class="token punctuation">,</span>
    key<span class="token punctuation">:</span> <span class="token single-quoted-string string">'your-pusher-key'</span><span class="token punctuation">,</span>
    authEndpoint<span class="token punctuation">:</span> <span class="token single-quoted-string string">'/custom/endpoint/auth'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><a name="defining-authorization-callbacks"></a></p> <h3 id="definiendo-callbacks-de-autorizacion"><a href="#definiendo-callbacks-de-autorizacion" aria-hidden="true" class="header-anchor">#</a> Definiendo Callbacks De Autorización</h3> <p>Luego, necesitamos definir la lógica que realizará la autorización del canal. Esto es hecho en el archivo <code>routes/channels.php</code> que es incluido con tu aplicación. En este archivo, puedes usar el método <code>Broadcast::channel</code> para registrar callbacks de autorización de canales:</p> <div class="language-php extra-class"><pre class="language-php"><code>Broadcast<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'order.{orderId}'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">,</span> <span class="token variable">$orderId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">id</span> <span class="token operator">===</span> Order<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">findOrNew</span><span class="token punctuation">(</span><span class="token variable">$orderId</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">user_id</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>El método <code>channel</code> acepta dos argumentos: el nombre del canal y un callback que retorna <code>true</code> o <code>false</code> indicando si el usuario está autorizado para escuchar el canal.</p> <p>Todos los callbacks de autorización reciben al usuario actualmente autenticado como primer argumento y cualquier parametro wildcard como sus argumentos siguientes. En este ejemplo, estamos usando el placeholder <code>{orderId}</code> para indicar la porción &quot;ID&quot; del nombre del canal es un wildcard.</p> <h4 id="authorization-callback-model-binding"><a href="#authorization-callback-model-binding" aria-hidden="true" class="header-anchor">#</a> Authorization Callback Model Binding</h4> <p>Igual que las rutas HTTP, las rutas de los canales pueden tomar ventaja de <a href="/docs/%7B%7Bversion%7D%7D/routing#route-model-binding">modelo de enlace de rutas</a> de forma implícita y explícita. Por ejemplo, en lugar de recibir la cadena o ID númerico de la orden, puedes solicitar una instancia del modelo <code>Order</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Order</span><span class="token punctuation">;</span>

Broadcast<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'order.{order}'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">,</span> Order <span class="token variable">$order</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">id</span> <span class="token operator">===</span> <span class="token variable">$order</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">user_id</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="autenticacion-del-callback-de-autorizacion"><a href="#autenticacion-del-callback-de-autorizacion" aria-hidden="true" class="header-anchor">#</a> Autenticación del callback de autorización</h4> <p>Los canales privados y de presencia autentican al usuario actual a través de la protección de autenticación por defecto de la aplicacion. Si el usuario no está autenticado, la autorizacion del canal es automáticamente negada y el callback de autorización nunca se ejecuta. Sin embargo, puedes asignar múltiples protecciones personalizadas que deben autenticar la solicitud entrante si es necesario:</p> <div class="language-php extra-class"><pre class="language-php"><code>Broadcast<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'channel'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token single-quoted-string string">'guards'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token single-quoted-string string">'web'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'admin'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><p><a name="defining-channel-classes"></a></p> <h3 id="definiendo-clases-de-canales"><a href="#definiendo-clases-de-canales" aria-hidden="true" class="header-anchor">#</a> Definiendo Clases De Canales</h3> <p>Si tu aplicación está consumiendo muchos canales diferentes, tu archivo <code>routes/channels.php</code> podría volverse voluminoso. Así que, en lugar de usar Closures para autorizar canales, puedes usar clases de canales. Para generar una clase de canal, usa el comando de artisan <code>make:channel</code>. Este comando colocará una nueva clase de canal en el directorio <code>App/Broadcasting</code>.</p> <div class="language-php extra-class"><pre class="language-php"><code>php artisan make<span class="token punctuation">:</span>channel OrderChannel
</code></pre></div><p>Luego, registra tu canal en tu archivo <code>routes/channels.php</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Broadcasting<span class="token punctuation">\</span>OrderChannel</span><span class="token punctuation">;</span>

Broadcast<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'order.{order}'</span><span class="token punctuation">,</span> OrderChannel<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Finalmente, puedes colocar la lógica de autorización para tu canal en el método <code>join</code> de la clase del canal. Este método <code>join</code> contendrá la misma lógica que típicamente habrías colocado en el Closure de tu canal de autorización. Puedes también tomar ventaja del modelo de enlace de canales:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Broadcasting</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>User</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Order</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">OrderChannel</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * Create a new channel instance.
    *
    * @return void
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
    * Authenticate the user's access to the channel.
    *
    * @param  \App\User  $user
    * @param  \App\Order  $order
    * @return array|bool
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">join</span><span class="token punctuation">(</span>User <span class="token variable">$user</span><span class="token punctuation">,</span> Order <span class="token variable">$order</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">id</span> <span class="token operator">===</span> <span class="token variable">$order</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">user_id</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>Como muchas otras clases en Laravel, las clases de canales automáticamente serán resueltas por el <a href="/docs/%7B%7Bversion%7D%7D/container">contenedor de servicios</a>. Así que, puedes declarar el tipo de cualquier dependencia requerida por tu canal en su constructor.</p></div> <p><a name="broadcasting-events"></a></p> <h2 id="transmitiendo-eventos"><a href="#transmitiendo-eventos" aria-hidden="true" class="header-anchor">#</a> Transmitiendo Eventos</h2> <p>Una vez que has definido un evento y lo has marcado con la interfaz <code>ShouldBroadcast</code>, sólo necesitas ejecutar el evento usando la función <code>event</code>. El despachador de eventos notará que el evento está marcado con la interfaz <code>ShouldBroadcast</code> y agrega el evento a la cola para transmisión:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token function">event</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ShippingStatusUpdated</span><span class="token punctuation">(</span><span class="token variable">$update</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><a name="only-to-others"></a></p> <h3 id="solo-a-otros"><a href="#solo-a-otros" aria-hidden="true" class="header-anchor">#</a> Sólo A Otros</h3> <p>Al construir una aplicación que usa la transmisión de eventos, puedes sustituir la función <code>event</code> por la función <code>broadcast</code>. Como la función <code>event</code>, la función <code>broadcast</code> despacha el evento a tus listeners del lado del servidor:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token function">broadcast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ShippingStatusUpdated</span><span class="token punctuation">(</span><span class="token variable">$update</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Sin embargo, la función <code>broadcast</code> también expone el método <code>toOthers</code> que te permite excluir al usuario actual de los recipientes de la transmisión:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token function">broadcast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ShippingStatusUpdated</span><span class="token punctuation">(</span><span class="token variable">$update</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">toOthers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Para entender mejor cuando es posible que quieras usar el método <code>toOthers</code>, vamos a imaginar una aplicación de lista de tareas donde un usuario puede crear una nueva tarea ingresando un nombre de tarea. Para crear una tarea, tu aplicación puede hacer una solicitud a un punto de salida <code>/task</code> que transmite la creación de la tarea y retorna una representación JSON de la nueva tarea. Cuando tu aplicación de JavaScript recibe la respuesta del punto de salida, podría directamente insertar la nueva tarea en su lista de tareas de la siguiente forma:</p> <div class="language-php extra-class"><pre class="language-php"><code>axios<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'/task'</span><span class="token punctuation">,</span> task<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        this<span class="token punctuation">.</span>tasks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Sin embargo, recuerda que también transmitimos la creación de la tarea. Si tu aplicación de JavaScript está escuchando este evento para agregar tareas a la lista de tareas, tendrás tareas duplicadas en tu lista: una del punto de salida y una de la transmisión.  Puedes resolver esto usando el método <code>toOthers</code> para instruir al transmisor para que no transmita el evento al usuario actual.</p> <div class="danger custom-block"><p class="custom-block-title">Nota</p> <p>Tu evento debe usar el trait <code>Illuminate\Broadcasting\InteractsWithSockets</code> para poder llamar al método <code>toOthers</code>.</p></div> <h4 id="configuracion-2"><a href="#configuracion-2" aria-hidden="true" class="header-anchor">#</a> Configuración</h4> <p>Cuando incializas una instancia de Laravel Echo, un ID de socket es asignado a la conexión. Si estás usando <a href="https://vuejs.org" target="_blank" rel="noopener noreferrer">Vue<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> y <a href="https://github.com/mzabriskie/axios" target="_blank" rel="noopener noreferrer">Axios<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, el ID del socket será agregado automáticamente a cada solicitud saliente como un header <code>X-Socket-ID</code>. Entonces, cuando llamas al método <code>toOthers</code>, Laravel extraerá el ID del socket desde el encabezado e instruirá al transmisor a no transmitir a ninguna conexión con dicho ID de socket.</p> <p>Si no estás usando Vue y Axios, necesitarás configurar manualmente tu aplicación de JavaScript para enviar el encabezado <code>X-Socket-ID</code>. Puedes retornar el ID del socket usando el método <code>Echo.socketId</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">var</span> socketId <span class="token operator">=</span> <span class="token keyword">Echo</span><span class="token punctuation">.</span><span class="token function">socketId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><a name="receiving-broadcasts"></a></p> <h2 id="recibiendo-transmisiones"><a href="#recibiendo-transmisiones" aria-hidden="true" class="header-anchor">#</a> Recibiendo Transmisiones</h2> <p><a name="installing-laravel-echo"></a></p> <h3 id="instalando-laravel-echo"><a href="#instalando-laravel-echo" aria-hidden="true" class="header-anchor">#</a> Instalando Laravel Echo</h3> <p>Laravel Echo es una librería de JavaScript que hace que sea fácil suscribirse a canales y escuchar transmisiones de eventos en Laravel. Puedes instalar Echo mediante el administrador de paquetes NPM. En este ejemplo, también instalaremos el paquete <code>pusher-js</code> dado que usaremos el transmisor de Pusher:</p> <div class="language-php extra-class"><pre class="language-php"><code>npm install <span class="token operator">--</span>save laravel<span class="token operator">-</span><span class="token keyword">echo</span> pusher<span class="token operator">-</span>js
</code></pre></div><p>Una vez que Echo es instalado, estás listo para crear una instancia nueva de Echo en el JavaScript de tu aplicación. Un buen lugar para hacer esto es en la parte inferior del archivo <code>resources/js/bootstrap.js</code> que es incluido con el framework Laravel:</p> <div class="language-php extra-class"><pre class="language-php"><code>import <span class="token keyword">Echo</span> from <span class="token double-quoted-string string">&quot;laravel-echo&quot;</span>

window<span class="token punctuation">.</span><span class="token keyword">Echo</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Echo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    broadcaster<span class="token punctuation">:</span> <span class="token single-quoted-string string">'pusher'</span><span class="token punctuation">,</span>
    key<span class="token punctuation">:</span> <span class="token single-quoted-string string">'your-pusher-key'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Al crear una instancia de Echo que usa el conector <code>pusher</code>, puedes también especificar un <code>cluster</code> así como también si la conexión debe ser encriptada:</p> <div class="language-php extra-class"><pre class="language-php"><code>window<span class="token punctuation">.</span><span class="token keyword">Echo</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Echo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    broadcaster<span class="token punctuation">:</span> <span class="token single-quoted-string string">'pusher'</span><span class="token punctuation">,</span>
    key<span class="token punctuation">:</span> <span class="token single-quoted-string string">'your-pusher-key'</span><span class="token punctuation">,</span>
    cluster<span class="token punctuation">:</span> <span class="token single-quoted-string string">'eu'</span><span class="token punctuation">,</span>
    encrypted<span class="token punctuation">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="usando-una-instancia-de-cliente-existente"><a href="#usando-una-instancia-de-cliente-existente" aria-hidden="true" class="header-anchor">#</a> Usando Una Instancia De Cliente Existente</h4> <p>Si ya tienes una instancia de cliente de Pusher o Socket.io que te gustaría que Echo usara, puedes pasarla a Echo mediante la opción de configuración <code>client</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">const</span> client <span class="token operator">=</span> <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'pusher-js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

window<span class="token punctuation">.</span><span class="token keyword">Echo</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Echo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    broadcaster<span class="token punctuation">:</span> <span class="token single-quoted-string string">'pusher'</span><span class="token punctuation">,</span>
    key<span class="token punctuation">:</span> <span class="token single-quoted-string string">'your-pusher-key'</span><span class="token punctuation">,</span>
    client<span class="token punctuation">:</span> client
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><a name="listening-for-events"></a></p> <h3 id="escuchando-eventos"><a href="#escuchando-eventos" aria-hidden="true" class="header-anchor">#</a> Escuchando Eventos</h3> <p>Una vez que has instalado e instanciado Echo, estás listo para comenzar a escuchar transmisiones de eventos. Primero, usa el método <code>channel</code> para retornar una instancia de un canal, luego llama al método <code>listen</code> para escuchar a un evento especificado:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">Echo</span><span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'orders'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'OrderShipped'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>order<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Si te gustaría escuchar eventos en un canal privado, usa el método <code>private</code> en su lugar. Puedes continuar encadenando llamadas al método <code>listen</code> para escuchar múltiples eventos en un sólo canal:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">Echo</span><span class="token punctuation">.</span><span class="token keyword">private</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'orders'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><a name="leaving-a-channel"></a></p> <h3 id="abandonando-un-canal"><a href="#abandonando-un-canal" aria-hidden="true" class="header-anchor">#</a> Abandonando Un Canal</h3> <p>Para abandonar un canal, puedes llamar al método <code>leaveChannel</code> en tu instancia de Echo:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">Echo</span><span class="token punctuation">.</span><span class="token function">leaveChannel</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'orders'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Si te gustaría abandonar un canal y también sus canales privados y presenciales asociados, puedes usar el método <code>leave</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">Echo</span><span class="token punctuation">.</span><span class="token function">leave</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'orders'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><a name="namespaces"></a></p> <h3 id="nombres-de-espacio"><a href="#nombres-de-espacio" aria-hidden="true" class="header-anchor">#</a> Nombres De Espacio</h3> <p>Puedes haber notado en los ejemplos superiores que no especificamos un nombre de espacio completo para las clases del evento. Esto es debido a que Echo automáticamente asumirá que los eventos están ubicados en el nombre de espacio <code>App\Events</code>. Sin embargo, puedes configurar el nombre de espacio principal cuando instancias Echo pasando una opción de configuración <code>namespace</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code>window<span class="token punctuation">.</span><span class="token keyword">Echo</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Echo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    broadcaster<span class="token punctuation">:</span> <span class="token single-quoted-string string">'pusher'</span><span class="token punctuation">,</span>
    key<span class="token punctuation">:</span> <span class="token single-quoted-string string">'your-pusher-key'</span><span class="token punctuation">,</span>
    <span class="token keyword">namespace</span><span class="token punctuation">:</span> <span class="token single-quoted-string string">'App.Other.Namespace'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Alternativamente, puedes prefijar las clases del evento con un <code>.</code> al suscribrte a estos usando Echo. Esto te permitirá siempre especificar el nombre de clase completamente calificado:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">Echo</span><span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'orders'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'.Namespace\\Event\\Class'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">//</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><a name="presence-channels"></a></p> <h2 id="canales-de-presencia"><a href="#canales-de-presencia" aria-hidden="true" class="header-anchor">#</a> Canales De Presencia</h2> <p>Los Canales de Presencia son construidos sobre la seguridad de los canales privados mientras que exponen la característica adicional de saber quien está susbscrito al canal. Esto hace que sea fácil construir características de aplicación poderosas y colaborativas como notificar a usuarios cuando otro usuario está viendo la misma página.</p> <p><a name="authorizing-presence-channels"></a></p> <h3 id="autorizando-canales-de-presencia"><a href="#autorizando-canales-de-presencia" aria-hidden="true" class="header-anchor">#</a> Autorizando Canales De Presencia</h3> <p>Todos los canales de Presencia son también canales privados; por lo tanto, los usuarios deben estar <a href="#authorizing-channels">autorizados para accederlos</a>. Sin embargo, al definir callbacks de autorización para canales de presencia, no retornarás <code>true</code> si el usuario está autorizado para unirse al canal. En su lugar, debes retornar un arreglo de datos sobre el usuario.</p> <p>Los datos retornados por el callback de autorización estarán disponibles para los listeners de eventos de canales de presencia en tu aplicación de JavaScript. Si el usuario no está autorizado para unirse al canal de presencia, debes retornar <code>false</code> o <code>null</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code>Broadcast<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'chat.{roomId}'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">,</span> <span class="token variable">$roomId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">canJoinRoom</span><span class="token punctuation">(</span><span class="token variable">$roomId</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token single-quoted-string string">'id'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">id</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'name'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">name</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><a name="joining-presence-channels"></a></p> <h3 id="uniendose-a-canales-de-presencia"><a href="#uniendose-a-canales-de-presencia" aria-hidden="true" class="header-anchor">#</a> Uniendose A Canales De Presencia</h3> <p>Para unirse a un canal de presencia, puedes usar el método <code>join</code> de Echo. El método <code>join</code> retornará una implementación de <code>PresenceChannel</code> que, junto con la exposición del método <code>listen</code>, te permite suscribirte a los eventos <code>here</code>, <code>joining</code> y <code>leaving</code>.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">Echo</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>`chat<span class="token punctuation">.</span><span class="token variable">$</span><span class="token punctuation">{</span>roomId<span class="token punctuation">}</span>`<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">here</span><span class="token punctuation">(</span><span class="token punctuation">(</span>users<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">//</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">joining</span><span class="token punctuation">(</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">leaving</span><span class="token punctuation">(</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>El callback <code>here</code> será ejecutado inmediatamente una vez que el canal se haya unido con éxito y recibirá un arreglo que contiene la información del usuario para todos los demás usuarios actualmente subscritos al canal. El método <code>joining</code> será ejecutado cuando un nuevo usuario se une a un canal, mientras que el método <code>leaving</code> será ejecutado cuando un usuario abandona el canal.</p> <p><a name="broadcasting-to-presence-channels"></a></p> <h3 id="transmitiendo-a-canales-de-presencia"><a href="#transmitiendo-a-canales-de-presencia" aria-hidden="true" class="header-anchor">#</a> Transmitiendo A Canales De Presencia</h3> <p>Los canales de Presencia pueden recibir eventos igual que los canales públicos y privados. Usando el ejemplo de una sala de chat, podemos querer transmitir eventos <code>NewMessage</code> al canal de presencia de la sala. Para hacer eso, retornaremos una instancia de <code>PresenceChannel</code> desde el método <code>broadcastOn</code> del evento:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">/**
* Get the channels the event should broadcast on.
*
* @return Channel|array
*/</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">broadcastOn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">PresenceChannel</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'room.'</span><span class="token punctuation">.</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">message</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">room_id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Como los eventos públicos o privados, los canales de presencia pueden ser transmitidos usando la función <code>broadcast</code>. Como con otros eventos, puedes usar el método <code>toOthers</code> para excluir al usuario actual de recibir las transmisiones:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token function">broadcast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NewMessage</span><span class="token punctuation">(</span><span class="token variable">$message</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">broadcast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NewMessage</span><span class="token punctuation">(</span><span class="token variable">$message</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">toOthers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Puedes escuchar el evento join mediante el método <code>listen</code> de Echo:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">Echo</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>`chat<span class="token punctuation">.</span><span class="token variable">$</span><span class="token punctuation">{</span>roomId<span class="token punctuation">}</span>`<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">here</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">joining</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">leaving</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'NewMessage'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">//</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><a name="client-events"></a></p> <h2 id="eventos-del-cliente"><a href="#eventos-del-cliente" aria-hidden="true" class="header-anchor">#</a> Eventos Del Cliente</h2> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>Al usar <a href="https://pusher.com" target="_blank" rel="noopener noreferrer">Pusher<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, debes habilitar la opción &quot;Client Events&quot; en la sección &quot;App Settings&quot; del <a href="https://dashboard.pusher.com/" target="_blank" rel="noopener noreferrer">dashboard de tu aplicación<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> para enviar eventos del cliente.</p></div> <p>Algunas veces puedes querer transmitir un evento a otros clientes conectados sin tocar tu aplicación en lo absoluto. Esto puede ser particularmente útil para cosas como &quot;escribir&quot; notificaciones, donde quieres advertir a los usuarios de tu aplicación que otro usuario está escribiendo un mensaje en una pantalla dada.</p> <p>Para transmitir eventos del cliente, puedes usar el método <code>whisper</code> de Echo:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">Echo</span><span class="token punctuation">.</span><span class="token keyword">private</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'chat'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">whisper</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'typing'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        name<span class="token punctuation">:</span> this<span class="token punctuation">.</span>user<span class="token punctuation">.</span>name
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Para escuchar eventos del cliente, puedes usar el método <code>listenForWhisper</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">Echo</span><span class="token punctuation">.</span><span class="token keyword">private</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'chat'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">listenForWhisper</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'typing'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><a name="notifications"></a></p> <h2 id="notificaciones"><a href="#notificaciones" aria-hidden="true" class="header-anchor">#</a> Notificaciones</h2> <p>Al juntar transmisión de eventos con <a href="/docs/%7B%7Bversion%7D%7D/notifications">notificaciones</a>, tu aplicación de JavaScript puede recibir nuevas notificaciones mientras ocurren sin necesidad de refrescar la página. Primero, asegurate de leer la documentación sobre el uso <a href="/docs/%7B%7Bversion%7D%7D/notifications#broadcast-notifications">del canal de transmisión de notificaciones</a>.</p> <p>Una vez que has configurado una notificación para usar el canal de transmisión, puedes escuchar a los eventos de la transmisión usando el método <code>notification</code> de Echo. Recuerda, el nombre del canal debe ser igual al nombre de la clase de la entidad recibiendo la notificaciones:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">Echo</span><span class="token punctuation">.</span><span class="token keyword">private</span><span class="token punctuation">(</span>`App<span class="token punctuation">.</span>User<span class="token punctuation">.</span><span class="token variable">$</span><span class="token punctuation">{</span>userId<span class="token punctuation">}</span>`<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">notification</span><span class="token punctuation">(</span><span class="token punctuation">(</span>notification<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>notification<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>En este ejemplo, todas las notificaciones enviadas a instancias de <code>App\User</code> mediante el canal <code>broadcast</code> serán recibidas por el callback. Un callback de autorización de canal para el canal <code>App.User.{id}</code> es incluido en el <code>BroadcastServiceProvider</code> que viene con el framework Laravel por defecto.</p></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/artisan.html" class="prev">
          Consola Artisan
        </a></span> <span class="next"><a href="/cache.html">
          Caché
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/app.670d7e7c.js" defer></script><script src="/assets/js/15.8a736f30.js" defer></script>
  </body>
</html>
