<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Eloquent: Relaciones | Documentación de Laravel en Español</title>
    <meta name="description" content="Documentación de Laravel en Español">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Catamaran:300,700|Miriam+Libre">
    
    <link rel="preload" href="/assets/css/0.styles.0cc2d3c3.css" as="style"><link rel="preload" href="/assets/js/app.bf22240a.js" as="script"><link rel="preload" href="/assets/js/29.06a87f0d.js" as="script"><link rel="prefetch" href="/assets/js/10.8a8a99df.js"><link rel="prefetch" href="/assets/js/11.ec476e2f.js"><link rel="prefetch" href="/assets/js/12.6db1eb13.js"><link rel="prefetch" href="/assets/js/13.92d78bb5.js"><link rel="prefetch" href="/assets/js/14.1a0ad5f1.js"><link rel="prefetch" href="/assets/js/15.abc982c9.js"><link rel="prefetch" href="/assets/js/16.7cf1a759.js"><link rel="prefetch" href="/assets/js/17.4abfc664.js"><link rel="prefetch" href="/assets/js/18.85b19837.js"><link rel="prefetch" href="/assets/js/19.8c9dfcd5.js"><link rel="prefetch" href="/assets/js/2.dcb6cf45.js"><link rel="prefetch" href="/assets/js/20.c1b9de54.js"><link rel="prefetch" href="/assets/js/21.469ffab3.js"><link rel="prefetch" href="/assets/js/22.2d14e150.js"><link rel="prefetch" href="/assets/js/23.7a4dcc9a.js"><link rel="prefetch" href="/assets/js/24.534e59f1.js"><link rel="prefetch" href="/assets/js/25.eaac1c07.js"><link rel="prefetch" href="/assets/js/26.8e9180e0.js"><link rel="prefetch" href="/assets/js/27.2cd2ace8.js"><link rel="prefetch" href="/assets/js/28.9f7dcf6d.js"><link rel="prefetch" href="/assets/js/3.b62bf0b4.js"><link rel="prefetch" href="/assets/js/30.b03f86ec.js"><link rel="prefetch" href="/assets/js/31.edce81f6.js"><link rel="prefetch" href="/assets/js/32.6657300b.js"><link rel="prefetch" href="/assets/js/33.8dc49209.js"><link rel="prefetch" href="/assets/js/34.03cbee56.js"><link rel="prefetch" href="/assets/js/35.5439db2e.js"><link rel="prefetch" href="/assets/js/36.83d5a264.js"><link rel="prefetch" href="/assets/js/37.4066824e.js"><link rel="prefetch" href="/assets/js/38.c3fe05aa.js"><link rel="prefetch" href="/assets/js/39.52ef8667.js"><link rel="prefetch" href="/assets/js/4.bd0ebba2.js"><link rel="prefetch" href="/assets/js/40.2c54d702.js"><link rel="prefetch" href="/assets/js/41.775bc6e1.js"><link rel="prefetch" href="/assets/js/42.6541d60b.js"><link rel="prefetch" href="/assets/js/43.20091aea.js"><link rel="prefetch" href="/assets/js/44.75b71ccc.js"><link rel="prefetch" href="/assets/js/45.6b36a3a8.js"><link rel="prefetch" href="/assets/js/46.6ea236af.js"><link rel="prefetch" href="/assets/js/47.0e0ee374.js"><link rel="prefetch" href="/assets/js/48.b6beb9b8.js"><link rel="prefetch" href="/assets/js/49.ae33b521.js"><link rel="prefetch" href="/assets/js/5.2c350d8b.js"><link rel="prefetch" href="/assets/js/50.5cb081e0.js"><link rel="prefetch" href="/assets/js/51.3e0281e2.js"><link rel="prefetch" href="/assets/js/52.e1fae1d6.js"><link rel="prefetch" href="/assets/js/53.0a9d4aed.js"><link rel="prefetch" href="/assets/js/54.55bc9113.js"><link rel="prefetch" href="/assets/js/55.e964fdb4.js"><link rel="prefetch" href="/assets/js/56.3abed8a0.js"><link rel="prefetch" href="/assets/js/57.df09269b.js"><link rel="prefetch" href="/assets/js/58.3ce37458.js"><link rel="prefetch" href="/assets/js/59.7a840aeb.js"><link rel="prefetch" href="/assets/js/6.6fce793d.js"><link rel="prefetch" href="/assets/js/60.b4fe788b.js"><link rel="prefetch" href="/assets/js/61.e45356bb.js"><link rel="prefetch" href="/assets/js/62.0d75cf78.js"><link rel="prefetch" href="/assets/js/63.0ecae205.js"><link rel="prefetch" href="/assets/js/64.90fb2c2d.js"><link rel="prefetch" href="/assets/js/65.7c476002.js"><link rel="prefetch" href="/assets/js/66.802dee8b.js"><link rel="prefetch" href="/assets/js/67.ae965c66.js"><link rel="prefetch" href="/assets/js/68.220c04d8.js"><link rel="prefetch" href="/assets/js/69.bf607b92.js"><link rel="prefetch" href="/assets/js/7.b956f78c.js"><link rel="prefetch" href="/assets/js/70.dea3d878.js"><link rel="prefetch" href="/assets/js/71.1f786e34.js"><link rel="prefetch" href="/assets/js/72.4bd65b39.js"><link rel="prefetch" href="/assets/js/73.414b29bd.js"><link rel="prefetch" href="/assets/js/74.b5ab4f13.js"><link rel="prefetch" href="/assets/js/75.f12fbb27.js"><link rel="prefetch" href="/assets/js/76.a140d22b.js"><link rel="prefetch" href="/assets/js/77.2595933c.js"><link rel="prefetch" href="/assets/js/78.46bb4eff.js"><link rel="prefetch" href="/assets/js/79.c549a0e3.js"><link rel="prefetch" href="/assets/js/8.3be12d8d.js"><link rel="prefetch" href="/assets/js/80.1b9cd731.js"><link rel="prefetch" href="/assets/js/81.6aa05825.js"><link rel="prefetch" href="/assets/js/9.60a01cba.js">
    <link rel="stylesheet" href="/assets/css/0.styles.0cc2d3c3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Documentación de Laravel en Español</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Inicio</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Inicio</a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading"><span>Primeros Pasos</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Conceptos De Arquitectura</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Fundamentos</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Frontend</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Seguridad</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Profundizando</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Bases De Datos</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>ORM Eloquent</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/eloquent.html" class="sidebar-link">Eloquent: Primeros Pasos</a></li><li><a href="/eloquent-relationships.html" class="active sidebar-link">Eloquent: Relaciones</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/eloquent-relationships.html#introduccion" class="sidebar-link">Introducción</a></li><li class="sidebar-sub-header"><a href="/eloquent-relationships.html#definiendo-relaciones" class="sidebar-link">Definiendo Relaciones</a></li><li class="sidebar-sub-header"><a href="/eloquent-relationships.html#relaciones-polimorficas" class="sidebar-link">Relaciones Polimórficas</a></li><li class="sidebar-sub-header"><a href="/eloquent-relationships.html#consultando-relaciones" class="sidebar-link">Consultando Relaciones</a></li><li class="sidebar-sub-header"><a href="/eloquent-relationships.html#carga-previa-eager-loading" class="sidebar-link">Carga Previa (Eager Loading)</a></li><li class="sidebar-sub-header"><a href="/eloquent-relationships.html#insertando-y-actualizando-modelos-relacionados" class="sidebar-link">Insertando Y Actualizando Modelos Relacionados</a></li><li class="sidebar-sub-header"><a href="/eloquent-relationships.html#tocando-marcas-de-tiempo-del-padre" class="sidebar-link">Tocando Marcas De Tiempo Del Padre</a></li></ul></li><li><a href="/eloquent-collections.html" class="sidebar-link">Eloquent: Colecciones</a></li><li><a href="/eloquent-mutators.html" class="sidebar-link">Eloquent: Mutators</a></li><li><a href="/eloquent-serialization.html" class="sidebar-link">Eloquent: Serialización</a></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Pruebas</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Paquetes oficiales</span> <span class="arrow right"></span></p> <!----></div></li></ul> </div> <div class="page"> <div class="content"><div><h1 id="eloquent-relaciones"><a class="header-anchor" href="#eloquent-relaciones" aria-hidden="true">#</a> Eloquent: Relaciones</h1> <ul><li><a href="#introduction">Introducción</a></li> <li><a href="#defining-relationships">Definiendo Relaciones</a> <ul><li><a href="#one-to-one">Uno A Uno</a></li> <li><a href="#one-to-many">Uno A Muchos</a></li> <li><a href="#one-to-many-inverse">Uno A Muchos (Inverso)</a></li> <li><a href="#many-to-many">Muchos A Muchos</a></li> <li><a href="#defining-custom-intermediate-table-models">Definiendo Modelos de Tabla Intermedia Personalizados</a></li> <li><a href="#has-one-through">Tiene Uno A Través De</a></li> <li><a href="#has-many-through">Tiene Muchos a Través de</a></li></ul></li> <li><a href="#polymorphic-relationships">Relaciones Polimórficas</a> <ul><li><a href="#one-to-one-polymorphic-relations">Uno A Uno</a></li> <li><a href="#one-to-many-polymorphic-relations">Uno A Muchos</a></li> <li><a href="#many-to-many-polymorphic-relations">Muchos A Muchos</a></li> <li><a href="#custom-polymorphic-types">Tipos Polimórficos Personalizados</a></li></ul></li> <li><a href="#querying-relations">Consultando Relaciones</a> <ul><li><a href="#relationship-methods-vs-dynamic-properties">Métodos De Relación Vs. Propiedades Dinámicas</a></li> <li><a href="#querying-relationship-existence">Consultando La Existencia De Relación</a></li> <li><a href="#querying-relationship-absence">Consultando La Ausencia De Relación</a></li> <li><a href="#counting-related-models">Contando Modelos Relacionados</a></li></ul></li> <li><a href="#eager-loading">Precarga (Eager Loading)</a> <ul><li><a href="#constraining-eager-loads">Restringiendo Precargas</a></li> <li><a href="#lazy-eager-loading">Precarga Diferida (Lazy Eager Loading)</a></li></ul></li> <li><a href="#inserting-and-updating-related-models">Insertando Y Actualizando Modelos Relacionados</a> <ul><li><a href="#the-save-method">El Método <code>save</code></a></li> <li><a href="#the-create-method">El Método <code>create</code></a></li> <li><a href="#updating-belongs-to-relationships">Actualizando Relaciones Pertenece A (BelongsTo)</a></li> <li><a href="#updating-many-to-many-relationships">Actualizando Relaciones Muchos A Muchos</a></li></ul></li> <li><a href="#touching-parent-timestamps">Tocando Marcas De Tiempo Del Padre</a></li></ul> <p><a name="introduction"></a></p> <h2 id="introduccion"><a class="header-anchor" href="#introduccion" aria-hidden="true">#</a> Introducción</h2> <p>Las tablas de base de datos frecuentemente están relacionadas a otra tabla. Por ejemplo, un post de un blog puede tener muchos comentarios o un pedido podría estar relacionado al usuario que lo ordenó. Eloquent hace que manejar y trabajar con estas relaciones sea fácil y soporta varios tipos de relaciones:</p> <ul><li><a href="#one-to-one">Uno a Uno</a></li> <li><a href="#one-to-many">Uno a Muchos</a></li> <li><a href="#many-to-many">Muchos a Muchos</a></li> <li><a href="#has-one-through">Uno a Través de</a></li> <li><a href="#has-many-through">Muchos a Través de</a></li> <li><a href="#one-to-one-polymorphic-relations">Uno a Uno (Polimórfica)</a></li> <li><a href="#one-to-many-polymorphic-relations">Uno a Muchos (Polimórfica)</a></li> <li><a href="#many-to-many-polymorphic-relations">Muchos a Muchos (Polimórfica)</a></li></ul> <p><a name="defining-relationships"></a></p> <h2 id="definiendo-relaciones"><a class="header-anchor" href="#definiendo-relaciones" aria-hidden="true">#</a> Definiendo Relaciones</h2> <p>Las relaciones de Eloquent se definen como métodos en tus clases de modelo de Eloquent. Debido a que, como los mismos modelos Eloquent, las relaciones también sirven como poderosos <a href="/docs/%7B%7Bversion%7D%7D/queries">constructores de consultas</a>, puesto que definir relaciones como métodos proporciona potentes capacidades de encadenamiento de métodos y consultas. Por ejemplo, podemos encadenar restricciones adicionales en esta relación <code>posts</code>:</p> <div class="language-php extra-class"><pre v-pre class="language-php"><code><span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">posts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'active'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Pero, antes de profundizar demasiado en el uso de relaciones, aprendamos cómo definir cada tipo.</p> <p><a name="one-to-one"></a></p> <h3 id="uno-a-uno"><a class="header-anchor" href="#uno-a-uno" aria-hidden="true">#</a> Uno A Uno</h3> <p>Una relación de uno a uno es una relación muy sencilla. Por ejemplo, un modelo <code>User</code> podría estar asociado con un <code>Phone</code>. Para definir esta relación, colocaremos un método <code>phone</code> en el modelo <code>User</code>. El método <code>phone</code> debería llamar al método <code>hasOne</code> y devolver su resultado:</p> <div class="language-php extra-class"><pre v-pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * Get the phone record associated with the user.
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">phone</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">hasOne</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'App\Phone'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p>El primer argumento pasado al método <code>hasOne</code> es el nombre del modelo relacionado. Una vez que la relación es definida, podemos obtener el registro relacionado usando propiedades dinámicas de Eloquent. Las propiedades dinámicas permiten que accedas a métodos de relación como si fueran propiedades definidas en el modelo:</p> <div class="language-php extra-class"><pre v-pre class="language-php"><code><span class="token variable">$phone</span> <span class="token operator">=</span> User<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">phone</span><span class="token punctuation">;</span>
</code></pre></div><p>Eloquent determina la clave foránea de la relación en base al nombre del modelo. En este caso, se asume automáticamente que el modelo <code>Phone</code> tenga una clave foránea <code>user_id</code>. Si deseas sobrescribir esta convención, puedes pasar un segundo argumento al método <code>hasOne</code>:</p> <div class="language-php extra-class"><pre v-pre class="language-php"><code><span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">hasOne</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'App\Phone'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'foreign_key'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Adicionalmente, Eloquent asume que la clave foránea debería tener un valor que coincida con la columna <code>id</code> (o <code>$primaryKey</code> personalizada) del padre. En otras palabras, Eloquent buscará el valor de la columna <code>id</code> del usuario en la columna <code>user_id</code> de <code>Phone</code>. Si prefieres que la relación use un valor distinto de <code>id</code>, puedes pasar un tercer argumento al método <code>hasOne</code> especificando tu clave personalizada:</p> <div class="language-php extra-class"><pre v-pre class="language-php"><code><span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">hasOne</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'App\Phone'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'foreign_key'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'local_key'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="definiendo-el-inverso-de-la-relacion"><a class="header-anchor" href="#definiendo-el-inverso-de-la-relacion" aria-hidden="true">#</a> Definiendo El Inverso De La Relación</h4> <p>Así, podemos acceder al modelo <code>Phone</code> desde nuestro <code>User</code>. Ahora, vamos a definir una relación en el modelo <code>Phone</code> que nos permitirá accdeder al <code>User</code> que posee el teléfono. Podemos definir el inverso de una relación <code>hasOne</code> usando el método <code>belongsTo</code>:</p> <div class="language-php extra-class"><pre v-pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Phone</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * Get the user that owns the phone.
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">belongsTo</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'App\User'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p>En el ejemplo anterior, Eloquent intentará hacer coincidir el <code>user_id</code> del modelo <code>Phone</code> con un <code>id</code> en el modelo <code>User</code>. Eloquent determina el nombre de la clave foránea de forma predeterminada al examinar el nombre del método de la relación y agregando el sufijo al nombre del método con <code>_id</code>. Sin embargo, si la clave foránea en el modelo <code>Phone</code> no es <code>user_id</code>, puedes pasar un nombre de clave personalizada como segundo argumento al método <code>belongsTo</code>:</p> <div class="language-php extra-class"><pre v-pre class="language-php"><code><span class="token comment">/**
* Get the user that owns the phone.
*/</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">belongsTo</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'App\User'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'foreign_key'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Si tu modelo padre no usa <code>id</code> como su clave primaria, o deseas hacer join al modelo hijo con una columna diferente, puedes pasar un tercer argumento al método <code>belongsTo</code> especificando la clave personalizada de tu tabla padre:</p> <div class="language-php extra-class"><pre v-pre class="language-php"><code><span class="token comment">/**
* Get the user that owns the phone.
*/</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">belongsTo</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'App\User'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'foreign_key'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'other_key'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><a name="one-to-many"></a></p> <h3 id="uno-a-muchos"><a class="header-anchor" href="#uno-a-muchos" aria-hidden="true">#</a> Uno A Muchos</h3> <p>Una relación de &quot;uno-a-muchos&quot; es usada para definir relaciones donde un solo modelo posee cualquier cantidad de otros modelos. Por ejemplo, un post de un blog puede tener un número infinito de comentarios. Al igual que todas las demás relaciones de Eloquent, las relaciones uno-a-muchos son definidas al colocar una función en tu modelo Eloquent:</p> <div class="language-php extra-class"><pre v-pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Post</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * Get the comments for the blog post.
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">comments</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">hasMany</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'App\Comment'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p>Recuerda, Eloquent determinará automáticamente la columna de clave foránea apropiada en el modelo <code>Comment</code>. Por convención, Eloquent tomará el nombre &quot;snake_case&quot; del modelo que la contiene y le agregará el sufijo <code>_id</code>. Para este ejemplo, Eloquent asumirá que la clave foránea del modelo <code>Comment</code> es <code>post_id</code>.</p> <p>Una vez que la relación ha sido definida, podemos acceder a la colección de comentarios al acceder a la propiedad <code>comments</code>. Recuerda, ya que Eloquent proporciona &quot;propiedades dinámicas&quot;, podemos acceder a los métodos de la relación como si fueran definidos como propiedades en el modelo:</p> <div class="language-php extra-class"><pre v-pre class="language-php"><code><span class="token variable">$comments</span> <span class="token operator">=</span> App\<span class="token package">Post</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">comments</span><span class="token punctuation">;</span>

<span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$comments</span> <span class="token keyword">as</span> <span class="token variable">$comment</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Debido a que todas las relaciones también sirven como constructores de consultas (query builders), puedes agregar restricciones adicionales a cuyos comentarios sean obtenidos ejecutando el método <code>comments</code> y encadenando condiciones en la consulta:</p> <div class="language-php extra-class"><pre v-pre class="language-php"><code><span class="token variable">$comment</span> <span class="token operator">=</span> App\<span class="token package">Post</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">comments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'title'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'foo'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Igual que el método <code>hasOne</code>, también puedes sobrescribir las claves foráneas y locales al pasar argumentos adicionales al método <code>hasMany</code>:</p> <div class="language-php extra-class"><pre v-pre class="language-php"><code><span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">hasMany</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'App\Comment'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'foreign_key'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">hasMany</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'App\Comment'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'foreign_key'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'local_key'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><a name="one-to-many-inverse"></a></p> <h3 id="uno-a-muchos-inverso"><a class="header-anchor" href="#uno-a-muchos-inverso" aria-hidden="true">#</a> Uno A Muchos (inverso)</h3> <p>Ahora que puedes acceder a todos los comentarios de un post, vamos a definir una relación para permitir a un comentario acceder a su post padre. Para definir el inverso de una relación <code>hasMany</code>, define una función de relación en el modelo hijo que ejecute el método <code>belongsTo</code>:</p> <div class="language-php extra-class"><pre v-pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Comment</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * Get the post that owns the comment.
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">post</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">belongsTo</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'App\Post'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p>Una vez que la relación ha sido definida, podemos obtener el modelo <code>Post</code> para un <code>Comment</code> accediendo a la &quot;propiedad dinámica&quot; de <code>post</code>:</p> <div class="language-php extra-class"><pre v-pre class="language-php"><code><span class="token variable">$comment</span> <span class="token operator">=</span> App\<span class="token package">Comment</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">echo</span> <span class="token variable">$comment</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">post</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">title</span><span class="token punctuation">;</span>
</code></pre></div><p>En el ejemplo anterior, Eloquent tratará de hacer coincidir el <code>post_id</code> del modelo <code>Comment</code> con un <code>id</code> en el modelo <code>Post</code>. Eloquent determina el nombre de la clave foránea por defecto, examinando el nombre del método de la relación y agregando un sufijo <code>_</code> al nombre del método, seguido del nombre de la columna principal de la llave. Sin embargo, si la clave foránea en el modelo <code>Comment</code> no es <code>post_id</code>, puedes pasar un nombre de clave personalizado como segundo argumento al método <code>belongsTo</code>:</p> <div class="language-php extra-class"><pre v-pre class="language-php"><code><span class="token comment">/**
* Get the post that owns the comment.
*/</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">post</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">belongsTo</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'App\Post'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'foreign_key'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Si tu modelo padre no usa <code>id</code> como su clave primaria, o deseas hacer join al modelo hijo con una columna diferente, puedes pasar un tercer argumento al método <code>belongsTo</code> especificando la clave personalizada de tu tabla padre.</p> <div class="language-php extra-class"><pre v-pre class="language-php"><code><span class="token comment">/**
* Get the post that owns the comment.
*/</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">post</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">belongsTo</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'App\Post'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'foreign_key'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'other_key'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><a name="many-to-many"></a></p> <h3 id="muchos-a-muchos"><a class="header-anchor" href="#muchos-a-muchos" aria-hidden="true">#</a> Muchos A Muchos</h3> <p>Las relaciones de muchos-a-muchos son ligeramente más complicadas que las relaciones <code>hasOne</code> y <code>hasMany</code>. Un ejemplo de tal relación es un usuario con muchos roles, donde los roles también son compartidos por otros usuarios. Por ejemplo, muchos usuarios pueden tener el rol &quot;Admin&quot;. Para definir esta relación, tres tablas de bases de datos son necesitadas: <code>users</code>, <code>roles</code>, y <code>role_user</code>. La tabla <code>role_user</code> es derivada del orden alfabético de los nombres de modelo relacionados y contiene las columnas <code>user_id</code> y <code>role_id</code>.</p> <p>Las relaciones de muchos-a-muchos son definidas escribiendo un método que devuelve el resultado del método <code>belongsToMany</code>. Por ejemplo, vamos a definir el método <code>roles</code> en nuestro modelo <code>User</code>:</p> <div class="language-php extra-class"><pre v-pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * The roles that belong to the user.
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">roles</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">belongsToMany</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'App\Role'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p>Una vez que la relación es definida, puedes acceder a los roles del usuario usando la propiedad dinámica <code>roles</code>:</p> <div class="language-php extra-class"><pre v-pre class="language-php"><code><span class="token variable">$user</span> <span class="token operator">=</span> App\<span class="token package">User</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">roles</span> <span class="token keyword">as</span> <span class="token variable">$role</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Como con los otros tipos de relación, puedes ejecutar el método <code>roles</code> para continuar encadenando las restricciones de consulta en la relación:</p> <div class="language-php extra-class"><pre v-pre class="language-php"><code><span class="token variable">$roles</span> <span class="token operator">=</span> App\<span class="token package">User</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">roles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">orderBy</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'name'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Como mencionamos previamente, para determinar el nombre de la tabla asociativa, Eloquent juntará los dos nombres de modelo en orden alfabético. Sin embargo, eres libre de sobrescribir esta convención. Puedes hacer eso pasando un segundo argumento al método <code>belongsToMany</code>:</p> <div class="language-php extra-class"><pre v-pre class="language-php"><code><span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">belongsToMany</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'App\Role'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'role_user'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Además de personalizar el nombre de la tabla asociativa, también puedes personalizar los nombres de columna de las claves en la tabla pasando argumentos adicionales al método <code>belongsToMany</code>. El tercer argumento es el nombre de clave foránea del modelo en el cual estás definiendo la relación, mientras el cuarto argumento es el nombre de la clave foránea del modelo que estás asociando:</p> <div class="language-php extra-class"><pre v-pre class="language-php"><code><span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">belongsToMany</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'App\Role'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'role_user'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'user_id'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'role_id'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="definiendo-el-inverso-de-la-relacion-2"><a class="header-anchor" href="#definiendo-el-inverso-de-la-relacion-2" aria-hidden="true">#</a> Definiendo El Inverso De La Relación</h4> <p>Para definir el inverso de una relación de muchos-a-muchos, puedes colocar otra llamada de <code>belongsToMany</code> en tu modelo relacionado. Para continuar con nuestro ejemplo de roles de usuario, vamos a definir el método <code>users</code> en el modelo <code>Role</code>:</p> <div class="language-php extra-class"><pre v-pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Role</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * The users that belong to the role.
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">users</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">belongsToMany</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'App\User'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p>Como puedes ver, la relación es definida exactamente de la misma forma que su contraparte <code>User</code>, con la excepción de que referencia al modelo <code>App\User</code>. Ya que estamos reusando el método <code>belongsToMany</code>, todas las tablas y opciones de personalización de claves usuales están disponibles al momento de definir el inverso de las relaciones de muchos-a-muchos.</p> <h4 id="obteniendo-columnas-de-tablas-intermedias-pivote"><a class="header-anchor" href="#obteniendo-columnas-de-tablas-intermedias-pivote" aria-hidden="true">#</a> Obteniendo Columnas De Tablas Intermedias (Pivote)</h4> <p>Como ya has aprendido, trabajar con relaciones de muchos-a-muchos requiere la presencia de una tabla intermedia o pivote. Eloquent proporciona algunas formas muy útiles de interactuar con esta tabla. Por ejemplo, vamos a asumir que nuestro objeto <code>User</code> tiene muchos objetos <code>Role</code> al que está relacionado. Después de acceder a esta relación, podemos acceder a la tabla intermedia usando el atributo <code>pivot</code> en los modelos:</p> <div class="language-php extra-class"><pre v-pre class="language-php"><code><span class="token variable">$user</span> <span class="token operator">=</span> App\<span class="token package">User</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">roles</span> <span class="token keyword">as</span> <span class="token variable">$role</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">echo</span> <span class="token variable">$role</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">pivot</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">created_at</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Ten en cuenta que a cada modelo <code>Role</code> que obtenemos se le asigna automáticamente un atributo <code>pivot</code>. Este atributo contiene un modelo que representa la tabla intermedia y puede ser usado como cualquier otro modelo de Eloquent.</p> <p>De forma predeterminada, solo las claves del modelo estarán presentes en el objeto <code>pivot</code>. Si tu tabla pivote contiene atributos extras, debes especificarlos cuando definas la relación.</p> <div class="language-php extra-class"><pre v-pre class="language-php"><code><span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">belongsToMany</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'App\Role'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">withPivot</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'column1'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'column2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Si quieres que tu tabla pivote automáticamente mantenga las marcas de tiempo <code>created_at</code> y <code>updated_at</code>, usa el método <code>withTimestamps</code> en la definición de la relación:</p> <div class="language-php extra-class"><pre v-pre class="language-php"><code><span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">belongsToMany</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'App\Role'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">withTimestamps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="personalizando-el-nombre-del-atributo-pivot"><a class="header-anchor" href="#personalizando-el-nombre-del-atributo-pivot" aria-hidden="true">#</a> Personalizando El Nombre Del Atributo <code>pivot</code></h4> <p>Como se señaló anteriormente, los atributos de la tabla intermedia pueden ser accedidos en modelos usando el atributo <code>pivot</code>. Sin embargo, eres libre de personalizar el nombre de este atributo para que refleje mejor su propósito dentro de tu aplicación.</p> <p>Por ejemplo, si tu aplicación contiene usuarios que pueden suscribirse a podcasts, probablemente tengas una relación de muchos-a-muchos entre usuarios y podcasts. Si éste es el caso, puedes desear renombrar tu tabla pivote intermedia como <code>subscription</code> en lugar de <code>pivot</code>. Esto puede ser hecho usando el método <code>as</code> al momento de definir la relación:</p> <div class="language-php extra-class"><pre v-pre class="language-php"><code><span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">belongsToMany</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'App\Podcast'</span><span class="token punctuation">)</span>
                <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token keyword">as</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'subscription'</span><span class="token punctuation">)</span>
                <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">withTimestamps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Una vez hecho esto, puedes acceder a los datos de la tabla intermedia usando el nombre personalizado:</p> <div class="language-php extra-class"><pre v-pre class="language-php"><code><span class="token variable">$users</span> <span class="token operator">=</span> User<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">with</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'podcasts'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$users</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">flatMap</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">podcasts</span> <span class="token keyword">as</span> <span class="token variable">$podcast</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">echo</span> <span class="token variable">$podcast</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">subscription</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">created_at</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="filtrando-relaciones-a-traves-de-columnas-de-tablas-intermedias"><a class="header-anchor" href="#filtrando-relaciones-a-traves-de-columnas-de-tablas-intermedias" aria-hidden="true">#</a> Filtrando Relaciones A Través De Columnas De Tablas Intermedias</h4> <p>También puedes filtrar los resultados devueltos por <code>belongsToMany</code> usando los métodos <code>wherePivot</code> y <code>wherePivotIn</code> al momento de definir la relación:</p> <div class="language-php extra-class"><pre v-pre class="language-php"><code><span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">belongsToMany</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'App\Role'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">wherePivot</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'approved'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">belongsToMany</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'App\Role'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">wherePivotIn</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'priority'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><a name="defining-custom-intermediate-table-models"></a></p> <h3 id="definiendo-modelos-de-tabla-intermedia-personalizados"><a class="header-anchor" href="#definiendo-modelos-de-tabla-intermedia-personalizados" aria-hidden="true">#</a> Definiendo Modelos De Tabla Intermedia Personalizados</h3> <p>Si prefieres definir un modelo personalizado para representar la tabla intermedia o pivote de tu relación, puedes ejecutar el método <code>using</code> al momento de definir la relación. Los modelos de tablas intermedias de muchos-a-muchos personalizados deben extender la clase <code>Illuminate\Database\Eloquent\Relations\Pivot</code> mientras que los modelos polimórficos muchos-a-muchos deben extender la clase <code>Illuminate\Database\Eloquent\Relations\MorphPivot</code>. Por ejemplo, podemos definir un <code>Role</code> que use un modelo pivote <code>RoleUser</code> personalizado:</p> <div class="language-php extra-class"><pre v-pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Role</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * The users that belong to the role.
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">users</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">belongsToMany</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'App\User'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">using</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'App\RoleUser'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p>Al momento de definir el modelo <code>RoleUser</code>, extenderemos la clase <code>Pivot</code>:</p> <div class="language-php extra-class"><pre v-pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Relations<span class="token punctuation">\</span>Pivot</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">RoleUser</span> <span class="token keyword">extends</span> <span class="token class-name">Pivot</span>
<span class="token punctuation">{</span>
    <span class="token comment">//</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p>Puedes combinar <code>using</code> y <code>withPivot</code> para retornar columnas de la tabla intermedia. Por ejemplo, puedes retornar las columnas <code>created_by</code> y <code>updated_by</code> desde la tabla pivote <code>RoleUser</code> pasando los nombres de las columnas al método <code>withPivot</code>:</p> <div class="language-php extra-class"><pre v-pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Role</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * The users that belong to the role.
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">users</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">belongsToMany</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'App\User'</span><span class="token punctuation">)</span>
                        <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">using</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'App\RoleUser'</span><span class="token punctuation">)</span>
                        <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">withPivot</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
                            <span class="token single-quoted-string string">'created_by'</span><span class="token punctuation">,</span>
                            <span class="token single-quoted-string string">'updated_by'</span>
                        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><div class="danger custom-block"><p class="custom-block-title">Nota</p> <p><strong>Nota:</strong> Los modelos Pivot no pueden usar el trait <code>SoftDeletes</code>. Si necesitas hacer soft delete de registros pivot considera convertir tu modelo pivot a un modelo de Eloquent.</p></div></div> <h4 id="modelos-de-pivote-personalizados-e-ids-incrementales"><a href="#modelos-de-pivote-personalizados-e-ids-incrementales" aria-hidden="true" class="header-anchor">#</a> Modelos De Pivote Personalizados E IDs Incrementales</h4> <p>Si has definido una relación de muchos a muchos que usa un modelo de pivote personalizado, y ese modelo de pivote tiene una clave primaria de incremento automático, debes asegurarte de que su clase de modelo de pivote personalizado defina una propiedad <code>incrementing</code> que se establece en<code>true</code>.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">/**
* Indicates if the IDs are auto-incrementing.
*
* @var bool
*/</span>
<span class="token keyword">public</span> <span class="token variable">$incrementing</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
</code></pre></div><p><a name="has-one-through"></a></p> <h3 id="tiene-uno-a-traves-de-hasonethrough"><a href="#tiene-uno-a-traves-de-hasonethrough" aria-hidden="true" class="header-anchor">#</a> Tiene Uno A Través De (hasOneThrough)</h3> <p>La relación &quot;tiene uno a través&quot; vincula los modelos a través de una única relación intermedia.
Por ejemplo, si cada proveedor (supplier) tiene un usuario (user) y cada usuario está asociado con un registro del historial (history) de usuarios, entonces el modelo del proveedor puede acceder al historial del usuario <em>a través</em> del usuario. Veamos las tablas de base de datos necesarias para definir esta relación:</p> <div class="language-php extra-class"><pre class="language-php"><code>users
    id <span class="token operator">-</span> integer
    supplier_id <span class="token operator">-</span> integer

suppliers
    id <span class="token operator">-</span> integer

history
    id <span class="token operator">-</span> integer
    user_id <span class="token operator">-</span> integer
</code></pre></div><p>Aunque la tabla <code>history</code> no contiene una columna<code>supplier_id</code>, la relación <code>hasOneThrough</code> puede proporcionar acceso al historial del usuario desde el modelo del proveedor. Ahora que hemos examinado la estructura de la tabla para la relación, vamos a definirla en el modelo <code>Supplier</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Supplier</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * Get the user's history.
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">userHistory</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">hasOneThrough</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'App\History'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'App\User'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p>El primer argumento pasado al método <code>hasOneThrough</code> es el nombre del modelo final al que queremos acceder, mientras que el segundo argumento es el nombre del modelo intermedio.</p> <p>Se utilizarán las convenciones típicas de clave foránea de Eloquent al realizar las consultas de la relación. Si deseas personalizar las claves de la relación, puedes pasarlas como el tercer y cuarto argumento al método <code>hasOneThrough</code>. El tercer argumento es el nombre de la clave foránea en el modelo intermedio. El cuarto argumento es el nombre de la clave foránea en el modelo final. El quinto argumento es la clave local, mientras que el sexto argumento es la clave local del modelo intermedio:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">class</span> <span class="token class-name">Supplier</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * Get the user's history.
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">userHistory</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">hasOneThrough</span><span class="token punctuation">(</span>
            <span class="token single-quoted-string string">'App\History'</span><span class="token punctuation">,</span>
            <span class="token single-quoted-string string">'App\User'</span><span class="token punctuation">,</span>
            <span class="token single-quoted-string string">'supplier_id'</span><span class="token punctuation">,</span> <span class="token comment">// Foreign key on users table...</span>
            <span class="token single-quoted-string string">'user_id'</span><span class="token punctuation">,</span> <span class="token comment">// Foreign key on history table...</span>
            <span class="token single-quoted-string string">'id'</span><span class="token punctuation">,</span> <span class="token comment">// Local key on suppliers table...</span>
            <span class="token single-quoted-string string">'id'</span> <span class="token comment">// Local key on users table...</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>   
</code></pre></div><p><a name="has-many-through"></a></p> <h3 id="tiene-muchos-a-traves-de-hasmanythrough"><a href="#tiene-muchos-a-traves-de-hasmanythrough" aria-hidden="true" class="header-anchor">#</a> Tiene Muchos A Través De (hasManyThrough)</h3> <p>La relación &quot;tiene-muchos-a-través-de&quot; proporciona una abreviación conveniente para acceder a relaciones distantes por medio de una relación intermedia. Por ejemplo, un modelo <code>Country</code> podría tener muchos modelos <code>Post</code> a través de un modelo <code>User</code> intermedio. En este ejemplo, podrías traer todos los posts de un blog para un país dado. Vamos a buscar las tablas requeridas para definir esta relación:</p> <div class="language-php extra-class"><pre class="language-php"><code>countries
    id <span class="token operator">-</span> integer
    name <span class="token operator">-</span> string

users
    id <span class="token operator">-</span> integer
    country_id <span class="token operator">-</span> integer
    name <span class="token operator">-</span> string

posts
    id <span class="token operator">-</span> integer
    user_id <span class="token operator">-</span> integer
    title <span class="token operator">-</span> string
</code></pre></div><p>Aunque los <code>posts</code> no contienen una columna <code>country_id</code>, la relación <code>hasManyThrough</code> proporciona acceso a los posts de un país por medio de <code>$country-&gt;posts</code>. Para ejecutar esta consulta, Eloquent inspecciona el <code>country_id</code> de la tabla intermedia <code>users</code>. Después de encontrar los ID de usuario que coincidan, serán usados para consultar la tabla <code>posts</code>.</p> <p>Ahora que hemos examinado la estructura de la tabla para la relación, vamos a definirla en el modelo <code>Country</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Country</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * Get all of the posts for the country.
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">posts</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">hasManyThrough</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'App\Post'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'App\User'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p>El primer argumento pasado al método <code>hasManyThrough</code> es el nombre del modelo final que deseamos acceder, mientras que el segundo argumento es el nombre del modelo intermedio.</p> <p>Las convenciones de clave foránea típicas de Eloquent serán usadas al momento de ejecutar las consultas de la relación. Si prefieres personalizar las claves de la relación, puedes pasarlos como tercer y cuarto argumentos del método <code>hasManyThrough</code>. El tercer argumento es el nombre de la clave foránea en el modelo intermedio. El cuarto argumento es el nombre de la clave foránea en el modelo final. El quinto argumento es la clave local, mientras el sexto argumento es la clave local del modelo intermedio:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">class</span> <span class="token class-name">Country</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">posts</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">hasManyThrough</span><span class="token punctuation">(</span>
            <span class="token single-quoted-string string">'App\Post'</span><span class="token punctuation">,</span>
            <span class="token single-quoted-string string">'App\User'</span><span class="token punctuation">,</span>
            <span class="token single-quoted-string string">'country_id'</span><span class="token punctuation">,</span> <span class="token comment">// Foreign key on users table...</span>
            <span class="token single-quoted-string string">'user_id'</span><span class="token punctuation">,</span> <span class="token comment">// Foreign key on posts table...</span>
            <span class="token single-quoted-string string">'id'</span><span class="token punctuation">,</span> <span class="token comment">// Local key on countries table...</span>
            <span class="token single-quoted-string string">'id'</span> <span class="token comment">// Local key on users table...</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><a name="polymorphic-relationships"></a></p> <h2 id="relaciones-polimorficas"><a href="#relaciones-polimorficas" aria-hidden="true" class="header-anchor">#</a> Relaciones Polimórficas</h2> <p>Una relación polimórfica permite que el modelo objetivo pertenezca a más de un tipo de modelo usando una sola asociación.</p> <p><a name="one-to-one-polymorphic-relations"></a></p> <h3 id="una-a-una-polimorfica"><a href="#una-a-una-polimorfica" aria-hidden="true" class="header-anchor">#</a> Una A Una (Polimórfica)</h3> <h4 id="estructura-de-tabla"><a href="#estructura-de-tabla" aria-hidden="true" class="header-anchor">#</a> Estructura De Tabla</h4> <p>Una relación polimorfica de uno-a-uno es similar a una relación de uno-a-uno simple; sin embargo, el modelo objetivo puede pertenecer a más de un tipo de modelo en una sola asociación. Por ejemplo, un <code>Post</code> de un blog y un <code>User</code> pueden compartir una relación polimórfica con un modelo <code>Image</code>. Usando una relación polimórfica de uno-a-uno te permite tener una sola lista de imagenes únicas que son usadas tanto los posts del blog como por las cuentas de los usuarios. Primero, vamos a examinar la estructura de la tabla:</p> <div class="language-php extra-class"><pre class="language-php"><code>posts
    id <span class="token operator">-</span> integer
    name <span class="token operator">-</span> string

users
    id <span class="token operator">-</span> integer
    name <span class="token operator">-</span> string

images
    id <span class="token operator">-</span> integer
    url <span class="token operator">-</span> string
    imageable_id <span class="token operator">-</span> integer
    imageable_type <span class="token operator">-</span> string
</code></pre></div><p>Observa las columnas <code>imageable_id</code> y <code>imageable_type</code> en la tabla <code>images</code>. La columna <code>imageable_id</code> contendrá el valor del ID del post o el usuario, mientras que la columna <code>imageable_type</code> contendrá el nombre de clase del modelo padre. La columna <code>imageable_type</code> es usada por Eloquent para determinar cuál &quot;tipo&quot; de modelo padre retornar al acceder a la relación <code>imageable</code>.</p> <h4 id="estructura-del-modelo"><a href="#estructura-del-modelo" aria-hidden="true" class="header-anchor">#</a> Estructura Del Modelo</h4> <p>A continuación, vamos a examinar las definiciones de modelo necesarias para construir esta relación:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Image</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * Get all of the owning imageable models.
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">imageable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">morphTo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Post</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * Get the post's image.
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">image</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">morphOne</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'App\Image'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'imageable'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * Get the user's image.
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">image</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">morphOne</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'App\Image'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'imageable'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><h4 id="retornando-la-relacion"><a href="#retornando-la-relacion" aria-hidden="true" class="header-anchor">#</a> Retornando La Relación</h4> <p>Una vez que tu base de datos y modelos son definidos, puedes acceder a las relaciones mediante tus modelos. Por ejemplo, para retornar la imagen para un post, podemos usar la propiedad dinámica <code>image</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$post</span> <span class="token operator">=</span> App\<span class="token package">Post</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$image</span> <span class="token operator">=</span> <span class="token variable">$post</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">image</span><span class="token punctuation">;</span>
</code></pre></div><p>Puedes también retornar el padre del modelo polimórfico accediendo al nombre del método que realiza la llamada a <code>morphTo</code>. En nuestro caso, éste es el método <code>imageable</code> en el modelo <code>Image</code>. Entonces, accederemos al método como una propiedad dinámica:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$image</span> <span class="token operator">=</span> App\<span class="token package">Image</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$imageable</span> <span class="token operator">=</span> <span class="token variable">$image</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">imageable</span><span class="token punctuation">;</span>
</code></pre></div><p>La relación <code>imageable</code> en el modelo <code>Image</code> retornar ya sea una instancia de <code>Post</code> o <code>User</code>, dependiendo del tipo de modelo que posea la imagen.</p> <p><a name="one-to-many-polymorphic-relations"></a></p> <h3 id="uno-a-muchos-polimorfica"><a href="#uno-a-muchos-polimorfica" aria-hidden="true" class="header-anchor">#</a> Uno A Muchos (Polimórfica)</h3> <h4 id="estructura-de-tabla-2"><a href="#estructura-de-tabla-2" aria-hidden="true" class="header-anchor">#</a> Estructura De Tabla</h4> <p>Una relación polimórfica de uno-a-muchos es similar a una relación de uno-a-muchos sencilla; sin embargo, el modelo objetivo puede pertenecer a más de un tipo de modelo en una sola asociación. Por ejemplo, imagina que usuarios de tu aplicación pueden comentar tanto en posts como en videos. Usando relaciones polimórficas, puedes usar una sola tabla <code>comments</code> para ambos escenarios. Primero, vamos a examinar la estructura de tabla requerida para esta relación:</p> <div class="language-php extra-class"><pre class="language-php"><code>posts
    id <span class="token operator">-</span> integer
    title <span class="token operator">-</span> string
    body <span class="token operator">-</span> text

videos
    id <span class="token operator">-</span> integer
    title <span class="token operator">-</span> string
    url <span class="token operator">-</span> string

comments
    id <span class="token operator">-</span> integer
    body <span class="token operator">-</span> text
    commentable_id <span class="token operator">-</span> integer
    commentable_type <span class="token operator">-</span> string
</code></pre></div><h4 id="estructura-de-modelo"><a href="#estructura-de-modelo" aria-hidden="true" class="header-anchor">#</a> Estructura De Modelo</h4> <p>A continuación, vamos a examinar las definiciones de modelos necesarias para construir esta relación:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Comment</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * Get all of the owning commentable models.
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">commentable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">morphTo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Post</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * Get all of the post's comments.
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">comments</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">morphMany</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'App\Comment'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'commentable'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Video</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * Get all of the video's comments.
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">comments</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">morphMany</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'App\Comment'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'commentable'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><h4 id="retornando-la-relacion-2"><a href="#retornando-la-relacion-2" aria-hidden="true" class="header-anchor">#</a> Retornando La Relación</h4> <p>Una vez que tu base de datos y modelos son definidos, puedes acceder a las relaciones mediante tus modelos. Por ejemplo, para acceder a todos los comentarios de un post podemos usar la propiedad dinámica <code>comments</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$post</span> <span class="token operator">=</span> App\<span class="token package">Post</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$post</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">comments</span> <span class="token keyword">as</span> <span class="token variable">$comment</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//</span>
<span class="token punctuation">}</span>
</code></pre></div><p>También puedes retornar al propietario de una relación polimórfica desde un modelo polimórfico accediendo al nombre del método que realiza la llamada a <code>morphTo</code>. En nuestro caso, éste es el método <code>commentable</code> en el modelo <code>Comment</code>. Así que, accederemos a dicho método como una propiedad dinámica:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$comment</span> <span class="token operator">=</span> App\<span class="token package">Comment</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$commentable</span> <span class="token operator">=</span> <span class="token variable">$comment</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">commentable</span><span class="token punctuation">;</span>
</code></pre></div><p>La relación <code>commentable</code> en el modelo <code>Comment</code> retornará ya sea una instancia <code>Post</code> o <code>Video</code>, dependiendo de qué tipo de modelo es el propietario del comentario.</p> <p><a name="many-to-many-polymorphic-relations"></a></p> <h3 id="muchos-a-muchos-polimorfica"><a href="#muchos-a-muchos-polimorfica" aria-hidden="true" class="header-anchor">#</a> Muchos A Muchos (Polimórfica)</h3> <h4 id="estructura-de-tabla-3"><a href="#estructura-de-tabla-3" aria-hidden="true" class="header-anchor">#</a> Estructura De Tabla</h4> <p>Las relaciones polimórficas de muchos-a-muchos son un poco más complicadas que las relaciones <code>morphOne</code> y <code>morphMany</code>. Por ejemplo, un modelo <code>Post</code> de un blog y un modelo <code>Video</code> pueden compartir una relación polimórfica con un modelo <code>Tag</code>. Usando una relación polimórfica de muchos-a-muchos te permite tener una única lista de etiquetas que son compartidas a través de posts y videos. Primero, vamos a examinar la estructura de tabla:</p> <div class="language-php extra-class"><pre class="language-php"><code>posts
    id <span class="token operator">-</span> integer
    name <span class="token operator">-</span> string

videos
    id <span class="token operator">-</span> integer
    name <span class="token operator">-</span> string

tags
    id <span class="token operator">-</span> integer
    name <span class="token operator">-</span> string

taggables
    tag_id <span class="token operator">-</span> integer
    taggable_id <span class="token operator">-</span> integer
    taggable_type <span class="token operator">-</span> string
</code></pre></div><h4 id="estructura-del-modelo-2"><a href="#estructura-del-modelo-2" aria-hidden="true" class="header-anchor">#</a> Estructura Del Modelo</h4> <p>Seguidamente, estamos listos para definir las relaciones en el modelo. Ambos modelos <code>Post</code> y <code>Video</code> tendrán un método <code>tags</code> que ejecuta el método <code>morphToMany</code> en la clase base de Eloquent:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Post</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * Get all of the tags for the post.
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">tags</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">morphToMany</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'App\Tag'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'taggable'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><h4 id="definiendo-el-inverso-de-la-relacion-3"><a href="#definiendo-el-inverso-de-la-relacion-3" aria-hidden="true" class="header-anchor">#</a> Definiendo El Inverso De La Relación</h4> <p>A continuación, en el modelo <code>Tag</code>, debes definir un método para cada uno de sus modelos relacionados. Así, para este ejemplo, definiremos un método <code>posts</code> y un método <code>videos</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Tag</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * Get all of the posts that are assigned this tag.
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">posts</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">morphedByMany</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'App\Post'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'taggable'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
    * Get all of the videos that are assigned this tag.
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">videos</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">morphedByMany</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'App\Video'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'taggable'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><h4 id="obteniendo-la-relacion"><a href="#obteniendo-la-relacion" aria-hidden="true" class="header-anchor">#</a> Obteniendo La Relación</h4> <p>Una vez que tu tabla en la base de datos y modelos son definidos, puedes acceder las relaciones por medio de tus modelos. Por ejemplo, para acceder a todos los tags de un post, puedes usar la propiedad dinámica <code>tags</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$post</span> <span class="token operator">=</span> App\<span class="token package">Post</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$post</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">tags</span> <span class="token keyword">as</span> <span class="token variable">$tag</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//</span>
<span class="token punctuation">}</span>
</code></pre></div><p>También puedes obtener el propietario de una relación polimórfica desde el modelo polimórfico accediendo al nombre del método que ejecutó la llamada a <code>morphedByMany</code>. En nuestro caso, estos son los métodos <code>posts</code> o <code>videos</code> en el modelo <code>Tag</code>. Así, accederemos a esos métodos como propiedades dinámicas:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$tag</span> <span class="token operator">=</span> App\<span class="token package">Tag</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$tag</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">videos</span> <span class="token keyword">as</span> <span class="token variable">$video</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//</span>
<span class="token punctuation">}</span>
</code></pre></div><p><a name="custom-polymorphic-types"></a></p> <h3 id="tipos-polimorficos-personalizados"><a href="#tipos-polimorficos-personalizados" aria-hidden="true" class="header-anchor">#</a> Tipos Polimórficos Personalizados</h3> <p>Por defecto, Laravel usará el nombre completo de clase para almacenar el tipo del modelo relacionado. Por ejemplo, dado el ejemplo uno-a-muchos de arriba donde un <code>Comment</code> puede pertenecer a un <code>Post</code> o a un <code>Video</code>, el <code>commentable_type</code> por defecto será <code>App\Post</code> o <code>App\Video</code>, respectivamente. Sin embargo, puedes querer desacoplar tu base de datos de la estructura interna de tu aplicación. En dicho caso, puedes definir un &quot;mapa de morfología (morph map)&quot; para indicarle a Eloquent que use un nombre personalizado para cada modelo en lugar del nombre de la clase:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Relations<span class="token punctuation">\</span>Relation</span><span class="token punctuation">;</span>

Relation<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">morphMap</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token single-quoted-string string">'posts'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'App\Post'</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'videos'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'App\Video'</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Puedes registar el <code>morphMap</code> en la función <code>boot</code> de tu <code>AppServiceProvider</code> o crear un proveedor de servicios separado si lo deseas.</p> <p><a name="querying-relations"></a></p> <h2 id="consultando-relaciones"><a href="#consultando-relaciones" aria-hidden="true" class="header-anchor">#</a> Consultando Relaciones</h2> <p>Ya que todos los tipos de relaciones Eloquent son definidas por medio de métodos, puedes ejecutar esos métodos para obtener una instancia de la relación sin ejecutar realmente las consultas de la relación. Además, todos los tipos de relaciones Eloquent también sirven como <a href="/docs/%7B%7Bversion%7D%7D/queries">constructores de consultas</a>, permitiendo que continues encadenando restricciones dentro de la consulta de la relación antes de ejecutar finalmente el SQL contra la base de datos.</p> <p>Por ejemplo, imagina un sistema de blog en el cual un modelo <code>User</code> tiene muchos modelos <code>Post</code> asociados:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * Get all of the posts for the user.
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">posts</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">hasMany</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'App\Post'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p>Puedes consultar la relación <code>posts</code> y agregar limitaciones a la relación de la siguiente forma:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$user</span> <span class="token operator">=</span> App\<span class="token package">User</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">posts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'active'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Puedes usar cualquiera de los métodos de <a href="/docs/%7B%7Bversion%7D%7D/queries">constructor de consultas</a> y así que asegúrate de revisar la documentación del constructor de consultas para aprender sobre todos los métodos disponibles.</p> <h4 id="encadenando-clausulas-orwhere-en-relaciones"><a href="#encadenando-clausulas-orwhere-en-relaciones" aria-hidden="true" class="header-anchor">#</a> Encadenando Cláusulas <code>orWhere</code> En Relaciones</h4> <p>Como se demostró en el ejemplo superior, eres libre de agregar restriciones adicionales a las relaciones al momento de realizar peticiones. Sin embargo, ten cuidado al encadenar cláusulas <code>orWhere</code> a una relación, dado que las cláusulas <code>orWhere</code> serán agrupadas lógicamente en el mismo nivel que la restricción de la relación:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">posts</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'active'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">orWhere</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'votes'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'&gt;='</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>
        <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// select * from posts </span>
<span class="token comment">// where user_id = ? and active = 1 or votes &gt;= 100</span>
</code></pre></div><p>En la mayoria de los casos, probablemente pretendes usar <a href="/docs/%7B%7Bversion%7D%7D/queries#parameter-grouping">grupos de restricciones</a> para agrupar logicamente las comprobaciones condicionales entre parentisis:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">posts</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$query</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token variable">$query</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'active'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
                            <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">orWhere</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'votes'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'&gt;='</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// select * from posts </span>
<span class="token comment">// where user_id = ? and (active = 1 or votes &gt;= 100)</span>
</code></pre></div><p><a name="relationship-methods-vs-dynamic-properties"></a></p> <h3 id="metodos-de-relacion-vs-propiedades-dinamicas"><a href="#metodos-de-relacion-vs-propiedades-dinamicas" aria-hidden="true" class="header-anchor">#</a> Métodos De Relación Vs. Propiedades Dinámicas</h3> <p>Si no necesitas agregar restricciones adicionales a una consulta de relación de Eloquent, puedes acceder a la relación como si fuera una propiedad. Por ejemplo, continuando con el uso de nuestros modelos de ejemplo <code>User</code> y <code>Post</code>, podemos acceder a todos los posts de un usuario como sigue:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$user</span> <span class="token operator">=</span> App\<span class="token package">User</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">posts</span> <span class="token keyword">as</span> <span class="token variable">$post</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Las propiedades dinámicas son de &quot;carga diferida (lazy loading)&quot;, lo que significa que cargarán solamente los datos de su relación cuando realmente accedas a ellas. Debido a esto, los desarrolladores con frecuencia usan <a href="#eager-loading">carga previa (eager loading)</a> para precargar las relaciones que ellos saben que serán accedidas después de cargar el modelo. La carga previa proporciona una reducción significativa en consultas SQL que deben ser ejecutadas para cargar las relaciones de un modelo.</p> <p><a name="querying-relationship-existence"></a></p> <h3 id="consultando-la-existencia-de-una-relacion"><a href="#consultando-la-existencia-de-una-relacion" aria-hidden="true" class="header-anchor">#</a> Consultando La Existencia De Una Relación</h3> <p>Cuando accedes a los registros de un modelo, puedes desear limitar sus resultados basados en la existencia de una relación. Por ejemplo, imagina que quieres obtener todos los posts de blog que tienen al menos un comentario. Para hacer eso, puedes pasar el nombre de la relación a los métodos <code>has</code> y <code>orHas</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">// Retrieve all posts that have at least one comment...</span>
<span class="token variable">$posts</span> <span class="token operator">=</span> App\<span class="token package">Post</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">has</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'comments'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>También puedes especificar un operador y la cantidad para personalizar aún más la consulta:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">// Retrieve all posts that have three or more comments...</span>
<span class="token variable">$App</span><span class="token operator">/</span>posts <span class="token operator">=</span> Post<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">has</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'comments'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'&gt;='</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Las instrucciones <code>has</code> anidadas también pueden ser construidas usando la notación de &quot;punto&quot;. Por ejemplo, puedes obtener todos los posts que tienen al menos un comentario con votos:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">// Retrieve posts that have at least one comment with votes...</span>
<span class="token variable">$App</span><span class="token operator">/</span>posts <span class="token operator">=</span> Post<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">has</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'comments.votes'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Incluso si necesitas más potencia, puedes usar los métodos <code>whereHas</code> y <code>orWhereHas</code> para poner condiciones &quot;where&quot; en tus consultas <code>has</code>. Estos métodos permiten que agregues restricciones personalizadas a una restricción de relación, tal como verificar el contenido de un comentario:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Builder</span><span class="token punctuation">;</span>

<span class="token comment">// Retrieve posts with at least one comment containing words like foo%</span>
<span class="token variable">$posts</span> <span class="token operator">=</span> App\<span class="token package">Post</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">whereHas</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'comments'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>Builder <span class="token variable">$query</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$query</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'content'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'like'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'foo%'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Retrieve posts with at least ten comments containing words like foo%</span>
<span class="token variable">$posts</span> <span class="token operator">=</span> App\<span class="token package">Post</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">whereHas</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'comments'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>Builder <span class="token variable">$query</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$query</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'content'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'like'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'foo%'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'&gt;='</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><a name="querying-relationship-absence"></a></p> <h3 id="consultando-la-ausencia-de-una-relacion"><a href="#consultando-la-ausencia-de-una-relacion" aria-hidden="true" class="header-anchor">#</a> Consultando La Ausencia De Una Relación</h3> <p>Al momento de acceder a los registros de un modelo, puedes desear limitar tus resultados en base a la ausencia de una relación. Por ejemplo, imagina que quieras obtener todos los posts de blogs que <strong>no</strong> tienen algún comentario. Para hacer eso, puedes pasar el nombre de la relación a los métodos <code>doesntHave</code> y <code>orDoesntHave</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$posts</span> <span class="token operator">=</span> App\<span class="token package">Post</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">doesntHave</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'comments'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Incluso si necesitas más potencia, puedes usar los métodos <code>whereDoesntHave</code> y <code>orWhereDoesntHave</code> para poner condiciones &quot;where&quot; en tus consultas <code>doesntHave</code>. Estos métodos permiten que agregues restricciones personalizadas a una restricción de relación, tal como verificar el contenido de un comentario:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Builder</span><span class="token punctuation">;</span>

<span class="token variable">$posts</span> <span class="token operator">=</span> Post<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">whereDoesntHave</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'comments'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>Builder <span class="token variable">$query</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$query</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'content'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'like'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'foo%'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Puedes usar notación &quot;de puntos&quot; para ejecutar una consulta contra una relación anidada. Por ejemplo, la siguiente consulta entregará todos los posts con comentarios de autores que no están vetados:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Builder</span><span class="token punctuation">;</span>

<span class="token variable">$posts</span> <span class="token operator">=</span> App\<span class="token package">Post</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">whereDoesntHave</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'comments.author'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>Builder <span class="token variable">$query</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$query</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'banned'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><a name="counting-related-models"></a></p> <h3 id="contando-modelos-relacionados"><a href="#contando-modelos-relacionados" aria-hidden="true" class="header-anchor">#</a> Contando Modelos Relacionados</h3> <p>Si quieres contar el número de resultados de una relación sin cargarlos realmente puedes usar el método <code>withCount</code>, el cual coloca una columna <code>{relation}_count</code> en tus modelos resultantes. Por ejemplo:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$posts</span> <span class="token operator">=</span> App\<span class="token package">Post</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">withCount</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'comments'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$posts</span> <span class="token keyword">as</span> <span class="token variable">$post</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">echo</span> <span class="token variable">$post</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">comments_count</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Puedes agregar las &quot;cuentas&quot; para múltiples relaciones así como también agregar restricciones a las consultas:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$posts</span> <span class="token operator">=</span> Post<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">withCount</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'votes'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'comments'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$query</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$query</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'content'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'like'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'foo%'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">echo</span> <span class="token variable">$posts</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">votes_count</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token variable">$posts</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">comments_count</span><span class="token punctuation">;</span>
</code></pre></div><p>También puedes poner un alias al resultado de la cuenta de la relación, permitiendo múltiples cuentas en la misma relación:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$posts</span> <span class="token operator">=</span> App<span class="token operator">/</span>post<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">withCount</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token single-quoted-string string">'comments'</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'comments as pending_comments_count'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$query</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$query</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'approved'</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">echo</span> <span class="token variable">$posts</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">comments_count</span><span class="token punctuation">;</span>

<span class="token keyword">echo</span> <span class="token variable">$posts</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">pending_comments_count</span><span class="token punctuation">;</span>
</code></pre></div><p>Si estás combinando <code>withCount</code> con una instrucción <code>select</code>, asegúrate de llamar a <code>withCount</code> después del método <code>select</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$posts</span> <span class="token operator">=</span> App\<span class="token package">Post</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'title'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'body'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">withCount</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'comments'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">echo</span> <span class="token variable">$posts</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">title</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token variable">$posts</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">body</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token variable">$posts</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">comments_count</span><span class="token punctuation">;</span>
</code></pre></div><p><a name="eager-loading"></a></p> <h2 id="carga-previa-eager-loading"><a href="#carga-previa-eager-loading" aria-hidden="true" class="header-anchor">#</a> Carga Previa (Eager Loading)</h2> <p>Al momento de acceder a las relaciones Eloquent como propiedades, los datos de la relación son &quot;cargados diferidamente (lazy loading)&quot;. Esto significa que los datos de la relación no son cargados realmente hasta que primero accedas a la propiedad. Sin embargo, Eloquent puede &quot;cargar previamente (eager loading)&quot; las relaciones al mismo tiempo que consultas el modelo padre. La carga previa alivia el problema de la consulta N + 1. Para ilustrar el problema de la consulta N + 1, considera un modelo <code>Book</code> que está relacionado a <code>Author</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Book</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * Get the author that wrote the book.
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">author</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">belongsTo</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'App\Author'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p>Ahora, vamos a obtener todos los libros y sus autores:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$books</span> <span class="token operator">=</span> App\<span class="token package">Book</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$books</span> <span class="token keyword">as</span> <span class="token variable">$book</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">echo</span> <span class="token variable">$book</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">author</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">name</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Este ciclo ejecutará una consulta para obtener todos los libros en la tabla, despues otra consulta para cada libro para obtener el autor. Así, si tenemos 25 libros, este ciclo debería ejecutar 26 consultas: 1 para el libro original y 25 consultas adicionales para obtener el autor de cada libro.</p> <p>Afortunadamente, podemos usar la carga previa para reducir esta operación a solo 2 consultas. Al momento de consultar, puedes especificar cuáles relaciones deberían ser precargadas usando el método <code>with</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$books</span> <span class="token operator">=</span> App\<span class="token package">Book</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">with</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'author'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$books</span> <span class="token keyword">as</span> <span class="token variable">$book</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">echo</span> <span class="token variable">$book</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">author</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">name</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Para esta operación, solo dos consultas serán ejecutadas:</p> <div class="language-php extra-class"><pre class="language-php"><code>select <span class="token operator">*</span> from books

select <span class="token operator">*</span> from authors where id in <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="carga-previa-de-multiples-relaciones"><a href="#carga-previa-de-multiples-relaciones" aria-hidden="true" class="header-anchor">#</a> Carga Previa De Múltiples Relaciones</h4> <p>Algunas veces puedes necesitar la carga previa de varias relaciones diferentes en una operación única. Para hacer eso, pasa sólo los argumentos adicionales al método <code>with</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$books</span> <span class="token operator">=</span> App\<span class="token package">Book</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">with</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'author'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'publisher'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="carga-previa-anidada"><a href="#carga-previa-anidada" aria-hidden="true" class="header-anchor">#</a> Carga Previa Anidada</h4> <p>Para precargar relaciones anidadas, puedes usar la sintaxis de &quot;punto&quot;. Por ejemplo, vamos a precargar todos los autores de los libros y todos los contactos personales del autor en una instrucción de Eloquent:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$books</span> <span class="token operator">=</span> App\<span class="token package">Book</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">with</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'author.contacts'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="cargando-previamente-columnas-especificas"><a href="#cargando-previamente-columnas-especificas" aria-hidden="true" class="header-anchor">#</a> Cargando previamente Columnas Específicas</h4> <p>No siempre necesitas todas las columna de las relaciones que estás obteniendo. Por esta razón, Eloquent te permite que especificar cuáles columnas de la relación te gustaría obtener:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$books</span> <span class="token operator">=</span> App\<span class="token package">Book</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">with</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'author:id,name'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="danger custom-block"><p class="custom-block-title">Nota</p> <p>Al momento de usar esta característica, siempre debes incluir la columna <code>id</code> en la lista de columnas que deseas obtener.</p></div> <p>Para relaciones &quot;tiene muchos&quot; necesitas especificar tanto <code>id</code> como <code>foreign_key</code></p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$books</span> <span class="token operator">=</span> App\<span class="token package">Book</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">with</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'chapter:id,book_id,name'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="danger custom-block"><p class="custom-block-title">Nota</p> <p>Al usar esta caracteristica, siempre debes incluir la columna <code>id</code> y cualquier columna de clave foranea relevante en la lista de columnas que deseas retornar.</p></div> <h4 id="carga-previa-por-defecto"><a href="#carga-previa-por-defecto" aria-hidden="true" class="header-anchor">#</a> Carga Previa Por Defecto</h4> <p>Algunas veces vas a querer cargar siempre algunas relaciones al retornar un modelo. Para lograr esto, puedes definir una propiedad <code>$with</code> en el modelo:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Book</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * Always load the related author when retrieving a book
    * The relationships that should always be loaded.
    *
    * @var array
    */</span>
    <span class="token keyword">protected</span> <span class="token variable">$with</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token single-quoted-string string">'author'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    
    <span class="token comment">/**
    * Get the author that wrote the book.
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">author</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">belongsTo</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'App\Author'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p>Si te gustaria remover un elemento de la propiedad <code>$with</code> para una sola petición, puedes usar el método <code>without</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$books</span> <span class="token operator">=</span> App\<span class="token package">Book</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">without</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'author'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><a name="constraining-eager-loads"></a></p> <h3 id="restringiendo-cargas-previas"><a href="#restringiendo-cargas-previas" aria-hidden="true" class="header-anchor">#</a> Restringiendo Cargas Previas</h3> <p>Algunas veces puedes desear cargar previamente una relación, pero también especificar condiciones de consulta para la consulta de carga previa. Aquí está un ejemplo:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$users</span> <span class="token operator">=</span> App\<span class="token package">User</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">with</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'posts'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$query</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$query</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'title'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'like'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'%first%'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>En este ejemplo, Eloquent solamente precargará los posts donde la columna <code>title</code> del post contenga la palabra <code>first</code>. Puedes ejecutar otros métodos del <a href="/docs/%7B%7Bversion%7D%7D/queries">constructor de consulta</a> para personalizar más la operación de carga previa:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$users</span> <span class="token operator">=</span> App\<span class="token package">User</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">with</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'posts'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$query</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$query</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">orderBy</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'created_at'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'desc'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="danger custom-block"><p class="custom-block-title">Nota</p> <p>Los métodos del constructor de consultas <code>limit</code> y <code>take</code> no se pueden usar al restringir las cargas previas.</p></div> <p><a name="lazy-eager-loading"></a></p> <h3 id="carga-previa-diferida-lazy-eager-loading"><a href="#carga-previa-diferida-lazy-eager-loading" aria-hidden="true" class="header-anchor">#</a> Carga Previa Diferida (Lazy Eager Loading)</h3> <p>Algunas veces puedes necesitar precargar una relación después de que el modelo padre ya ha sido obtenido. Por ejemplo, esto puede ser útil si necesitas decidir dinámicamente si se cargan modelos relacionados:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$books</span> <span class="token operator">=</span> App\<span class="token package">Book</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$someCondition</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$books</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'author'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'publisher'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Si necesitas establecer restricciones de consultas adicionales en la consulta de carga previa, puedes pasar un arreglo clave / valor con las relaciones que deseas cargar. Los valores del arreglo deberían ser instancias de <code>Closure</code>, las cuales reciben la instancia de consulta:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$books</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'author'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$query</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$query</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">orderBy</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'published_date'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'asc'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Para cargar una relación solo cuando aún no se ha cargado, usa el método <code>loadMissing</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">format</span><span class="token punctuation">(</span>Book <span class="token variable">$book</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token variable">$book</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">loadMissing</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'author'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token punctuation">[</span>
        <span class="token single-quoted-string string">'name'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$book</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">name</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'author'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$book</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">author</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">name</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="carga-previa-diferida-anidada-y-morphto"><a href="#carga-previa-diferida-anidada-y-morphto" aria-hidden="true" class="header-anchor">#</a> Carga Previa Diferida Anidada Y <code>morphTo</code></h4> <p>Si deseas cargar previamente una relación <code>morphTo</code>, así como relaciones anidadas en las diversas entidades que pueden ser devueltas por esa relación, puedes usar el método<code>loadMorph</code>.</p> <p>Este método acepta el nombre de la relación <code>morphTo</code> como su primer argumento, y un arreglo de pares modelo / relación como su segundo argumento. Para ayudar a ilustrar este método, consideremos el siguiente modelo:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">ActivityFeed</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * Get the parent of the activity feed record.
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">parentable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">morphTo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p>En este ejemplo, asumamos que los modelos <code>Event</code>, <code>Photo</code> y <code>Post</code> pueden crear modelos <code>ActivityFeed</code>. Además, supongamos que los modelos <code>Event</code> pertenecen a un modelo <code>Calendar</code>, los modelos <code>Photo</code> están asociados con los modelos <code>Tag</code> y los modelos <code>Post</code> pertenecen a un modelo<code>Author</code>.</p> <p>Usando estas definiciones y relaciones de modelo, podemos recuperar instancias de modelo <code>ActivityFeed</code> y cargar previamente todos los modelos <code>parentables</code> y sus respectivas relaciones anidadas:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$activities</span> <span class="token operator">=</span> ActivityFeed<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">with</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'parentable'</span><span class="token punctuation">)</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">loadMorph</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'parentable'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
        Event<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token single-quoted-string string">'calendar'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        Photo<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token single-quoted-string string">'tags'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        Post<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token single-quoted-string string">'author'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><a name="inserting-and-updating-related-models"></a></p> <h2 id="insertando-y-actualizando-modelos-relacionados"><a href="#insertando-y-actualizando-modelos-relacionados" aria-hidden="true" class="header-anchor">#</a> Insertando Y Actualizando Modelos Relacionados</h2> <p><a name="the-save-method"></a></p> <h3 id="el-metodo-save"><a href="#el-metodo-save" aria-hidden="true" class="header-anchor">#</a> El Método Save</h3> <p>Eloquent proporciona métodos convenientes para agregar nuevos modelos a las relaciones. Por ejemplo, quizá necesites insertar un nuevo <code>Comment</code> para un modelo <code>Post</code>. En lugar de establecer manualmente el atributo <code>post_id</code> en el <code>Comment</code>, puedes insertar el <code>Comment</code> directamente con el método <code>save</code> de la relación:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$comment</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">App<span class="token punctuation">\</span>Comment</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'message'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'A new comment.'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$post</span> <span class="token operator">=</span> App\<span class="token package">Post</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$post</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">comments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token variable">$comment</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Observa que no accedimos a la relación <code>comments</code> como una propiedad dinámica. En su lugar, ejecutamos el método <code>comments</code> para obtener una instancia de la relación. El método <code>save</code> automáticamente agregará el valor <code>post_id</code> apropiado al nuevo modelo <code>Comment</code>.</p> <p>Si necesitas guardar múltiples modelos relacionados, puedes usar el método <code>saveMany</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$post</span> <span class="token operator">=</span> App\<span class="token package">Post</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$post</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">comments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">saveMany</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">App<span class="token punctuation">\</span>Comment</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'message'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'A new comment.'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">App<span class="token punctuation">\</span>Comment</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'message'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'Another comment.'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><a name="the-push-method"></a></p> <h4 id="guardando-modelos-y-relaciones-recursivamente"><a href="#guardando-modelos-y-relaciones-recursivamente" aria-hidden="true" class="header-anchor">#</a> Guardando Modelos Y Relaciones Recursivamente</h4> <p>SI quieres hacer <code>save</code> a tu modelo y a todas sus relaciones asociadas, puedes usar el método <code>push</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$post</span> <span class="token operator">=</span> App\<span class="token package">Post</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$post</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">comments</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">message</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'Message'</span><span class="token punctuation">;</span>
<span class="token variable">$post</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">comments</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">author</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">name</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'Author Name'</span><span class="token punctuation">;</span>

<span class="token variable">$post</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><a name="the-create-method"></a></p> <h3 id="el-metodo-create"><a href="#el-metodo-create" aria-hidden="true" class="header-anchor">#</a> El Método Create</h3> <p>En adición a los métodos <code>save</code> y <code>saveMany</code>, también puedes usar el método <code>create</code>, el cual acepta un arreglo de atributos, crea un modelo y lo inserta dentro de la base de datos. Otra vez, la diferencia entre <code>save</code> y <code>create</code> es que <code>save</code> acepta una instancia de modelo Eloquent llena mientras <code>create</code> acepta un <code>array</code> PHP plano:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$post</span> <span class="token operator">=</span> App\<span class="token package">Post</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$comment</span> <span class="token operator">=</span> <span class="token variable">$post</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">comments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token single-quoted-string string">'message'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'A new comment.'</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>Antes de usar el método <code>create</code>, asegurate de revisar la documentación sobre la <a href="/docs/%7B%7Bversion%7D%7D/eloquent#mass-assignment">asignación masiva de atributos</a>.</p></div> <p>Puedes usar el método <code>createMany</code> para crear múltiples modelos relacionados:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$post</span> <span class="token operator">=</span> App\<span class="token package">Post</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$post</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">comments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">createMany</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">[</span>
        <span class="token single-quoted-string string">'message'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'A new comment.'</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span>
        <span class="token single-quoted-string string">'message'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'Another new comment.'</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>También puedes usar los métodos <code>findOrNew</code>, <code>firstOrNew</code>, <code>firstOrCreate</code> y <code>updateOrCreate</code> para <a href="https://laravel.com/docs/%7B%7Bversion%7D%7D/eloquent#other-creation-methods" target="_blank" rel="noopener noreferrer">crear y actualizar modelos en relaciones<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <p><a name="updating-belongs-to-relationships"></a></p> <h3 id="actualizar-relacion-pertenece-a-belongsto"><a href="#actualizar-relacion-pertenece-a-belongsto" aria-hidden="true" class="header-anchor">#</a> Actualizar Relación Pertenece A (belongsTo)</h3> <p>Al momento de actualizar una relación <code>belongsTo</code>, puedes usar el método <code>associate</code>. Este método establecerá la clave foránea en el modelo hijo:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$account</span> <span class="token operator">=</span> App\<span class="token package">Account</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">account</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">associate</span><span class="token punctuation">(</span><span class="token variable">$account</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Al momento de eliminar una relación <code>belongsTo</code>, puedes usar el método <code>dissociate</code>. Este método establecerá la clave foránea de la relación a <code>null</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">account</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">dissociate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><a name="default-models"></a></p> <h4 id="modelos-predeterminados"><a href="#modelos-predeterminados" aria-hidden="true" class="header-anchor">#</a> Modelos Predeterminados</h4> <p>Las relaciones <code>belongsTo</code>, <code>hasOne</code>, <code>hasOneThrough</code> y <code>morphOne</code> te permiten definir un modelo predeterminado que se devolverá si la relación dada es <code>null</code>. A este patrón se le conoce comúnmente como <a href="https://en.wikipedia.org/wiki/Null_Object_pattern" target="_blank" rel="noopener noreferrer">patrón Null Object<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> y puede ayudar a quitar comprobaciones condicionales en tu código. En el ejemplo siguiente, la relación <code>user</code> devolverá un modelo <code>App\User</code> vacío si no hay un <code>user</code> adjunto a la publicación:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">/**
* Get the author of the post.
*/</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">belongsTo</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'App\User'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">withDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Para rellenar el modelo predeterminado con atributos, puedes pasar un arreglo o Closure al método <code>withDefault</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">/**
* Get the author of the post.
*/</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">belongsTo</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'App\User'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">withDefault</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
        <span class="token single-quoted-string string">'name'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'Guest Author'</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
* Get the author of the post.
*/</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">belongsTo</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'App\User'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">withDefault</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">name</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'Guest Author'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><a name="updating-many-to-many-relationships"></a></p> <h3 id="relaciones-muchos-a-muchos"><a href="#relaciones-muchos-a-muchos" aria-hidden="true" class="header-anchor">#</a> Relaciones Muchos A Muchos</h3> <h4 id="adjuntando-attach-quitando-detach"><a href="#adjuntando-attach-quitando-detach" aria-hidden="true" class="header-anchor">#</a> Adjuntando (Attach) / Quitando (Detach)</h4> <p>Eloquent también proporciona unos cuantas métodos helper para hacer que el trabajo con los modelos relacionados sea más conveniente. Por ejemplo, vamos a imaginar que un usuario tiene muchos roles y un rol puede tener muchos usuarios. Para adjuntar un rol a un usuario insertando un registro en la tabla intermedia que vincula los modelos, usa el método <code>attach</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$user</span> <span class="token operator">=</span> App\<span class="token package">User</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">roles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">attach</span><span class="token punctuation">(</span><span class="token variable">$roleId</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Al momento de adjuntar una relación a un modelo, también puedes pasar un arreglo de datos adicionales para ser insertados dentro de la tabla intermedia:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">roles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">attach</span><span class="token punctuation">(</span><span class="token variable">$roleId</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token single-quoted-string string">'expires'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$expires</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Algunas veces puede ser necesario quitar un rol de un usuario. Para remover un registro de una relación de muchos-a-muchos, usa el método <code>detach</code>. El método <code>detach</code> eliminará el registro apropiado de la tabla intermedia; sin embargo, ambos modelos permanecerán en la base de datos:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">// Detach a single role from the user...</span>
<span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">roles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">detach</span><span class="token punctuation">(</span><span class="token variable">$roleId</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Detach all roles from the user...</span>
<span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">roles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">detach</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Por conveniencia, <code>attach</code> y <code>detach</code> también aceptan arreglos de IDs como entrada:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$user</span> <span class="token operator">=</span> App\<span class="token package">User</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">roles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">detach</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">roles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">attach</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token number">1</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token single-quoted-string string">'expires'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$expires</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token number">2</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token single-quoted-string string">'expires'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$expires</span><span class="token punctuation">]</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="sincronizando-asociaciones"><a href="#sincronizando-asociaciones" aria-hidden="true" class="header-anchor">#</a> Sincronizando Asociaciones</h4> <p>También puedes usar el método <code>sync</code> para construir asociaciones muchos-a-muchos. El método <code>sync</code> acepta un arreglo de IDs para colocar en la tabla intermedia. Algunos IDs que no estén en el arreglo dado serán removidos de la tabla intermedia. Por tanto, después que esta operación se complete, solamente los IDs en el arreglo dado existirán en la tabla intermedia:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">roles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>También puedes pasar valores adicionales de tabla intermedia con los IDs:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">roles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token single-quoted-string string">'expires'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token boolean">true</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Si no quieres desatar IDs existentes, puedes usar el método <code>syncWithoutDetaching</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">roles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">syncWithoutDetaching</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="alternar-asociaciones"><a href="#alternar-asociaciones" aria-hidden="true" class="header-anchor">#</a> Alternar Asociaciones</h4> <p>La relación de muchos-a-muchos también proporciona un método <code>toggle</code> el cual &quot;alterna&quot; el estado adjunto de los IDs dados. Si el ID está actualmente adjuntado, será removido. De igual forma, si está actualmente removido, será adjuntado:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">roles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">toggle</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="guardando-datos-adicionales-en-una-tabla-pivote"><a href="#guardando-datos-adicionales-en-una-tabla-pivote" aria-hidden="true" class="header-anchor">#</a> Guardando Datos Adicionales En Una Tabla Pivote</h4> <p>Al momento de trabajar con una relación de muchos-a-muchos, el método <code>save</code> acepta un arreglo de atributos adicionales de tabla intermedia como su segundo argumento:</p> <div class="language-php extra-class"><pre class="language-php"><code>App\<span class="token package">User</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">roles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token variable">$role</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token single-quoted-string string">'expires'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$expires</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="actualizando-un-registro-en-una-tabla-pivote"><a href="#actualizando-un-registro-en-una-tabla-pivote" aria-hidden="true" class="header-anchor">#</a> Actualizando un Registro en una Tabla Pivote</h4> <p>Si necesitas actualizar una fila existente en tu tabla pivote, puedes usar el método <code>updateExistingPivot</code>. Este método acepta la clave foránea del registro pivote y un arreglo de atributos para actualizar:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$user</span> <span class="token operator">=</span> App\<span class="token package">User</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">roles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">updateExistingPivot</span><span class="token punctuation">(</span><span class="token variable">$roleId</span><span class="token punctuation">,</span> <span class="token variable">$attributes</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><a name="touching-parent-timestamps"></a></p> <h2 id="tocando-marcas-de-tiempo-del-padre"><a href="#tocando-marcas-de-tiempo-del-padre" aria-hidden="true" class="header-anchor">#</a> Tocando Marcas De Tiempo Del Padre</h2> <p>Cuando un modelo <code>belongsTo</code> o <code>belongsToMany</code> a otro modelo, tal como un <code>Comment</code> el cual pertenece a un <code>Post</code>, algunas veces es útil actualizar la marca de tiempo del padre cuando el modelo hijo es actualizado. Por ejemplo, cuando un modelo <code>Comment</code> es actualizado, puedes querer &quot;tocar&quot; automáticamente la marca de tiempo <code>updated_at</code> del <code>Post</code> que lo posee. Eloquent hace esto fácil. Simplemente agrega una propiedad <code>touches</code> conteniendo los nombres de las relaciones al modelo hijo:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Comment</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * All of the relationships to be touched.
    *
    * @var array
    */</span>
    <span class="token keyword">protected</span> <span class="token variable">$touches</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token single-quoted-string string">'post'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token comment">/**
    * Get the post that the comment belongs to.
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">post</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">belongsTo</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'App\Post'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p>Ahora, cuando actualices un <code>Comment</code>, el <code>Post</code> que lo posee tendrá su columna <code>updated_at</code> actualizada también, haciéndolo más conveniente para saber cuándo invalidar una caché del modelo <code>Post</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$comment</span> <span class="token operator">=</span> App\<span class="token package">Comment</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$comment</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">text</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'Edit to this comment!'</span><span class="token punctuation">;</span>

<span class="token variable">$comment</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/eloquent.html" class="prev">
          Eloquent: Primeros Pasos
        </a></span> <span class="next"><a href="/eloquent-collections.html">
          Eloquent: Colecciones
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/app.bf22240a.js" defer></script><script src="/assets/js/29.06a87f0d.js" defer></script>
  </body>
</html>
