<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Colas De Trabajo | Documentación de Laravel en Español</title>
    <meta name="description" content="Documentación de Laravel en Español">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Catamaran:300,700|Miriam+Libre">
    
    <link rel="preload" href="/assets/css/0.styles.0cc2d3c3.css" as="style"><link rel="preload" href="/assets/js/app.bf22240a.js" as="script"><link rel="preload" href="/assets/js/60.b4fe788b.js" as="script"><link rel="prefetch" href="/assets/js/10.8a8a99df.js"><link rel="prefetch" href="/assets/js/11.ec476e2f.js"><link rel="prefetch" href="/assets/js/12.6db1eb13.js"><link rel="prefetch" href="/assets/js/13.92d78bb5.js"><link rel="prefetch" href="/assets/js/14.1a0ad5f1.js"><link rel="prefetch" href="/assets/js/15.abc982c9.js"><link rel="prefetch" href="/assets/js/16.7cf1a759.js"><link rel="prefetch" href="/assets/js/17.4abfc664.js"><link rel="prefetch" href="/assets/js/18.85b19837.js"><link rel="prefetch" href="/assets/js/19.8c9dfcd5.js"><link rel="prefetch" href="/assets/js/2.dcb6cf45.js"><link rel="prefetch" href="/assets/js/20.c1b9de54.js"><link rel="prefetch" href="/assets/js/21.469ffab3.js"><link rel="prefetch" href="/assets/js/22.2d14e150.js"><link rel="prefetch" href="/assets/js/23.7a4dcc9a.js"><link rel="prefetch" href="/assets/js/24.534e59f1.js"><link rel="prefetch" href="/assets/js/25.eaac1c07.js"><link rel="prefetch" href="/assets/js/26.8e9180e0.js"><link rel="prefetch" href="/assets/js/27.2cd2ace8.js"><link rel="prefetch" href="/assets/js/28.9f7dcf6d.js"><link rel="prefetch" href="/assets/js/29.06a87f0d.js"><link rel="prefetch" href="/assets/js/3.b62bf0b4.js"><link rel="prefetch" href="/assets/js/30.b03f86ec.js"><link rel="prefetch" href="/assets/js/31.edce81f6.js"><link rel="prefetch" href="/assets/js/32.6657300b.js"><link rel="prefetch" href="/assets/js/33.8dc49209.js"><link rel="prefetch" href="/assets/js/34.03cbee56.js"><link rel="prefetch" href="/assets/js/35.5439db2e.js"><link rel="prefetch" href="/assets/js/36.83d5a264.js"><link rel="prefetch" href="/assets/js/37.4066824e.js"><link rel="prefetch" href="/assets/js/38.c3fe05aa.js"><link rel="prefetch" href="/assets/js/39.52ef8667.js"><link rel="prefetch" href="/assets/js/4.bd0ebba2.js"><link rel="prefetch" href="/assets/js/40.2c54d702.js"><link rel="prefetch" href="/assets/js/41.775bc6e1.js"><link rel="prefetch" href="/assets/js/42.6541d60b.js"><link rel="prefetch" href="/assets/js/43.20091aea.js"><link rel="prefetch" href="/assets/js/44.75b71ccc.js"><link rel="prefetch" href="/assets/js/45.6b36a3a8.js"><link rel="prefetch" href="/assets/js/46.6ea236af.js"><link rel="prefetch" href="/assets/js/47.0e0ee374.js"><link rel="prefetch" href="/assets/js/48.b6beb9b8.js"><link rel="prefetch" href="/assets/js/49.ae33b521.js"><link rel="prefetch" href="/assets/js/5.2c350d8b.js"><link rel="prefetch" href="/assets/js/50.5cb081e0.js"><link rel="prefetch" href="/assets/js/51.3e0281e2.js"><link rel="prefetch" href="/assets/js/52.e1fae1d6.js"><link rel="prefetch" href="/assets/js/53.0a9d4aed.js"><link rel="prefetch" href="/assets/js/54.55bc9113.js"><link rel="prefetch" href="/assets/js/55.e964fdb4.js"><link rel="prefetch" href="/assets/js/56.3abed8a0.js"><link rel="prefetch" href="/assets/js/57.df09269b.js"><link rel="prefetch" href="/assets/js/58.3ce37458.js"><link rel="prefetch" href="/assets/js/59.7a840aeb.js"><link rel="prefetch" href="/assets/js/6.6fce793d.js"><link rel="prefetch" href="/assets/js/61.e45356bb.js"><link rel="prefetch" href="/assets/js/62.0d75cf78.js"><link rel="prefetch" href="/assets/js/63.0ecae205.js"><link rel="prefetch" href="/assets/js/64.90fb2c2d.js"><link rel="prefetch" href="/assets/js/65.7c476002.js"><link rel="prefetch" href="/assets/js/66.802dee8b.js"><link rel="prefetch" href="/assets/js/67.ae965c66.js"><link rel="prefetch" href="/assets/js/68.220c04d8.js"><link rel="prefetch" href="/assets/js/69.bf607b92.js"><link rel="prefetch" href="/assets/js/7.b956f78c.js"><link rel="prefetch" href="/assets/js/70.dea3d878.js"><link rel="prefetch" href="/assets/js/71.1f786e34.js"><link rel="prefetch" href="/assets/js/72.4bd65b39.js"><link rel="prefetch" href="/assets/js/73.414b29bd.js"><link rel="prefetch" href="/assets/js/74.b5ab4f13.js"><link rel="prefetch" href="/assets/js/75.f12fbb27.js"><link rel="prefetch" href="/assets/js/76.a140d22b.js"><link rel="prefetch" href="/assets/js/77.2595933c.js"><link rel="prefetch" href="/assets/js/78.46bb4eff.js"><link rel="prefetch" href="/assets/js/79.c549a0e3.js"><link rel="prefetch" href="/assets/js/8.3be12d8d.js"><link rel="prefetch" href="/assets/js/80.1b9cd731.js"><link rel="prefetch" href="/assets/js/81.6aa05825.js"><link rel="prefetch" href="/assets/js/9.60a01cba.js">
    <link rel="stylesheet" href="/assets/css/0.styles.0cc2d3c3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Documentación de Laravel en Español</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Inicio</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Inicio</a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading"><span>Primeros Pasos</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Conceptos De Arquitectura</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Fundamentos</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Frontend</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Seguridad</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>Profundizando</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/artisan.html" class="sidebar-link">Consola Artisan</a></li><li><a href="/broadcasting.html" class="sidebar-link">Broadcasting</a></li><li><a href="/cache.html" class="sidebar-link">Caché</a></li><li><a href="/collections.html" class="sidebar-link">Collecciones</a></li><li><a href="/events.html" class="sidebar-link">Eventos</a></li><li><a href="/filesystem.html" class="sidebar-link">Almacenamiento De Archivos</a></li><li><a href="/helpers.html" class="sidebar-link">Helpers</a></li><li><a href="/mail.html" class="sidebar-link">Correos Electrónicos</a></li><li><a href="/notifications.html" class="sidebar-link">Notificaciones</a></li><li><a href="/packages.html" class="sidebar-link">Desarrollo de Paquetes</a></li><li><a href="/queues.html" class="active sidebar-link">Colas De Trabajo</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/queues.html#introduccion" class="sidebar-link">Introducción</a></li><li class="sidebar-sub-header"><a href="/queues.html#creacion-de-trabajos" class="sidebar-link">Creación De Trabajos</a></li><li class="sidebar-sub-header"><a href="/queues.html#despachar-trabajos" class="sidebar-link">Despachar Trabajos</a></li><li class="sidebar-sub-header"><a href="/queues.html#closures-de-colas" class="sidebar-link">Closures De Colas</a></li><li class="sidebar-sub-header"><a href="/queues.html#ejecutar-el-worker-de-cola" class="sidebar-link">Ejecutar El Worker De Cola</a></li><li class="sidebar-sub-header"><a href="/queues.html#configuracion-de-supervisor" class="sidebar-link">Configuración De Supervisor</a></li><li class="sidebar-sub-header"><a href="/queues.html#manejo-de-trabajos-fallidos" class="sidebar-link">Manejo De Trabajos Fallidos</a></li><li class="sidebar-sub-header"><a href="/queues.html#eventos-de-trabajo" class="sidebar-link">Eventos De Trabajo</a></li></ul></li><li><a href="/scheduling.html" class="sidebar-link">Programación de tareas</a></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Bases De Datos</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>ORM Eloquent</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Pruebas</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Paquetes oficiales</span> <span class="arrow right"></span></p> <!----></div></li></ul> </div> <div class="page"> <div class="content"><div><h1 id="colas-de-trabajo"><a class="header-anchor" href="#colas-de-trabajo" aria-hidden="true">#</a> Colas De Trabajo</h1> <ul><li><a href="#introduction">Introducción</a> <ul><li><a href="#connections-vs-queues">Conexiones Vs. Colas</a></li> <li><a href="#driver-prerequisites">Notas Y Requisitos Previos de Driver</a></li></ul></li> <li><a href="#creating-jobs">Creación De Trabajos</a> <ul><li><a href="#generating-job-classes">Generación De Clases De Trabajos</a></li> <li><a href="#class-structure">Estructura De Clases</a></li></ul></li> <li><a href="#dispatching-jobs">Despachar Trabajos</a> <ul><li><a href="#delayed-dispatching">Despacho Postergado</a></li> <li><a href="#synchronous-dispatching">Envío Sincrónico</a></li> <li><a href="#job-chaining">Encadenamiento De Trabajos</a></li> <li><a href="#customizing-the-queue-and-connection">Personalizar La Cola Y Conexión</a></li> <li><a href="#max-job-attempts-and-timeout">Especificar Intentos Máximos De Trabajos / Valores De Timeout</a></li> <li><a href="#rate-limiting">Límites De Rango</a></li> <li><a href="#error-handling">Manejo De Errores</a></li></ul></li> <li><a href="#queueing-closures">Closures De Colas</a></li> <li><a href="#running-the-queue-worker">Ejecutar El Worker De Cola</a> <ul><li><a href="#queue-priorities">Prioridades En Cola</a></li> <li><a href="#queue-workers-and-deployment">Workers de Cola Y Despliegue</a></li> <li><a href="#job-expirations-and-timeouts">Expiraciones De Trabajo Y Tiempos De Espera</a></li></ul></li> <li><a href="#supervisor-configuration">Configuración de Supervisor</a></li> <li><a href="#dealing-with-failed-jobs">Manejo De Trabajos Fallidos</a> <ul><li><a href="#cleaning-up-after-failed-jobs">Remediando Trabajos Fallidos</a></li> <li><a href="#failed-job-events">Eventos De Trabajos Fallidos</a></li> <li><a href="#retrying-failed-jobs">Reintentando Trabajos Fallidos</a></li> <li><a href="#ignoring-missing-models">Ignorando Modelos Faltantes</a></li></ul></li> <li><a href="#job-events">Eventos De Trabajo</a></li></ul> <p><a name="introduction"></a></p> <h2 id="introduccion"><a class="header-anchor" href="#introduccion" aria-hidden="true">#</a> Introducción</h2> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>Laravel ahora ofrece Horizon, un hermoso tablero y sistema de configuración para las colas motorizadas por Redis. Entra en <a href="/docs/%7B%7Bversion%7D%7D/horizon">Horizon documentation</a> para más inormación.</p></div></div> <p>Las colas de Laravel brindan una API unificada a través de una variedad de backends de cola diferentes como Beanstalk, Amazon SQS, Redis, o incluso una base de datos relacional. Las colas permiten diferir el procesamiento de una tarea que consume tiempo, como enviar un correo electrónico, para un momento posterior. Diferir estas tareas acelera drásticamente las solicitudes web en tu aplicación.</p> <p>La configuración de cola está almacenada en <code>config/queue.php</code>. En este archivo encontrarás configuraciones de conexión para cada driver de cola incluido en el framework, que comprende una base de datos, <a href="https://kr.github.io/beanstalkd/" target="_blank" rel="noopener noreferrer">Beanstalkd<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, <a href="https://aws.amazon.com/sqs/" target="_blank" rel="noopener noreferrer">Amazon SQS<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, <a href="https://redis.io" target="_blank" rel="noopener noreferrer">Redis<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, y un controlador sincrónico que ejecutará trabajos inmediatamente (para uso local). Un driver de cola <code>null</code> también está incluido, que descarta los trabajos completados de la cola.</p> <p><a name="connections-vs-queues"></a></p> <h3 id="conexiones-vs-colas"><a href="#conexiones-vs-colas" aria-hidden="true" class="header-anchor">#</a> Conexiones Vs. COlas</h3> <p>Antes de empezar con las colas de Laravel, es importante entender la distinción entre &quot;conexiones&quot; y &quot;colas&quot;. En tu archivo <code>config/queue.php</code>, hay una opción de configuración <code>connections</code>. Esta opción define una conexión particular a un servicio de backend como Amazon SQS, Beanstalk o Redis. Sin embargo, cualquier conexión de cola dada puede tener múltiples &quot;colas&quot; las cuales pueden ser considerarse como diferentes pilas de trabajos en espera.</p> <p>Ten en cuenta que cada ejemplo de configuración de conexión en el archivo <code>queue</code> contiene un atributo <code>queue</code>. Ésta es la cola por defecto a la cual los trabajos serán despachados cuando son enviados a una conexión dada. En otras palabras, si despachas un trabajo sin definir explícitamente a cuál cola debe ser despachado, el trabajo será colocado en la cola definida en el atributo <code>queue</code> de la configuración de conexión:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">// This job is sent to the default queue...</span>
Job<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// This job is sent to the &quot;emails&quot; queue...</span>
Job<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">onQueue</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'emails'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Algunas aplicaciones quizá no necesiten nunca insertar trabajos en múltiples colas, prefiriendo en su lugar tener una cola simple. Sin embargo, empujar trabajos a múltiples colas puede ser especialmente útil para aplicaciones que deseen priorizar o segmentar el procesamiento de sus trabajos, puesto que el worker de cola de Laravel permite especificar cuáles colas deben ser procesadas de acuerdo a su prioridad. Por ejemplo, si se insertan trabajos a una cola <code>high</code> se puede ejecutar un worker que les dé mayor prioridad de procesamiento:</p> <div class="language-php extra-class"><pre class="language-php"><code>php artisan queue<span class="token punctuation">:</span>work <span class="token operator">--</span>queue<span class="token operator">=</span>high<span class="token punctuation">,</span><span class="token keyword">default</span>
</code></pre></div><p><a name="driver-prerequisites"></a></p> <h3 id="notas-y-requisitos-previos-de-driver"><a href="#notas-y-requisitos-previos-de-driver" aria-hidden="true" class="header-anchor">#</a> Notas Y Requisitos Previos de Driver</h3> <h4 id="base-de-datos"><a href="#base-de-datos" aria-hidden="true" class="header-anchor">#</a> Base De Datos</h4> <p>Para utilizar el driver de cola <code>database</code>, necesitarás una tabla de base de datos para mantener los trabajos. Para generar una migración que crea esta tabla, ejecute el comando Artisan <code>queue:table</code>. Una vez creada la migración, puede migrar la base de datos mediante el comando <code>migrate</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code>php artisan queue<span class="token punctuation">:</span>table

php artisan migrate
</code></pre></div><h4 id="redis"><a href="#redis" aria-hidden="true" class="header-anchor">#</a> Redis</h4> <p>Para usar el controlador de cola <code>redis</code>, debes configurar una conexión a una base de datos Redis en tu archivo <code>config/database.php</code>.</p> <p><strong>Redis Cluster</strong></p> <p>Si tu conexión de cola Redis usa un Redis Cluster, tus nombres de cola deben contener un <a href="https://redis.io/topics/cluster-spec#keys-hash-tags" target="_blank" rel="noopener noreferrer">key hash tag<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. Esto es requerido para asegurar que todas las llaves Redis para una determinada cola sean colocadas en el mismo hash slot:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token single-quoted-string string">'redis'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
    <span class="token single-quoted-string string">'driver'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'redis'</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'connection'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'default'</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'queue'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'{default}'</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'retry_after'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">90</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre></div><p><strong>Bloqueo</strong></p> <p>Al usar la cola Redis, se puede usar la opción de configuración <code>block_for</code> para especificar por cuánto tiempo debería esperar el controlador para que un trabajo esté disponible antes de repetirse a través del bucle del worker y volver a consultar la base de datos Redis.</p> <p>Ajustar este valor en la carga de cola puede ser más eficiente que consultar continuamente la base de datos Redis buscando nuevos trabajos. Por ejemplo, puedes establecer el valor en <code>5</code> para indicar que el controlador debe bloquearse por cinco segundos mientras espera a que un trabajo esté disponible:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token single-quoted-string string">'redis'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
    <span class="token single-quoted-string string">'driver'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'redis'</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'connection'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'default'</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'queue'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'default'</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'retry_after'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">90</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'block_for'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">5</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre></div><h4 id="requisitos-previos-para-otros-controladores"><a href="#requisitos-previos-para-otros-controladores" aria-hidden="true" class="header-anchor">#</a> Requisitos Previos Para Otros Controladores</h4> <p>Las siguientes dependencias son necesarias para sus controladores respectivos:</p> <ul><li>Amazon SQS: <code>aws/aws-sdk-php ~3.0</code></li> <li>Beanstalkd: <code>pda/pheanstalk ~4.0</code></li> <li>Redis: <code>predis/predis ~1.0</code></li></ul> <p><a name="creating-jobs"></a></p> <h2 id="creacion-de-trabajos"><a href="#creacion-de-trabajos" aria-hidden="true" class="header-anchor">#</a> Creación De Trabajos</h2> <p><a name="generating-job-classes"></a></p> <h3 id="generacion-de-clases-de-trabajos"><a href="#generacion-de-clases-de-trabajos" aria-hidden="true" class="header-anchor">#</a> Generación De Clases De Trabajos</h3> <p>Por defecto, todos los trabajos que se pueden poner en cola para la aplicación son almacenados en el directorio <code>app/Jobs</code>. Si <code>app/Jobs</code> no existe, será creado cuando se ejecute el comando Artisan <code>make:job</code>. Puedes generar un nuevo trabajo en cola utilizando la CLI Artisan:</p> <div class="language-php extra-class"><pre class="language-php"><code>php artisan make<span class="token punctuation">:</span>job ProcessPodcast
</code></pre></div><p>La clase generada implementará la interfaz <code>Illuminate\Contracts\Queue\ShouldQueue</code>, indicando a Laravel que el trabajo debe ser insertado a la cola de forma asíncrona.</p> <p><a name="class-structure"></a></p> <h3 id="estructura-de-clases"><a href="#estructura-de-clases" aria-hidden="true" class="header-anchor">#</a> Estructura De Clases</h3> <p>Las clases de trabajo son muy sencillas, normalmente contienen  un único método <code>handle</code> que se llama cuando la cola procesa el trabajo. Para empezar, echemos un vistazo a una clase de trabajo de ejemplo. En este ejemplo, vamos a pretender que administramos un servicio de publicación de podcasts y necesitamos procesar los archivos de podcast cargados antes de que se publiquen:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Jobs</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Podcast</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>AudioProcessor</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Bus<span class="token punctuation">\</span>Queueable</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Queue<span class="token punctuation">\</span>SerializesModels</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Queue<span class="token punctuation">\</span>InteractsWithQueue</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Contracts<span class="token punctuation">\</span>Queue<span class="token punctuation">\</span>ShouldQueue</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Foundation<span class="token punctuation">\</span>Bus<span class="token punctuation">\</span>Dispatchable</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">ProcessPodcast</span> <span class="token keyword">implements</span> <span class="token class-name">ShouldQueue</span>
<span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token package">Dispatchable</span><span class="token punctuation">,</span> InteractsWithQueue<span class="token punctuation">,</span> Queueable<span class="token punctuation">,</span> SerializesModels<span class="token punctuation">;</span>

    <span class="token keyword">protected</span> <span class="token variable">$podcast</span><span class="token punctuation">;</span>

    <span class="token comment">/**
    * Create a new job instance.
    *
    * @param  Podcast  $podcast
    * @return void
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span>Podcast <span class="token variable">$podcast</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">podcast</span> <span class="token operator">=</span> <span class="token variable">$podcast</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
    * Execute the job.
    *
    * @param  AudioProcessor  $processor
    * @return void
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">handle</span><span class="token punctuation">(</span>AudioProcessor <span class="token variable">$processor</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Process uploaded podcast...</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p>En este ejemplo, ten en cuenta que hemos podido pasar un <a href="/docs/%7B%7Bversion%7D%7D/eloquent">modelo Eloquent</a> directamente hacia el constructor del trabajo en cola. Debido al trait <code>SerializesModels</code> que el trabajo está usando, los modelos Eloquent serán serializados y deserializados correctamente cuando el trabajo se esté procesando. Si tu trabajo en cola acepta un modelo Eloquent en su constructor, sólo el identificador para el modelo será serializado en la cola. Cuando el trabajo se maneja realmente, el sistema de cola volverá a recuperar automáticamente la instancia del modelo completo de la base de datos. Todo es totalmente transparente a tu aplicación y previene inconvenientes que pueden surgir de serializar instancias Eloquent completas.</p> <p>El método <code>handle</code> es llamado cuando el trabajo es procesado por la cola. Ten en cuenta que podemos declarar el tipo de dependencias en el método <code>handle</code> del trabajo. El <a href="/docs/%7B%7Bversion%7D%7D/container">contenedor de servicios</a> de Laravel automáticamente inyecta estas dependencias.</p> <p>Si te gustaría tomar control sobre cómo el contenedor inyecta dependencias en el método <code>handle</code>, puedes usar el método <code>bindMethod</code> del contenedor. El método <code>bindMethod</code> acepta una función de retorno (callback) que recibe el trabajo y el contenedor. Dentro del callback, eres libre de invocar al método <code>handle</code> de la forma que desees. Típicamente, deberías llamar a este método desde un <a href="/docs/%7B%7Bversion%7D%7D/providers">proveedor de servicios</a>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Jobs<span class="token punctuation">\</span>ProcessPodcast</span><span class="token punctuation">;</span>

<span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">app</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">bindMethod</span><span class="token punctuation">(</span>ProcessPodcast<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token single-quoted-string string">'@handle'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$job</span><span class="token punctuation">,</span> <span class="token variable">$app</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token variable">$job</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">handle</span><span class="token punctuation">(</span><span class="token variable">$app</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">make</span><span class="token punctuation">(</span>AudioProcessor<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="danger custom-block"><p class="custom-block-title">Nota</p> <p>Los datos binarios, como los contenidos de imagen, deben ser pasados a través de la función <code>base64_encode</code> antes de ser pasados a un trabajo en cola. De otra forma, el trabajo podría no serializarse correctamente a JSON cuando es colocado en la cola.</p></div> <p><a name="dispatching-jobs"></a></p> <h2 id="despachar-trabajos"><a href="#despachar-trabajos" aria-hidden="true" class="header-anchor">#</a> Despachar Trabajos</h2> <p>Una vez escrita la clase de trabajo, se puede despachar usando el método <code>dispatch</code> en el mismo trabajo. Los argumentos pasados a <code>dispatch</code> serán entregados al constructor de trabajos:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Controllers</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Jobs<span class="token punctuation">\</span>ProcessPodcast</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Request</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Controllers<span class="token punctuation">\</span>Controller</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">PodcastController</span> <span class="token keyword">extends</span> <span class="token class-name">Controller</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * Store a new podcast.
    *
    * @param  Request  $request
    * @return Response
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">store</span><span class="token punctuation">(</span>Request <span class="token variable">$request</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Create podcast...</span>

        ProcessPodcast<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token variable">$podcast</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p><a name="delayed-dispatching"></a></p> <h3 id="despacho-postergado"><a href="#despacho-postergado" aria-hidden="true" class="header-anchor">#</a> Despacho Postergado</h3> <p>Si quieres postergar la ejecución de un trabajo en cola, puedes utilizar el método <code>delay</code> al despachar un trabajo. Por ejemplo, especifiquemos que un trabajo no debería estar disponible para procesamiento hasta 10 minutos después que haya sido despachado:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Controllers</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Jobs<span class="token punctuation">\</span>ProcessPodcast</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Request</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Controllers<span class="token punctuation">\</span>Controller</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">PodcastController</span> <span class="token keyword">extends</span> <span class="token class-name">Controller</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * Store a new podcast.
    *
    * @param  Request  $request
    * @return Response
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">store</span><span class="token punctuation">(</span>Request <span class="token variable">$request</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Create podcast...</span>

        ProcessPodcast<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token variable">$podcast</span><span class="token punctuation">)</span>
                <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">delay</span><span class="token punctuation">(</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">addMinutes</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><div class="danger custom-block"><p class="custom-block-title">Nota</p> <p>El servicio de cola Amazon SQS tiene un tiempo máximo de retraso de 15 minutos.</p></div> <p><a name="synchronous-dispatching"></a></p> <h3 id="despacho-sincronico"><a href="#despacho-sincronico" aria-hidden="true" class="header-anchor">#</a> Despacho Sincrónico</h3> <p>Si deseas enviar un trabajo inmediatamente (sincrónicamente), puedes usar el método <code>dispatchNow</code>. Al usar este método, el trabajo no se pondrá en cola y se ejecutará inmediatamente dentro del proceso actual:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Controllers</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Request</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Jobs<span class="token punctuation">\</span>ProcessPodcast</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Controllers<span class="token punctuation">\</span>Controller</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">PodcastController</span> <span class="token keyword">extends</span> <span class="token class-name">Controller</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * Store a new podcast.
    *
    * @param  Request  $request
    * @return Response
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">store</span><span class="token punctuation">(</span>Request <span class="token variable">$request</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Create podcast...</span>

        ProcessPodcast<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">dispatchNow</span><span class="token punctuation">(</span><span class="token variable">$podcast</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p><a name="job-chaining"></a></p> <h3 id="encadenamiento-de-trabajos"><a href="#encadenamiento-de-trabajos" aria-hidden="true" class="header-anchor">#</a> Encadenamiento De Trabajos</h3> <p>El encadenamiento de trabajos te permite especificar una lista de trabajos en cola que deben ser ejecutados en secuencia. Si un trabajo en la secuencia falla, el resto no será ejecutado. Para ejecutar una cadena de trabajos en cola, puedes utilizar el método <code>withChain</code> en cualquier trabajo a enviar:</p> <div class="language-php extra-class"><pre class="language-php"><code>ProcessPodcast<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">withChain</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">OptimizePodcast</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">ReleasePodcast</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="danger custom-block"><p class="custom-block-title">Nota</p> <p>La eliminación de trabajos mediante el método <code>$this-&gt;delete()</code> no impedirá que se procesen los trabajos encadenados. La cadena sólo dejará de ejecutarse si falla un trabajo en la cadena.</p></div> <h4 id="cola-y-conexion-en-cadena"><a href="#cola-y-conexion-en-cadena" aria-hidden="true" class="header-anchor">#</a> Cola Y Conexión En Cadena</h4> <p>Si quieres especificar la cola y conexión por defecto que debe ser usada para los trabajos encadenados, se puede usar los métodos  <code>allOnConnection</code> and <code>allOnQueue</code>. Estos métodos especifican la conexión y nombre de cola que debe ser usado a menos que el trabajo en cola sea asignado explícitamente a una diferente conexión / cola:</p> <div class="language-php extra-class"><pre class="language-php"><code>ProcessPodcast<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">withChain</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">OptimizePodcast</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">ReleasePodcast</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">allOnConnection</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'redis'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">allOnQueue</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'podcasts'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><a name="customizing-the-queue-and-connection"></a></p> <h3 id="personalizar-la-cola-y-la-conexion"><a href="#personalizar-la-cola-y-la-conexion" aria-hidden="true" class="header-anchor">#</a> Personalizar La Cola Y La Conexión</h3> <h4 id="despachar-a-una-cola-especifica"><a href="#despachar-a-una-cola-especifica" aria-hidden="true" class="header-anchor">#</a> Despachar A Una Cola Específica</h4> <p>Al insertar trabajos en diferentes colas, puedes &quot;categorizar&quot; los trabajos en cola e incluso priorizar cuántos workers son asignados a las distintas colas. Sin embargo, es preciso resaltar que esto no inserta trabajos en diferentes &quot;conexiones&quot; de cola definidas en el archivo de configuración de colas, sino en colas específicas dentro de una sola conexión. Para especificar la cola, se usa el método <code>onQueue</code> al despachar un trabajo:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Controllers</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Jobs<span class="token punctuation">\</span>ProcessPodcast</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Request</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Controllers<span class="token punctuation">\</span>Controller</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">PodcastController</span> <span class="token keyword">extends</span> <span class="token class-name">Controller</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * Store a new podcast.
    *
    * @param  Request  $request
    * @return Response
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">store</span><span class="token punctuation">(</span>Request <span class="token variable">$request</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Create podcast...</span>

        ProcessPodcast<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token variable">$podcast</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">onQueue</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'processing'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><h4 id="despachar-a-una-conexion-especifica"><a href="#despachar-a-una-conexion-especifica" aria-hidden="true" class="header-anchor">#</a> Despachar A Una Conexión Específica</h4> <p>Si estás trabajando con múltiples conexiones de cola, puedes especificar en cuál conexión deseas insertar un trabajo. Para especificar la conexión, utiliza el método <code>onConnection</code> al despachar el trabajo:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Controllers</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Jobs<span class="token punctuation">\</span>ProcessPodcast</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Request</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Controllers<span class="token punctuation">\</span>Controller</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">PodcastController</span> <span class="token keyword">extends</span> <span class="token class-name">Controller</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * Store a new podcast.
    *
    * @param  Request  $request
    * @return Response
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">store</span><span class="token punctuation">(</span>Request <span class="token variable">$request</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Create podcast...</span>

        ProcessPodcast<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token variable">$podcast</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">onConnection</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'sqs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p>Puedes encadenar los métodos <code>onConnection</code> y <code>onQueue</code> para especificar la conexión y cola de un trabajo:</p> <div class="language-php extra-class"><pre class="language-php"><code>ProcessPodcast<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token variable">$podcast</span><span class="token punctuation">)</span>
                <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">onConnection</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'sqs'</span><span class="token punctuation">)</span>
                <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">onQueue</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'processing'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Alternativamente, puedes especificar <code>connection</code> como una propiedad en la clase del trabajo:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Jobs</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">ProcessPodcast</span> <span class="token keyword">implements</span> <span class="token class-name">ShouldQueue</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
        * The queue connection that should handle the job.
        *
        * @var string
        */</span>
    <span class="token keyword">public</span> <span class="token variable">$connection</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'sqs'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p><a name="max-job-attempts-and-timeout"></a></p> <h3 id="especificar-intentos-maximos-de-un-trabajo-y-valores-de-tiempos-de-espera-timeout"><a href="#especificar-intentos-maximos-de-un-trabajo-y-valores-de-tiempos-de-espera-timeout" aria-hidden="true" class="header-anchor">#</a> Especificar Intentos Máximos De Un Trabajo Y Valores De Tiempos De Espera (Timeout)</h3> <h4 id="numero-de-intentos-maximo"><a href="#numero-de-intentos-maximo" aria-hidden="true" class="header-anchor">#</a> Número De Intentos Máximo</h4> <p>Una forma de especificar el número máximo de veces que un trabajo puede ser intentado es mediante la opción <code>--tries</code> en la línea de comandos Artisan:</p> <div class="language-php extra-class"><pre class="language-php"><code>php artisan queue<span class="token punctuation">:</span>work <span class="token operator">--</span>tries<span class="token operator">=</span><span class="token number">3</span>
</code></pre></div><p>Sin embargo, puedes tomar un camino más granular definiendo el número máximo de intentos dentro de la clase de trabajos. Si el número máximo de intentos está especificado en el trabajo, precederá sobre el valor provisto en la línea de comandos:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Jobs</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">ProcessPodcast</span> <span class="token keyword">implements</span> <span class="token class-name">ShouldQueue</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * The number of times the job may be attempted.
    *
    * @var int
    */</span>
    <span class="token keyword">public</span> <span class="token variable">$tries</span> <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p><a name="time-based-attempts"></a></p> <h4 id="intentos-basados-en-tiempo"><a href="#intentos-basados-en-tiempo" aria-hidden="true" class="header-anchor">#</a> Intentos Basados En Tiempo</h4> <p>Como alternativa a definir cuántas veces un trabajo puede ser intentado antes de que falle, puedes definir en qué momento el trabajo debería pasar a tiempo de espera (timeout). Esto permite intentar un trabajo cualquier cantidad de veces dentro de un marco de tiempo dado. Para definir el momento en el que un trabajo debería pasar a timeout, se agrega un método <code>retryUntil</code> en la clase de trabajos:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">/**
* Determine the time at which the job should timeout.
*
* @return \DateTime
*/</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">retryUntil</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">addSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>También puedes definir un método <code>retryUntil</code> en los listeners de eventos en cola.</p></div> <h4 id="tiempo-de-espera-timeout"><a href="#tiempo-de-espera-timeout" aria-hidden="true" class="header-anchor">#</a> Tiempo De Espera (Timeout)</h4> <div class="danger custom-block"><p class="custom-block-title">Nota</p> <p>La característica <code>timeout</code> está optimizada para PHP 7.1+ y la extensión <code>pcntl</code>.</p></div> <p>De igual modo, el número máximo de segundos para ejecutar un trabajo pueden ser especificados usando la opción <code>--timeout</code> en la línea de comandos Artisan:</p> <div class="language-php extra-class"><pre class="language-php"><code>php artisan queue<span class="token punctuation">:</span>work <span class="token operator">--</span>timeout<span class="token operator">=</span><span class="token number">30</span>
</code></pre></div><p>Sin embargo, es posible querer definir el número máximo de segundos para ejecutar un trabajo dentro de su clase. Si el timeout está especificado en el trabajo, prevalecerá sobre cualquier otro timeout especificado en la línea de comandos:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Jobs</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">ProcessPodcast</span> <span class="token keyword">implements</span> <span class="token class-name">ShouldQueue</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * The number of seconds the job can run before timing out.
    *
    * @var int
    */</span>
    <span class="token keyword">public</span> <span class="token variable">$timeout</span> <span class="token operator">=</span> <span class="token number">120</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p><a name="rate-limiting"></a></p> <h3 id="limite-de-rango"><a href="#limite-de-rango" aria-hidden="true" class="header-anchor">#</a> Límite De Rango</h3> <div class="danger custom-block"><p class="custom-block-title">Nota</p> <p>Esta característica requiere que la aplicación pueda interactuar con un <a href="/docs/%7B%7Bversion%7D%7D/redis">Redis server</a>.</p></div> <p>Si tu aplicación interactúa con Redis, puedes regular los trabajos en cola por tiempo o concurrencia. Esta característica puede ser de ayuda cuando los trabajos en cola interactúan con APIs que también poseen límite de frecuencia.</p> <p>Por ejemplo, usando el método <code>throttle</code>, puedes regular cierto tipo de trabajo para que se ejecute sólo diez veces por minuto. Si no se puede obtener un bloqueo, normalmente debes liberar el trabajo de vuelta a la cola para que pueda volver a intentarlo más tarde:</p> <div class="language-php extra-class"><pre class="language-php"><code>Redis<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">throttle</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'key'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">allow</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">every</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Job logic...</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Could not obtain lock...</span>

    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>En el ejemplo anterior, <code>key</code> puede ser cualquier cadena que identifique únicamente el tipo de trabajo que se quiere limitar. Por ejemplo, puedes desear construir la key basada en el nombre de clase del trabajo y las IDS de los modelos Eloquent en los cuáles opera.</p></div> <div class="danger custom-block"><p class="custom-block-title">Nota</p> <p>Liberar un trabajo limitado de vuelta a la cola seguirá incrementando el número total de <code>intentos</code> del trabajo.</p></div> <p>Alternativamente, puedes especificar el número máximo de workers que pueden procesar simultáneamente un trabajo determinado. Esto puede ser útil cuando un trabajo en cola está modificando un recurso que solo debe ser modificado por un trabajo a la vez. Por ejemplo, utilizando el método <code>funnel</code>, puedes limitar los trabajos de un tipo dado para que solo sean procesados por un worker a la vez:</p> <div class="language-php extra-class"><pre class="language-php"><code>Redis<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">funnel</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'key'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Job logic...</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Could not obtain lock...</span>

    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>Al utilizar límite de frecuencias, el número de intentos que el trabajo necesitará para ejecutarse exitosamente puede ser difícil de determinar. Por lo tanto, es útil combinar límite de frecuencias con <a href="#time-based-attempts">intentos basados en el tiempo</a>.</p></div> <p><a name="error-handling"></a></p> <h3 id="manejo-de-errores"><a href="#manejo-de-errores" aria-hidden="true" class="header-anchor">#</a> Manejo De Errores</h3> <p>Si una excepción es lanzada mientras el trabajo está siendo procesado, el trabajo será automáticamente liberado a la cola para que pueda ser intentado de nuevo. EL trabajo continuará siendo liberado hasta que haya sido intentado el número de veces máximo permitido por tu aplicación. El número máximo de intentos es definido por la opción <code>--tries</code> usada en el comando Artisan <code>queue:work</code>. De forma alterna, el número máximo de intentos puede ser definido en la clase de trabajos en sí. Más información acerca de ejecutar el worker de cola <a href="#running-the-queue-worker">se puede encontrar a continuación</a>.</p> <p><a name="queueing-closures"></a></p> <h2 id="closures-de-colas"><a href="#closures-de-colas" aria-hidden="true" class="header-anchor">#</a> Closures De Colas</h2> <p>En lugar de enviar una clase de trabajo a la cola, también puedes enviar una Closure. Esto es ideal para tareas rápidas y simples que deben ejecutarse fuera del ciclo de solicitud actual:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$podcast</span> <span class="token operator">=</span> App\<span class="token package">Podcast</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">use</span> <span class="token punctuation">(</span><span class="token variable">$podcast</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$podcast</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">publish</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Al enviar Closures a la cola, el contenido del código del Closure está firmado criptográficamente para que no se pueda modificar en tránsito.</p> <p><a name="running-the-queue-worker"></a></p> <h2 id="ejecutar-el-worker-de-cola"><a href="#ejecutar-el-worker-de-cola" aria-hidden="true" class="header-anchor">#</a> Ejecutar El Worker De Cola</h2> <p>Laravel incluye un worker de cola que procesará trabajos nuevos a medida que éstos son insertados en la cola. Puedes ejecutar el worker usando el comando Artisan <code>queue:work</code>. Ten en cuenta que una vez iniciado <code>queue:work</code>, continuará ejecutándose hasta que sea detenido manualmente o hasta que la terminal sea cerrada:</p> <div class="language-php extra-class"><pre class="language-php"><code>php artisan queue<span class="token punctuation">:</span>work
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>Para mantener el proceso <code>queue:work</code> ejecutado permanentemente en segundo plano, debes usar un monitor de procesos como <a href="#supervisor-configuration">Supervisor</a> para asegurar que el worker de cola no deja de ejecutarse.</p></div> <p>Recuerda, los workers en cola son procesos de larga duración y almacenan el estado de la aplicación iniciada en la memoria. Como resultado, no notarán cambios en la base de código después de que se han iniciado. Por lo tanto, durante el proceso de despliegue, asegúrate de <a href="#queue-workers-and-deployment">reiniciar los workers de cola</a>.</p> <h4 id="especificando-la-conexion-y-cola"><a href="#especificando-la-conexion-y-cola" aria-hidden="true" class="header-anchor">#</a> Especificando La Conexión Y Cola</h4> <p>También puedes especificar qué conexión de cola debe utilizar el worker. El nombre de conexión pasado al comando <code>work</code> debe corresponder a una de las conexiones definidas en tu archivo de configuración <code>config/queue.php</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code>php artisan queue<span class="token punctuation">:</span>work redis
</code></pre></div><p>Puedes personalizar tu worker de colas más allá al solo procesar colas particulares para una conexión dada. Por ejemplo, si todos tus correos electrónicos son procesados en una cola <code>emails</code> en tu cola de conexión <code>redis</code>, puedes emitir el siguiente comando para iniciar un worker que solo procesa dicha cola:</p> <div class="language-php extra-class"><pre class="language-php"><code>php artisan queue<span class="token punctuation">:</span>work redis <span class="token operator">--</span>queue<span class="token operator">=</span>emails
</code></pre></div><h4 id="procesar-un-solo-trabajo"><a href="#procesar-un-solo-trabajo" aria-hidden="true" class="header-anchor">#</a> Procesar Un Sólo Trabajo</h4> <p>La opción <code>--once</code> puede ser usada para indicarle al worker procesar sólo un trabajo de la cola:</p> <div class="language-php extra-class"><pre class="language-php"><code>php artisan queue<span class="token punctuation">:</span>work <span class="token operator">--</span>once
</code></pre></div><h4 id="procesar-todos-los-trabajos-en-cola-y-luego-salir"><a href="#procesar-todos-los-trabajos-en-cola-y-luego-salir" aria-hidden="true" class="header-anchor">#</a> Procesar Todos Los Trabajos En Cola Y Luego Salir</h4> <p>La opción <code>--stop-when-empty</code> puede ser usada para indicarle al worker procesar todos los trabajos y luego salir elegantemente. Esta opción puede ser útil al trabajar colas de Laravel con un contenedor Docker si deseas desactivar el contenedor cuando la cola esté vacía:</p> <div class="language-php extra-class"><pre class="language-php"><code>php artisan queue<span class="token punctuation">:</span>work <span class="token operator">--</span>stop<span class="token operator">-</span>when<span class="token operator">-</span>empty
</code></pre></div><h4 id="consideraciones-de-recursos"><a href="#consideraciones-de-recursos" aria-hidden="true" class="header-anchor">#</a> Consideraciones De Recursos</h4> <p>Los Daemon de workers de cola no &quot;reinician&quot; el framework antes de procesar cada trabajo. Por lo tanto, debes liberar cualquier recurso pesado luego de que cada trabajo sea completado. Por ejemplo, si estás realizando manipulación de imágenes con la librería GD, debes liberar la memoria cuando se termine con <code>imagedestroy</code>.</p> <p><a name="queue-priorities"></a></p> <h3 id="prioridades-de-cola"><a href="#prioridades-de-cola" aria-hidden="true" class="header-anchor">#</a> Prioridades De Cola</h3> <p>A veces puedes desear priorizar cómo se procesan las colas. Por ejemplo, en tu <code>config/queue.php</code> puedes establecer la <code>queue</code> predeterminada para tu conexión <code>redis</code> en <code>low</code>. Sin embargo, ocasionalmente puedes desear insertar un trabajo en una cola de prioridad <code>high</code> de esta forma:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Job</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">onQueue</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'high'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Para iniciar un worker que verifique que todos los trabajos en la cola <code>high</code> sean procesados antes de continuar con los tabajos en <code>low</code>, pasa una lista de nombres de colas delimitada por comas al comando <code>work</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code>php artisan queue<span class="token punctuation">:</span>work <span class="token operator">--</span>queue<span class="token operator">=</span>high<span class="token punctuation">,</span>low
</code></pre></div><p><a name="queue-workers-and-deployment"></a></p> <h3 id="workers-de-cola-y-despliegue"><a href="#workers-de-cola-y-despliegue" aria-hidden="true" class="header-anchor">#</a> Workers De Cola Y Despliegue</h3> <p>Debido a que los workers de cola son procesos de vida útil larga, no detectarán cambios en el código sin ser reiniciados.  Así que la forma más sencilla de poner en producción una aplicación utilizando workers de cola es reiniciando los workers durante el proceso de despliegue. Puedes con elegancia reiniciar todos los workers ejecutando el comando <code>queue:restart</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code>php artisan queue<span class="token punctuation">:</span>restart
</code></pre></div><p>Este comando indicará a todos los workers de cola que &quot;mueran&quot; luego de terminar el procesamiento de su trabajo actual para que ningún trabajo existente se pierda. Como los workers de cola morirán cuando se ejecute el comando <code>queue:restart</code>, un administrador de procesos debe estar en ejecución, como <a href="#supervisor-configuration">Supervisor</a> para reiniciar automáticamente los workers de la cola.</p> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>La cola utiliza <a href="/docs/%7B%7Bversion%7D%7D/cache">caché</a> para almacenar señales de reinicio, por lo que debes verificar si un driver de caché está configurado debidamente en tu aplicación antes de utilizar esta característica.</p></div> <p><a name="job-expirations-and-timeouts"></a></p> <h3 id="expiraciones-de-trabajo-y-tiempos-de-espera"><a href="#expiraciones-de-trabajo-y-tiempos-de-espera" aria-hidden="true" class="header-anchor">#</a> Expiraciones De Trabajo Y Tiempos De Espera</h3> <h4 id="expiracion-de-trabajos"><a href="#expiracion-de-trabajos" aria-hidden="true" class="header-anchor">#</a> Expiración De Trabajos</h4> <p>En tu archivo de configuración <code>config/queue.php</code>, cada conexión de cola define una opción <code>retry_after</code>. Esta opción especifica cuántos segundos debe esperar la conexión de cola antes de reintentar un trabajo que está siendo procesado. Por ejemplo, si el valor de <code>retry_after</code> es establecido en <code>90</code>, el trabajo será liberado de nuevo a la cola si se ha estado procesando por 90 segundos sin haber sido eliminado. Generalmente, debes fijar el valor de <code>retry_after</code> al número máximo de segundos que le toma razonablemente a tus trabajos ser completamente procesados.</p> <div class="danger custom-block"><p class="custom-block-title">Nota</p> <p>La única conexión de cola que no contiene un valor <code>retry_after</code> es Amazon SQS. SQS reintentará el trabajo basándose en el <a href="https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/AboutVT.html" target="_blank" rel="noopener noreferrer">Default Visibility Timeout<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> que es administrado dentro de la consola de AWS.</p></div> <h4 id="worker-timeouts"><a href="#worker-timeouts" aria-hidden="true" class="header-anchor">#</a> Worker Timeouts</h4> <p>El comando Artisan <code>queue:work</code> expone una opción <code>--timeout</code>. <code>--timeout</code> especifica qué tanto el proceso maestro de cola de Laravel esperará antes de detener un worker de cola hijo que está procesando un trabajo. A veces un proceso de cola hijo puede &quot;congelarse&quot; por varias razones, como una llamada HTTP externa que no responde. La opción <code>--timeout</code> remueve los procesos congelados que han excedido el tiempo límite especificado:</p> <div class="language-php extra-class"><pre class="language-php"><code>php artisan queue<span class="token punctuation">:</span>work <span class="token operator">--</span>timeout<span class="token operator">=</span><span class="token number">60</span>
</code></pre></div><p>La opción de configuración <code>retry_after</code> y la opción CLI <code>--timeout</code> son diferentes, pero trabajan juntas para asegurar que los trabajos no se pierdan y que los trabajos se procesen exitosamente sólo una vez.</p> <div class="danger custom-block"><p class="custom-block-title">Nota</p> <p>El valor <code>--timeout</code> siempre debe ser al menos unos segundos menor que el valor de configuración <code>retry_after</code>. Esto asegurará que un worker procesando un trabajo determinado siempre sea detenido antes que el trabajo se reintente. Si la opción <code>--timeout</code> es mayor al valor de configuración <code>retry_after</code>, los trabajos podrían ser procesados dos veces.</p></div> <h4 id="duracion-de-descanso-del-worker"><a href="#duracion-de-descanso-del-worker" aria-hidden="true" class="header-anchor">#</a> Duración De Descanso del Worker</h4> <p>Cuando hay trabajos disponibles en cola, el worker seguirá procesando trabajos sin retraso entre ellos. Sin embargo, la opción <code>sleep</code> determina por cuánto tiempo &quot;dormirá&quot; el worker si no hay nuevos trabajos disponibles. Mientras duerme, el worker no procesará trabajos nuevos - los trabajos serán procesados luego de que el worker despierte.</p> <div class="language-php extra-class"><pre class="language-php"><code>php artisan queue<span class="token punctuation">:</span>work <span class="token operator">--</span>sleep<span class="token operator">=</span><span class="token number">3</span>
</code></pre></div><p><a name="supervisor-configuration"></a></p> <h2 id="configuracion-de-supervisor"><a href="#configuracion-de-supervisor" aria-hidden="true" class="header-anchor">#</a> Configuración De Supervisor</h2> <h4 id="instalar-supervisor"><a href="#instalar-supervisor" aria-hidden="true" class="header-anchor">#</a> Instalar Supervisor</h4> <p>Supervisor es un monitor de procesos para el sistema operativo Linux y reiniciará automáticamente tu proceso <code>queue:work</code> si éste falla. Para instalar Supervisor en Ubuntu, se puede usar el siguiente comando:</p> <div class="language-php extra-class"><pre class="language-php"><code>sudo apt<span class="token operator">-</span>get install supervisor
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>Si configurar Supervisor por ti mismo suena abrumador, considera usar <a href="https://forge.laravel.com" target="_blank" rel="noopener noreferrer">Laravel Forge<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, el cual instalará y configurará Supervisor automáticamente para tus proyectos en Laravel.</p></div> <h4 id="configurar-supervisor"><a href="#configurar-supervisor" aria-hidden="true" class="header-anchor">#</a> Configurar Supervisor</h4> <p>Los archivos de configuración de Supervisor están almacenados generalmente en el directorio <code>/etc/supervisor/conf.d</code>. Dentro de este directorio, puedes crear cualquier número de archivos de configuración que le instruyan a Supervisor cómo monitorear los procesos.  Por ejemplo, creemos un archivo de configuración <code>laravel-worker.conf</code> que inicie y monitoree el proceso <code>queue:work</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token punctuation">[</span>program<span class="token punctuation">:</span>laravel<span class="token operator">-</span>worker<span class="token punctuation">]</span>
process_name<span class="token operator">=</span><span class="token operator">%</span><span class="token punctuation">(</span>program_name<span class="token punctuation">)</span>s_<span class="token operator">%</span><span class="token punctuation">(</span>process_num<span class="token punctuation">)</span><span class="token number">02</span>d
command<span class="token operator">=</span>php <span class="token operator">/</span>home<span class="token operator">/</span>forge<span class="token operator">/</span>app<span class="token punctuation">.</span>com<span class="token operator">/</span>artisan queue<span class="token punctuation">:</span>work sqs <span class="token operator">--</span>sleep<span class="token operator">=</span><span class="token number">3</span> <span class="token operator">--</span>tries<span class="token operator">=</span><span class="token number">3</span>
autostart<span class="token operator">=</span><span class="token boolean">true</span>
autorestart<span class="token operator">=</span><span class="token boolean">true</span>
user<span class="token operator">=</span>forge
numprocs<span class="token operator">=</span><span class="token number">8</span>
redirect_stderr<span class="token operator">=</span><span class="token boolean">true</span>
stdout_logfile<span class="token operator">=</span><span class="token operator">/</span>home<span class="token operator">/</span>forge<span class="token operator">/</span>app<span class="token punctuation">.</span>com<span class="token operator">/</span>worker<span class="token punctuation">.</span>log
</code></pre></div><p>En este ejemplo, la directiva <code>numprocs</code> le indicará a Supervisor ejecutar ocho procesos <code>queue:work</code> y monitorearlos todos, reiniciándolos automáticamente si fallan. Debes cambiar la porción <code>queue:work sqs</code> de la directiva <code>command</code> para reflejar la conexión de cola deseada.</p> <h4 id="iniciar-supervisor"><a href="#iniciar-supervisor" aria-hidden="true" class="header-anchor">#</a> Iniciar Supervisor</h4> <p>Una vez que el archivo de configuración haya sido creado, puedes actualizar la configuración de Supervisor e iniciar los procesos usando los siguientes comandos:</p> <div class="language-php extra-class"><pre class="language-php"><code>sudo supervisorctl reread

sudo supervisorctl update

sudo supervisorctl start laravel<span class="token operator">-</span>worker<span class="token punctuation">:</span><span class="token operator">*</span>
</code></pre></div><p>Para más información acerca de Supervisor, consulta <a href="http://supervisord.org/index.html" target="_blank" rel="noopener noreferrer">la documentación de Supervisor<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <p><a name="dealing-with-failed-jobs"></a></p> <h2 id="manejo-de-trabajos-fallidos"><a href="#manejo-de-trabajos-fallidos" aria-hidden="true" class="header-anchor">#</a> Manejo De Trabajos Fallidos</h2> <p>Algunas veces los trabajos en cola fallarán. Esto no es problema, ¡las cosas no siempre salen como esperamos! Laravel incluye una forma conveniente de especificar el número máximo de veces que un trabajo debe ser intentado. Luego que un trabajo haya excedido esta cantidad de intentos, será insertado en la tabla de base de datos <code>failed_jobs</code>. Para crear una migración para la tabla <code>failed_jobs</code> puedes usar el comando <code>queue:failed-table</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code>php artisan queue<span class="token punctuation">:</span>failed<span class="token operator">-</span>table

php artisan migrate
</code></pre></div><p>Entonces, al ejecutar el <a href="#running-the-queue-worker">worker de cola</a>, debes especificar el número máximo de intentos que un trabajo debe intentarse usando la opción <code>--tries</code> en el comando <code>queue:work</code> Si no especificas un valor para <code>--tries</code> los trabajos se intentarán indefinidamente:</p> <div class="language-php extra-class"><pre class="language-php"><code>php artisan queue<span class="token punctuation">:</span>work redis <span class="token operator">--</span>tries<span class="token operator">=</span><span class="token number">3</span>
</code></pre></div><p>Adicionalmente, puedes especificar cuantos segundos debe esperar Laravel antes de volver a intentar un trabajo que ha fallado usando la opción <code>--delay</code>. Por defecto, un trabajo se vuelve a intentar inmediatamente:</p> <div class="language-php extra-class"><pre class="language-php"><code>php artisan queue<span class="token punctuation">:</span>work redis <span class="token operator">--</span>tries<span class="token operator">=</span><span class="token number">3</span> <span class="token operator">--</span>delay<span class="token operator">=</span><span class="token number">3</span>
</code></pre></div><p>Si te gustaría configurar la demora del trabajo fallido por cada trabajo, puedes hacerlo definiendo una propiedad <code>retryAfter</code> en tu clase de cola de trabajos:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">/**
* The number of seconds to wait before retrying the job.
*
* @var int
*/</span>
<span class="token keyword">public</span> <span class="token variable">$retryAfter</span> <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
</code></pre></div><p><a name="cleaning-up-after-failed-jobs"></a></p> <h3 id="limpiar-despues-de-un-trabajo-fallido"><a href="#limpiar-despues-de-un-trabajo-fallido" aria-hidden="true" class="header-anchor">#</a> Limpiar Después De Un Trabajo Fallido</h3> <p>Se puede definir un método <code>failed</code> directamente en la clase de trabajo, permitiendo realizar una limpieza específica de trabajo cuando una falla ocurre. Esta es la ubicación perfecta para enviar una alerta a tus usuarios o revertir cualquier acción realizada por el trabajo. La <code>Exception</code> que causó la falla en el trabajo será pasada al método <code>failed</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Jobs</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Exception</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Podcast</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>AudioProcessor</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Bus<span class="token punctuation">\</span>Queueable</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Queue<span class="token punctuation">\</span>SerializesModels</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Queue<span class="token punctuation">\</span>InteractsWithQueue</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Contracts<span class="token punctuation">\</span>Queue<span class="token punctuation">\</span>ShouldQueue</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">ProcessPodcast</span> <span class="token keyword">implements</span> <span class="token class-name">ShouldQueue</span>
<span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token package">InteractsWithQueue</span><span class="token punctuation">,</span> Queueable<span class="token punctuation">,</span> SerializesModels<span class="token punctuation">;</span>

    <span class="token keyword">protected</span> <span class="token variable">$podcast</span><span class="token punctuation">;</span>

    <span class="token comment">/**
    * Create a new job instance.
    *
    * @param  Podcast  $podcast
    * @return void
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span>Podcast <span class="token variable">$podcast</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">podcast</span> <span class="token operator">=</span> <span class="token variable">$podcast</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
    * Execute the job.
    *
    * @param  AudioProcessor  $processor
    * @return void
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">handle</span><span class="token punctuation">(</span>AudioProcessor <span class="token variable">$processor</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Process uploaded podcast...</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
    * The job failed to process.
    *
    * @param  Exception  $exception
    * @return void
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">failed</span><span class="token punctuation">(</span>Exception <span class="token variable">$exception</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Send user notification of failure, etc...</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p><a name="failed-job-events"></a></p> <h3 id="eventos-de-trabajo-fallido"><a href="#eventos-de-trabajo-fallido" aria-hidden="true" class="header-anchor">#</a> Eventos De Trabajo Fallido</h3> <p>Si quieres registrar un evento para ser llamado cuando un trabajo falle, puedes usar el método <code>Queue::failing</code>. Este evento representa una gran oportunidad para notificarle a tu equipo por correo electrónico o por <a href="https://www.slack.com" target="_blank" rel="noopener noreferrer">Slack<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. Por ejemplo, puedes adjuntar una respuesta a este evento desde el <code>AppServiceProvider</code> incluido en Laravel:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Providers</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Support<span class="token punctuation">\</span>Facades<span class="token punctuation">\</span>Queue</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Queue<span class="token punctuation">\</span>Events<span class="token punctuation">\</span>JobFailed</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Support<span class="token punctuation">\</span>ServiceProvider</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">AppServiceProvider</span> <span class="token keyword">extends</span> <span class="token class-name">ServiceProvider</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * Register the service provider.
    *
    * @return void
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
    * Bootstrap any application services.
    *
    * @return void
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">boot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Queue<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">failing</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>JobFailed <span class="token variable">$event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// $event-&gt;connectionName</span>
            <span class="token comment">// $event-&gt;job</span>
            <span class="token comment">// $event-&gt;exception</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p><a name="retrying-failed-jobs"></a></p> <h3 id="reintentando-trabajos-fallidos"><a href="#reintentando-trabajos-fallidos" aria-hidden="true" class="header-anchor">#</a> Reintentando Trabajos Fallidos</h3> <p>Para visualizar todos los trabajos fallidos insertados en la tabla de base de datos <code>failed_jobs</code> se puede usar el comando Artisan <code>queue:failed</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code>php artisan queue<span class="token punctuation">:</span>failed
</code></pre></div><p>El comando <code>queue:failed</code> listará la ID del trabajo, su conexión, cola y el tiempo en el cual falló. La ID del trabajo puede ser usada para reintentar el trabajo fallido. Por ejemplo, para reintentar un trabajo fallido con una ID <code>5</code>, ejecuta el siguiente comando:</p> <div class="language-php extra-class"><pre class="language-php"><code>php artisan queue<span class="token punctuation">:</span>retry <span class="token number">5</span>
</code></pre></div><p>Para reintentar todos tus trabajos fallidos, ejecuta el comando <code>queue:retry</code> y pasa <code>all</code> como ID:</p> <div class="language-php extra-class"><pre class="language-php"><code>php artisan queue<span class="token punctuation">:</span>retry all
</code></pre></div><p>Si deseas borrar un trabajo fallido, puedes usar el comando <code>queue:forget</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code>php artisan queue<span class="token punctuation">:</span>forget <span class="token number">5</span>
</code></pre></div><p>Para eliminar todos los trabajos fallidos, puedes usar el comando <code>queue:flush</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code>php artisan queue<span class="token punctuation">:</span>flush
</code></pre></div><p><a name="ignoring-missing-models"></a></p> <h3 id="ignorando-modelos-faltantes"><a href="#ignorando-modelos-faltantes" aria-hidden="true" class="header-anchor">#</a> Ignorando Modelos Faltantes</h3> <p>Cuando inyectas un modelo Eloquent en un trabajo, se serializa automáticamente antes de colocarlo en la cola y se restaura cuando se procesa el trabajo. Sin embargo, si el modelo ha sido eliminado mientras el trabajo estaba esperando a ser procesado por un trabajador, tu trabajo puede fallar con la excepción <code>ModelNotFoundException</code>.</p> <p>Por conveniencia, puedes elegir eliminar automáticamente los trabajos con modelos faltantes configurando la propiedad <code>deleteWhenMissingModels</code> de tu trabajo en <code>true</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">/**
* Delete the job if its models no longer exist.
*
* @var bool
*/</span>
<span class="token keyword">public</span> <span class="token variable">$deleteWhenMissingModels</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
</code></pre></div><p><a name="job-events"></a></p> <h2 id="eventos-de-trabajo"><a href="#eventos-de-trabajo" aria-hidden="true" class="header-anchor">#</a> Eventos De Trabajo</h2> <p>Usando los métodos <code>before</code> y <code>after</code> en la <a href="/docs/%7B%7Bversion%7D%7D/facades">facade</a> <code>Queue</code>, puedes especificar funciones de retorno (callbacks) para que sean ejecutadas antes o después de que un trabajo en cola sea procesado. Estas callbacks son una gran oportunidad para realizar registro adicional o incrementar estadísticas para un panel de control. Generalmente, debes llamar a estos métodos desde un <a href="/docs/%7B%7Bversion%7D%7D/providers">proveedor de servicios</a>. Por ejemplo puedes usar  <code>AppServiceProvider</code>, incluido en Laravel:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Providers</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Support<span class="token punctuation">\</span>Facades<span class="token punctuation">\</span>Queue</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Support<span class="token punctuation">\</span>ServiceProvider</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Queue<span class="token punctuation">\</span>Events<span class="token punctuation">\</span>JobProcessed</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Queue<span class="token punctuation">\</span>Events<span class="token punctuation">\</span>JobProcessing</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">AppServiceProvider</span> <span class="token keyword">extends</span> <span class="token class-name">ServiceProvider</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * Bootstrap any application services.
    *
    * @return void
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">boot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Queue<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">before</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>JobProcessing <span class="token variable">$event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// $event-&gt;connectionName</span>
            <span class="token comment">// $event-&gt;job</span>
            <span class="token comment">// $event-&gt;job-&gt;payload()</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        Queue<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">after</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>JobProcessed <span class="token variable">$event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// $event-&gt;connectionName</span>
            <span class="token comment">// $event-&gt;job</span>
            <span class="token comment">// $event-&gt;job-&gt;payload()</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
    * Register the service provider.
    *
    * @return void
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p>Usando el método <code>looping</code> en la <a href="/docs/%7B%7Bversion%7D%7D/facades">facade</a> <code>Queue</code>, puedes especificar funciones de retorno (callbacks) que se ejecuten antes que el worker intente recuperar un trabajo de una cola. Por ejemplo, quizás necesites registrar una Closure para deshacer cualquier transacción abierta por un trabajo fallido anteriormente:</p> <div class="language-php extra-class"><pre class="language-php"><code>Queue<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">looping</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token constant">DB</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">transactionLevel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token constant">DB</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">rollBack</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/packages.html" class="prev">
          Desarrollo de Paquetes
        </a></span> <span class="next"><a href="/scheduling.html">
          Programación de tareas
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/app.bf22240a.js" defer></script><script src="/assets/js/60.b4fe788b.js" defer></script>
  </body>
</html>
