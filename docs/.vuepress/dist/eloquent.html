<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Eloquent: Primeros Pasos | Documentación de Laravel en Español</title>
    <meta name="description" content="Documentación de Laravel en Español">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Catamaran:300,700|Miriam+Libre">
    
    <link rel="preload" href="/assets/css/0.styles.0cc2d3c3.css" as="style"><link rel="preload" href="/assets/js/app.bf22240a.js" as="script"><link rel="preload" href="/assets/js/32.6657300b.js" as="script"><link rel="prefetch" href="/assets/js/10.8a8a99df.js"><link rel="prefetch" href="/assets/js/11.ec476e2f.js"><link rel="prefetch" href="/assets/js/12.6db1eb13.js"><link rel="prefetch" href="/assets/js/13.92d78bb5.js"><link rel="prefetch" href="/assets/js/14.1a0ad5f1.js"><link rel="prefetch" href="/assets/js/15.abc982c9.js"><link rel="prefetch" href="/assets/js/16.7cf1a759.js"><link rel="prefetch" href="/assets/js/17.4abfc664.js"><link rel="prefetch" href="/assets/js/18.85b19837.js"><link rel="prefetch" href="/assets/js/19.8c9dfcd5.js"><link rel="prefetch" href="/assets/js/2.dcb6cf45.js"><link rel="prefetch" href="/assets/js/20.c1b9de54.js"><link rel="prefetch" href="/assets/js/21.469ffab3.js"><link rel="prefetch" href="/assets/js/22.2d14e150.js"><link rel="prefetch" href="/assets/js/23.7a4dcc9a.js"><link rel="prefetch" href="/assets/js/24.534e59f1.js"><link rel="prefetch" href="/assets/js/25.eaac1c07.js"><link rel="prefetch" href="/assets/js/26.8e9180e0.js"><link rel="prefetch" href="/assets/js/27.2cd2ace8.js"><link rel="prefetch" href="/assets/js/28.9f7dcf6d.js"><link rel="prefetch" href="/assets/js/29.06a87f0d.js"><link rel="prefetch" href="/assets/js/3.b62bf0b4.js"><link rel="prefetch" href="/assets/js/30.b03f86ec.js"><link rel="prefetch" href="/assets/js/31.edce81f6.js"><link rel="prefetch" href="/assets/js/33.8dc49209.js"><link rel="prefetch" href="/assets/js/34.03cbee56.js"><link rel="prefetch" href="/assets/js/35.5439db2e.js"><link rel="prefetch" href="/assets/js/36.83d5a264.js"><link rel="prefetch" href="/assets/js/37.4066824e.js"><link rel="prefetch" href="/assets/js/38.c3fe05aa.js"><link rel="prefetch" href="/assets/js/39.52ef8667.js"><link rel="prefetch" href="/assets/js/4.bd0ebba2.js"><link rel="prefetch" href="/assets/js/40.2c54d702.js"><link rel="prefetch" href="/assets/js/41.775bc6e1.js"><link rel="prefetch" href="/assets/js/42.6541d60b.js"><link rel="prefetch" href="/assets/js/43.20091aea.js"><link rel="prefetch" href="/assets/js/44.75b71ccc.js"><link rel="prefetch" href="/assets/js/45.6b36a3a8.js"><link rel="prefetch" href="/assets/js/46.6ea236af.js"><link rel="prefetch" href="/assets/js/47.0e0ee374.js"><link rel="prefetch" href="/assets/js/48.b6beb9b8.js"><link rel="prefetch" href="/assets/js/49.ae33b521.js"><link rel="prefetch" href="/assets/js/5.2c350d8b.js"><link rel="prefetch" href="/assets/js/50.5cb081e0.js"><link rel="prefetch" href="/assets/js/51.3e0281e2.js"><link rel="prefetch" href="/assets/js/52.e1fae1d6.js"><link rel="prefetch" href="/assets/js/53.0a9d4aed.js"><link rel="prefetch" href="/assets/js/54.55bc9113.js"><link rel="prefetch" href="/assets/js/55.e964fdb4.js"><link rel="prefetch" href="/assets/js/56.3abed8a0.js"><link rel="prefetch" href="/assets/js/57.df09269b.js"><link rel="prefetch" href="/assets/js/58.3ce37458.js"><link rel="prefetch" href="/assets/js/59.7a840aeb.js"><link rel="prefetch" href="/assets/js/6.6fce793d.js"><link rel="prefetch" href="/assets/js/60.b4fe788b.js"><link rel="prefetch" href="/assets/js/61.e45356bb.js"><link rel="prefetch" href="/assets/js/62.0d75cf78.js"><link rel="prefetch" href="/assets/js/63.0ecae205.js"><link rel="prefetch" href="/assets/js/64.90fb2c2d.js"><link rel="prefetch" href="/assets/js/65.7c476002.js"><link rel="prefetch" href="/assets/js/66.802dee8b.js"><link rel="prefetch" href="/assets/js/67.ae965c66.js"><link rel="prefetch" href="/assets/js/68.220c04d8.js"><link rel="prefetch" href="/assets/js/69.bf607b92.js"><link rel="prefetch" href="/assets/js/7.b956f78c.js"><link rel="prefetch" href="/assets/js/70.dea3d878.js"><link rel="prefetch" href="/assets/js/71.1f786e34.js"><link rel="prefetch" href="/assets/js/72.4bd65b39.js"><link rel="prefetch" href="/assets/js/73.414b29bd.js"><link rel="prefetch" href="/assets/js/74.b5ab4f13.js"><link rel="prefetch" href="/assets/js/75.f12fbb27.js"><link rel="prefetch" href="/assets/js/76.a140d22b.js"><link rel="prefetch" href="/assets/js/77.2595933c.js"><link rel="prefetch" href="/assets/js/78.46bb4eff.js"><link rel="prefetch" href="/assets/js/79.c549a0e3.js"><link rel="prefetch" href="/assets/js/8.3be12d8d.js"><link rel="prefetch" href="/assets/js/80.1b9cd731.js"><link rel="prefetch" href="/assets/js/81.6aa05825.js"><link rel="prefetch" href="/assets/js/9.60a01cba.js">
    <link rel="stylesheet" href="/assets/css/0.styles.0cc2d3c3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Documentación de Laravel en Español</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Inicio</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Inicio</a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading"><span>Primeros Pasos</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Conceptos De Arquitectura</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Fundamentos</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Frontend</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Seguridad</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Profundizando</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Bases De Datos</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>ORM Eloquent</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/eloquent.html" class="active sidebar-link">Eloquent: Primeros Pasos</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/eloquent.html#introduccion" class="sidebar-link">Introducción</a></li><li class="sidebar-sub-header"><a href="/eloquent.html#definiendo-modelos" class="sidebar-link">Definiendo Modelos</a></li><li class="sidebar-sub-header"><a href="/eloquent.html#obteniendo-modelos" class="sidebar-link">Obteniendo Modelos</a></li><li class="sidebar-sub-header"><a href="/eloquent.html#obteniendo-modelos-individuales-agrupamientos" class="sidebar-link">Obteniendo Modelos Individuales / Agrupamientos</a></li><li class="sidebar-sub-header"><a href="/eloquent.html#insertando-y-actualizando-modelos" class="sidebar-link">Insertando Y Actualizando Modelos</a></li><li class="sidebar-sub-header"><a href="/eloquent.html#eliminando-modelos" class="sidebar-link">Eliminando Modelos</a></li><li class="sidebar-sub-header"><a href="/eloquent.html#alcances-scopes-de-consultas" class="sidebar-link">Alcances (Scopes) de Consultas</a></li><li class="sidebar-sub-header"><a href="/eloquent.html#comparando-modelos" class="sidebar-link">Comparando Modelos</a></li><li class="sidebar-sub-header"><a href="/eloquent.html#eventos" class="sidebar-link">Eventos</a></li></ul></li><li><a href="/eloquent-relationships.html" class="sidebar-link">Eloquent: Relaciones</a></li><li><a href="/eloquent-collections.html" class="sidebar-link">Eloquent: Colecciones</a></li><li><a href="/eloquent-mutators.html" class="sidebar-link">Eloquent: Mutators</a></li><li><a href="/eloquent-serialization.html" class="sidebar-link">Eloquent: Serialización</a></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Pruebas</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Paquetes oficiales</span> <span class="arrow right"></span></p> <!----></div></li></ul> </div> <div class="page"> <div class="content"><div><h1 id="eloquent-primeros-pasos"><a class="header-anchor" href="#eloquent-primeros-pasos" aria-hidden="true">#</a> Eloquent: Primeros Pasos</h1> <ul><li><a href="#introduction">Introducción</a></li> <li><a href="#defining-models">Definiendo Modelos</a> <ul><li><a href="#eloquent-model-conventions">Convenciones Del Modelo Eloquent</a></li> <li><a href="#default-attribute-values">Valores De Atributo Predeterminados</a></li></ul></li> <li><a href="#retrieving-models">Obteniendo Modelos</a> <ul><li><a href="#collections">Colecciones</a></li> <li><a href="#chunking-results">Resultados Divididos En Partes (chunk)</a></li></ul></li> <li><a href="#retrieving-single-models">Obteniendo Modelos Individuales / Agrupamientos</a> <ul><li><a href="#retrieving-aggregates">Obteniendo Agrupamientos</a></li></ul></li> <li><a href="#inserting-and-updating-models">Insertando Y Actualizando Modelos</a> <ul><li><a href="#inserts">Inserciones</a></li> <li><a href="#updates">Actualizaciones</a></li> <li><a href="#mass-assignment">Asignación Masiva</a></li> <li><a href="#other-creation-methods">Otros Métodos De Creación</a></li></ul></li> <li><a href="#deleting-models">Eliminando Modelos</a> <ul><li><a href="#soft-deleting">Eliminación Lógica</a></li> <li><a href="#querying-soft-deleted-models">Consultando Modelos Eliminados Lógicamente</a></li></ul></li> <li><a href="#query-scopes">Alcances de Consulta</a> <ul><li><a href="#global-scopes">Alcances Globales</a></li> <li><a href="#local-scopes">Alcances Locales</a></li></ul></li> <li><a href="#comparing-models">Comparando Modelos</a></li> <li><a href="#events">Eventos</a> <ul><li><a href="#observers">Observadores</a></li></ul></li></ul> <p><a name="introduction"></a></p> <h2 id="introduccion"><a class="header-anchor" href="#introduccion" aria-hidden="true">#</a> Introducción</h2> <p>El ORM Eloquent incluido con Laravel proporciona una genial y simple implentación básica de ActiveRecord para trabajar con tu base de datos. Cada tabla de base de datos tiene un correspondiente &quot;Modelo&quot; el cual es usado para interactuar con la tabla. Los modelos permiten que consultes los datos en tus tablas, así como también insertar nuevos registros dentro de la tabla.</p> <p>Antes de empezar, asegúrate de configurar una conexión de base de datos en <code>config/database.php</code>. Para mayor información sobre la configuración de tu base de datos, revisa <a href="/docs/%7B%7Bversion%7D%7D/database#configuration">la documentación</a>.</p> <p><a name="defining-models"></a></p> <h2 id="definiendo-modelos"><a class="header-anchor" href="#definiendo-modelos" aria-hidden="true">#</a> Definiendo Modelos</h2> <p>Para empezar, vamos a crear un modelo de Eloquent. Los modelos residen típicamente en el directorio <code>app</code>, pero eres libre de colocarlos en cualquier parte que pueda ser auto-cargada de acuerdo a tu archivo <code>composer.json</code>. Todos los modelos de Eloquent extienden la clase <code>Illuminate\Database\Eloquent\Model</code>.</p> <p>La forma más fácil de crear una instancia del modelo es usando el <a href="/docs/%7B%7Bversion%7D%7D/artisan">Comando Artisan</a> <code>make:model</code>:</p> <div class="language-php extra-class"><pre v-pre class="language-php"><code>php artisan make<span class="token punctuation">:</span>model Flight
</code></pre></div><p>Si prefieres generar una <a href="/docs/%7B%7Bversion%7D%7D/migrations">migración de base de datos</a> cuando generes el modelo, puedes usar la opción <code>--migration</code> o <code>-m</code>:</p> <div class="language-php extra-class"><pre v-pre class="language-php"><code>php artisan make<span class="token punctuation">:</span>model Flight <span class="token operator">--</span>migration

php artisan make<span class="token punctuation">:</span>model Flight <span class="token operator">-</span>m
</code></pre></div><p><a name="eloquent-model-conventions"></a></p> <h3 id="convenciones-del-modelo-eloquent"><a class="header-anchor" href="#convenciones-del-modelo-eloquent" aria-hidden="true">#</a> Convenciones Del Modelo Eloquent</h3> <p>Ahora, vamos a mirar un modelo <code>Flight</code> de ejemplo, el cual usaremos para obtener y guardar información desde nuestra tabla de base de datos <code>flights</code>:</p> <div class="language-php extra-class"><pre v-pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Flight</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token comment">//</span>
<span class="token punctuation">}</span>
</span></code></pre></div><h4 id="nombres-de-tabla"><a class="header-anchor" href="#nombres-de-tabla" aria-hidden="true">#</a> Nombres De Tabla</h4> <p>Observa que no le dijimos a Eloquent cuál tabla usar para nuestro modelo <code>Flight</code>. Por convención, el nombre de la clase en plural y en formato &quot;snake_case&quot; será usado como el nombre de tabla a menos que otro nombre sea especificado expresamente. Así, en este caso, Eloquent asumirá que el modelo <code>Flight</code> guarde los registros en la tabla <code>flights</code>. Puedes especificar una tabla personalizada al definir una propiedad <code>table</code> en tu modelo:</p> <div class="language-php extra-class"><pre v-pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Flight</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * The table associated with the model.
    *
    * @var string
    */</span>
    <span class="token keyword">protected</span> <span class="token variable">$table</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'my_flights'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></code></pre></div><h4 id="claves-primarias"><a class="header-anchor" href="#claves-primarias" aria-hidden="true">#</a> Claves Primarias</h4> <p>Eloquent asumirá que cada tabla tiene una columna de clave primaria denominada <code>id</code>. Puedes definir una propiedad <code>$primaryKey</code> protegida para sobrescribir esta convención:</p> <div class="language-php extra-class"><pre v-pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Flight</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * The primary key associated with the table.
    *
    * @var string
    */</span>
    <span class="token keyword">protected</span> <span class="token variable">$primaryKey</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'flight_id'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p>Además, Eloquent asume que la clave primaria es un valor entero autoincremental, lo que significa que de forma predeterminada la clave primaria será convertida a un tipo <code>int</code> automáticamente. Si deseas usar una clave primaria que no sea de autoincremeneto o numérica debes establecer la propiedad pública <code>$incrementing</code> de tu modelo a <code>false</code>:</p> <div class="language-php extra-class"><pre v-pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">class</span> <span class="token class-name">Flight</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * Indicates if the IDs are auto-incrementing.
    *
    * @var bool
    */</span>
    <span class="token keyword">public</span> <span class="token variable">$incrementing</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p>Si tu clave primaria no es un entero, debes establecer la propiedad protegida <code>$keyType</code> de tu modelo a <code>string</code>:</p> <div class="language-php extra-class"><pre v-pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">class</span> <span class="token class-name">Flight</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * The &quot;type&quot; of the auto-incrementing ID.
    *
    * @var string
    */</span>
    <span class="token keyword">protected</span> <span class="token variable">$keyType</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'string'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></code></pre></div><h4 id="marcas-de-tiempo-o-timestamps"><a class="header-anchor" href="#marcas-de-tiempo-o-timestamps" aria-hidden="true">#</a> Marcas De Tiempo O Timestamps</h4> <p>De forma predeterminada, Eloquent espera que las columnas <code>created_at</code> y <code>updated_at</code> existan en tus tablas. Si no deseas tener estas columnas manejadas automáticamente por Eloquent, establece la propiedad <code>$timestamps</code> de tu modelo a <code>false</code>:</p> <div class="language-php extra-class"><pre v-pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Flight</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * Indicates if the model should be timestamped.
    *
    * @var bool
    */</span>
    <span class="token keyword">public</span> <span class="token variable">$timestamps</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p>Si necesitas personalizar el formato de tus marcas de tiempo, establece la propiedad <code>$dateFormat</code> de tu modelo. Esta propiedad determina como los atributos de fecha son guardados en la base de datos, también como su formato cuando el modelo es serializado a un arreglo o JSON:</p> <div class="language-php extra-class"><pre v-pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Flight</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * The storage format of the model's date columns.
    *
    * @var string
    */</span>
    <span class="token keyword">protected</span> <span class="token variable">$dateFormat</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'U'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p>Si necesitas personalizar los nombres de las columnas usadas para guardar las marcas de tiempo, puedes establecer las constantes <code>CREATED_AT</code> y <code>UPDATED_AT</code>en tu modelo:</p> <div class="language-php extra-class"><pre v-pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">class</span> <span class="token class-name">Flight</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token constant">CREATED_AT</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'creation_date'</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token constant">UPDATED_AT</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'last_update'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></code></pre></div><h4 id="conexion-de-base-de-datos"><a class="header-anchor" href="#conexion-de-base-de-datos" aria-hidden="true">#</a> Conexión de Base de Datos</h4> <p>De forma predeterminada, todos los modelos Eloquent usarán la conexión de base de datos configurada por tu aplicación. Si quieres especificar una conexión diferente para el modelo, usa la propiedad <code>$connection</code>:</p> <div class="language-php extra-class"><pre v-pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Flight</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * The connection name for the model.
    *
    * @var string
    */</span>
    <span class="token keyword">protected</span> <span class="token variable">$connection</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'connection-name'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p><a name="default-attribute-values"></a></p> <h3 id="valores-de-atributo-predeterminados"><a class="header-anchor" href="#valores-de-atributo-predeterminados" aria-hidden="true">#</a> Valores De Atributo Predeterminados</h3> <p>Si deseas definir los valores predeterminados para algunos de los atributos de su modelo, puedes definir una propiedad <code>$attributes</code> en tu modelo:</p> <div class="language-php extra-class"><pre v-pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Flight</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * The model's default values for attributes.
    *
    * @var array
    */</span>
    <span class="token keyword">protected</span> <span class="token variable">$attributes</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token single-quoted-string string">'delayed'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p><a name="retrieving-models"></a></p> <h2 id="obteniendo-modelos"><a class="header-anchor" href="#obteniendo-modelos" aria-hidden="true">#</a> Obteniendo Modelos</h2> <p>Una vez que has creado un modelo y <a href="/docs/%7B%7Bversion%7D%7D/migrations#writing-migrations">su tabla de base de datos asociada</a>, estás listo para empezar a obtener datos de tu base de datos. Piensa en cada modelo de Eloquent como un <a href="/docs/%7B%7Bversion%7D%7D/queries">constructor de consultas</a> muy poderoso que te permite consultar fluidamente la tabla de base de datos asociada con el modelo. Por ejemplo:</p> <div class="language-php extra-class"><pre v-pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token variable">$flights</span> <span class="token operator">=</span> App\<span class="token package">Flight</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$flights</span> <span class="token keyword">as</span> <span class="token variable">$flight</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">echo</span> <span class="token variable">$flight</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">name</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></code></pre></div><h4 id="anadiendo-restricciones-adicionales"><a class="header-anchor" href="#anadiendo-restricciones-adicionales" aria-hidden="true">#</a> Añadiendo Restricciones Adicionales</h4> <p>El método <code>all</code> de Eloquent devolverá todos los resultados en la tabla del modelo. Ya que cada modelo de Eloquent sirve como un <a href="/docs/%7B%7Bversion%7D%7D/queries">constructor de consultas</a>, también puedes añadir restricciones a las consultas y entonces usar el método <code>get</code> para obtener los resultados:</p> <div class="language-php extra-class"><pre v-pre class="language-php"><code><span class="token variable">$flights</span> <span class="token operator">=</span> App\<span class="token package">Flight</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'active'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
                <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">orderBy</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'name'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'desc'</span><span class="token punctuation">)</span>
                <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">take</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
                <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>Ya que los modelos de Eloquent son constructores de consultas, deberías revisar todos los métodos disponibles en el <a href="/docs/%7B%7Bversion%7D%7D/queries">constructor de consultas</a>. Puedes usar cualquiera de estos métodos en tus consultas de Eloquent.</p></div></div> <h4 id="actualizando-modelos"><a href="#actualizando-modelos" aria-hidden="true" class="header-anchor">#</a> Actualizando Modelos</h4> <p>Podemos actualizar modelos usando los métodos <code>fresh</code> y <code>refresh</code>. El método <code>fresh</code> volverá a recuperar el modelo de la base de datos. La instancia de modelo existente no será afectada:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$flight</span> <span class="token operator">=</span> App\<span class="token package">Flight</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'number'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'FR 900'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$freshFlight</span> <span class="token operator">=</span> <span class="token variable">$flight</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">fresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>El método <code>refresh</code> &quot;rehidratará&quot; el modelo existente usando datos nuevos de la base de datos. Además, todas sus relaciones cargadas previamente serán también actualizadas:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$flight</span> <span class="token operator">=</span> App\<span class="token package">Flight</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'number'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'FR 900'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$flight</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">number</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'FR 456'</span><span class="token punctuation">;</span>

<span class="token variable">$flight</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$flight</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">number</span><span class="token punctuation">;</span> <span class="token comment">// &quot;FR 900&quot;</span>
</code></pre></div><p><a name="collections"></a></p> <h3 id="colecciones"><a href="#colecciones" aria-hidden="true" class="header-anchor">#</a> Colecciones</h3> <p>Para métodos de Eloquent como <code>all</code> y <code>get</code> que obtienen varios resultados, se devolverá una instancia de <code>Illuminate\Database\Eloquent\Collection</code>. La clase <code>Collection</code> proporciona <a href="/docs/%7B%7Bversion%7D%7D/eloquent-collections#available-methods">una variedad de métodos útiles</a> para trabajar con los resultados de Eloquent:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$flights</span> <span class="token operator">=</span> <span class="token variable">$flights</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$flight</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token variable">$flight</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">cancelled</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>También puedes recorrer la colección como un arreglo:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$flights</span> <span class="token keyword">as</span> <span class="token variable">$flight</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">echo</span> <span class="token variable">$flight</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">name</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><a name="chunking-results"></a></p> <h3 id="resultados-divididos-en-partes-chunk"><a href="#resultados-divididos-en-partes-chunk" aria-hidden="true" class="header-anchor">#</a> Resultados Divididos En Partes (chunk)</h3> <p>Si necesitas procesar miles de registros de Eloquent, usa el comando <code>chunk</code>. El método <code>chunk</code> obtendrá una &quot;porción&quot; de los modelos de Eloquent, incorporándolos a una <code>Closure</code> dada para procesamiento. Usando el método <code>chunk</code> ahorrarás memoria al momento de trabajar con grandes conjuntos de resultados:</p> <div class="language-php extra-class"><pre class="language-php"><code>Flight<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">chunk</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$flights</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$flights</span> <span class="token keyword">as</span> <span class="token variable">$flight</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>El primer argumento pasado al método es el número de registros que deseas obtener por cada &quot;porción&quot;. La Closure pasada como segundo argumento será ejecutada para cada porción que sea obtenida de la base de datos. Una consulta de base de datos será ejecutada para obtener cada porción de registros pasados a la Closure.</p> <h4 id="usando-cursores"><a href="#usando-cursores" aria-hidden="true" class="header-anchor">#</a> Usando Cursores</h4> <p>El método <code>cursor</code> permite que iteres a través de registros de tu base de datos usando un cursor, el cual ejecutará solamente una consulta única. Al momento de procesar grandes cantidades de datos, puedes usar el método <code>cursor</code> para reducir en gran medida el uso de la memoria:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">foreach</span> <span class="token punctuation">(</span>Flight<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'foo'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'bar'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">cursor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token variable">$flight</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//</span>
<span class="token punctuation">}</span>
</code></pre></div><p><a name="retrieving-single-models"></a></p> <h2 id="obteniendo-modelos-individuales-agrupamientos"><a href="#obteniendo-modelos-individuales-agrupamientos" aria-hidden="true" class="header-anchor">#</a> Obteniendo Modelos Individuales / Agrupamientos</h2> <p>Además de obtener todos los registros de una tabla dada, también puedes obtener registros individuales usando <code>find</code> o <code>first</code>. En lugar de devolver una colección de modelos, estos métodos devuelven una única instancia de modelo:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">// Recupera un modelo por su clave primaria...</span>
<span class="token variable">$flight</span> <span class="token operator">=</span> App\<span class="token package">Flight</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Recupera el primer modelo que coincida con las restricciones de consulta...</span>
<span class="token variable">$flight</span> <span class="token operator">=</span> App\<span class="token package">Flight</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'active'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>También puedes ejecutar el método <code>find</code> con un arreglo de claves primarias, el cual devolverá una colección de los registros que coincidan:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$flights</span> <span class="token operator">=</span> App\<span class="token package">Flight</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="excepciones-not-found-no-encontrado"><a href="#excepciones-not-found-no-encontrado" aria-hidden="true" class="header-anchor">#</a> Excepciones Not Found (No Encontrado)</h4> <p>Algunas veces, puedes desear arrojar una excepción si un modelo no es encontrado. Es particularmente útil en rutas o controladores. Los métodos <code>findOrFail</code> y <code>firstOrFail</code> obtendrán el primer resultado de la consulta; sin embargo, si nada es encontrado, una excepción de <code>Illuminate\Database\Eloquent\ModelNotFoundException</code> será arrojada:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$model</span> <span class="token operator">=</span> App\<span class="token package">Flight</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">findOrFail</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$model</span> <span class="token operator">=</span> App\<span class="token package">Flight</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'legs'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'&gt;'</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">firstOrFail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Si la excepción no es atrapada, una respuesta HTTP <code>404</code> es enviada automáticamente de regreso al usuario. No es necesario escribir verificaciones explícitas para devolver respuestas <code>404</code> cuando uses estos métodos:</p> <div class="language-php extra-class"><pre class="language-php"><code>Route<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'/api/flights/{id}'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> App\<span class="token package">Flight</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">findOrFail</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><a name="retrieving-aggregates"></a></p> <h3 id="obteniendo-agrupamientos"><a href="#obteniendo-agrupamientos" aria-hidden="true" class="header-anchor">#</a> Obteniendo Agrupamientos</h3> <p>También puedes usar los métodos <code>count</code>, <code>sum</code>, <code>max</code> y otros <a href="/docs/%7B%7Bversion%7D%7D/queries#aggregates">métodos de agrupamiento</a> proporcionados por el <a href="/docs/%7B%7Bversion%7D%7D/queries">constructor de consulta</a>. Estos métodos devuelven el valor escalar apropiado en lugar de una completa instancia de modelo:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$count</span> <span class="token operator">=</span> App\<span class="token package">Flight</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'active'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$max</span> <span class="token operator">=</span> App\<span class="token package">Flight</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'active'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'price'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><a name="inserting-and-updating-models"></a></p> <h2 id="insertando-y-actualizando-modelos"><a href="#insertando-y-actualizando-modelos" aria-hidden="true" class="header-anchor">#</a> Insertando Y Actualizando Modelos</h2> <p><a name="inserts"></a></p> <h3 id="inserciones"><a href="#inserciones" aria-hidden="true" class="header-anchor">#</a> Inserciones</h3> <p>Para agregar un nuevo registro en la base de datos crea una nueva instancia de modelo, establece los atributos del modelo y después ejecuta el método <code>save</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Controllers</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Flight</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Request</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Controllers<span class="token punctuation">\</span>Controller</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">FlightController</span> <span class="token keyword">extends</span> <span class="token class-name">Controller</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * Create a new flight instance.
    *
    * @param  Request  $request
    * @return Response
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">store</span><span class="token punctuation">(</span>Request <span class="token variable">$request</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Validate the request...</span>

        <span class="token variable">$flight</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Flight</span><span class="token punctuation">;</span>

        <span class="token variable">$flight</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">name</span> <span class="token operator">=</span> <span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">name</span><span class="token punctuation">;</span>

        <span class="token variable">$flight</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p>En este ejemplo, asignamos el parámetro <code>name</code> de la solicitud entrante al atributo <code>name</code> de la instancia del modelo <code>App\Flight</code>. Cuando ejecutamos el método <code>save</code>, un registro será insertado en la base de datos. Las marcas de tiempo <code>created_at</code> y <code>updated_at</code> serán automáticamente establecidas cuando el método <code>save</code> sea ejecutado, no hay necesidad de establecerlos manualmente.</p> <p><a name="updates"></a></p> <h3 id="actualizaciones"><a href="#actualizaciones" aria-hidden="true" class="header-anchor">#</a> Actualizaciones</h3> <p>El método <code>save</code> también puede ser usado para actualizar modelos que ya existen en la base de datos. Para actualizar un modelo, debes obtenerlo, establecer cualquiera de los atributos que desees actualizar y después ejecutar el método <code>save</code>. Otra vez, la marca de tiempo <code>updated_at</code> será actualizada automáticamente, no hay necesidad de establecer su valor manualmente.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$flight</span> <span class="token operator">=</span> App\<span class="token package">Flight</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$flight</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">name</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'New Flight Name'</span><span class="token punctuation">;</span>

<span class="token variable">$flight</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="actualizaciones-masivas"><a href="#actualizaciones-masivas" aria-hidden="true" class="header-anchor">#</a> Actualizaciones Masivas</h4> <p>Las actualizaciones también pueden ser ejecutadas contra cualquier número de modelos que coincidan con un criterio de consulta dada. En este ejemplo, todos los vuelos que están activos o con <code>active</code> igual a 1 y tienen un atributo <code>destination</code> igual a <code>San Diego</code> serán marcados como retrasados:</p> <div class="language-php extra-class"><pre class="language-php"><code>App\<span class="token package">Flight</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'active'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'destination'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'San Diego'</span><span class="token punctuation">)</span>
            <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'delayed'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>El método <code>update</code> espera un arreglo de pares de columna y valor representando las columnas que deberían ser actualizadas.</p> <div class="danger custom-block"><p class="custom-block-title">Nota</p> <p>Al momento de utilizar una actualización masiva por medio de Eloquent, los eventos de modelo <code>saved</code> y <code>updated</code> no serán disparados para los modelos actualizados. Esto es debido a que los modelos nunca son obtenidos en realidad al momento de hacer una actualización masiva.</p></div> <p><a name="mass-assignment"></a></p> <h3 id="asignacion-masiva"><a href="#asignacion-masiva" aria-hidden="true" class="header-anchor">#</a> Asignación Masiva</h3> <p>También puedes usar el método <code>create</code> para guardar un nuevo modelo en una sola línea. La instancia de modelo insertada te será devuelta por el método. Sin embargo, antes de hacer eso, necesitarás especificar o un atributo <code>fillable</code> o <code>guarded</code> del modelo, de modo que todos los modelos de Eloquent se protejan contra la asignación masiva de forma predeterminada.</p> <p>Una vulnerabilidad en la asignación masiva ocurre cuando un usuario pasa un parámetro HTTP inesperado a través de una solicitud y ese parámetro cambia una columna en tu base de datos que no esperabas. Por ejemplo, un usuario malicioso podría enviar un parámetro <code>is_admin</code> a través de una solicitud HTTP, la cual es entonces pasada en el método <code>create</code> de tu modelo, permitiendo que el usuario se promueva a si mismo como un usuario administrador.</p> <p>Así que, para empezar, debes definir cuáles atributos del modelo quieres que se asignen de forma masiva. Puedes hacerlo usando la propiedad <code>$fillable</code> del modelo. Por ejemplo, vamos a hacer el atributo <code>name</code> de nuestro modelo <code>Flight</code> sea asignado masivamente.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Flight</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * The attributes that are mass assignable.
    *
    * @var array
    */</span>
    <span class="token keyword">protected</span> <span class="token variable">$fillable</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token single-quoted-string string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p>Una vez que hemos indicado los atributos asignables en masa, podemos usar el método <code>create</code> para insertar un nuevo registro en la base de datos. El método <code>create</code> devuelve la instancia de modelo guardada:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$flight</span> <span class="token operator">=</span> App\<span class="token package">Flight</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'name'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'Flight 10'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Si ya tienes una instancia del modelo, puedes usar el método <code>fill</code> para llenarla con un arreglo de atributos:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$flight</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'name'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'Flight 22'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="proteccion-de-atributos"><a href="#proteccion-de-atributos" aria-hidden="true" class="header-anchor">#</a> Protección De Atributos</h4> <p>Mientras <code>$fillable</code> sirve como una &quot;lista blanca&quot; de atributos que deben ser asignados en forma masiva, también puedes elegir usar <code>$guarded</code>.  La propiedad <code>$guarded</code> debe contener un arreglo de atributos que no deseas que sean asignados en forma masiva. El resto de atributos que no estén en el arreglo serán asignados masivamente. <code>$guarded</code> funciona como una &quot;lista negra&quot;. Importante, debes usar <code>$fillable</code> o <code>$guarded</code> - pero no ambos. En el ejemplo siguiente, todos los atributos <strong>excepto <code>price</code></strong> serán asignados en forma masiva:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Flight</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * The attributes that aren't mass assignable.
    *
    * @var array
    */</span>
    <span class="token keyword">protected</span> <span class="token variable">$guarded</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token single-quoted-string string">'price'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p>Si prefieres hacer todos los atributos asignados masivamente, puedes definir la propiedad <code>$guarded</code> como un arreglo vacío:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">/**
* The attributes that aren't mass assignable.
*
* @var array
*/</span>
<span class="token keyword">protected</span> <span class="token variable">$guarded</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><p><a name="other-creation-methods"></a></p> <h3 id="otros-metodos-de-creacion"><a href="#otros-metodos-de-creacion" aria-hidden="true" class="header-anchor">#</a> Otros Métodos De Creación</h3> <h4 id="firstorcreate-firstornew"><a href="#firstorcreate-firstornew" aria-hidden="true" class="header-anchor">#</a> <code>firstOrCreate</code>/ <code>firstOrNew</code></h4> <p>Hay otros dos métodos que puedes usar para crear modelos con atributos de asignación masiva: <code>firstOrCreate</code> y <code>firstOrNew</code>. El método <code>firstOrCreate</code> intentará localizar un registro de base de datos usando los pares columna / valor dados. Si el modelo no puede ser encontrado en la base de datos, un registro será insertado con los atributos del primer parámetro, junto con aquellos del segundo parámetro opcional.</p> <p>El método <code>firstOrNew</code>, al igual que <code>firstOrCreate</code>, intentará localizar un registro en la base de datos que coincida con los atributos dados. Sin embargo, si un modelo no es encontrado, una nueva instancia de modelo será devuelta. Nota que el modelo devuelto por <code>firstOrNew</code> todavía no ha sido enviado a la base de datos. Necesitarás ejecutar <code>save</code> manualmente para hacerlo persistente:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">// Recupera el vuelo por nombre, o lo crea si no existe...</span>
<span class="token variable">$flight</span> <span class="token operator">=</span> App\<span class="token package">Flight</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">firstOrCreate</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'name'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'Flight 10'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Recupera vuelo por nombre o lo crea con los atributos name, delayed y arrival_time...</span>
<span class="token variable">$flight</span> <span class="token operator">=</span> App\<span class="token package">Flight</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">firstOrCreate</span><span class="token punctuation">(</span>
    <span class="token punctuation">[</span><span class="token single-quoted-string string">'name'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'Flight 10'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token single-quoted-string string">'delayed'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'arrival_time'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'11:30'</span><span class="token punctuation">]</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Recupera por nombre, o instancia...</span>
<span class="token variable">$flight</span> <span class="token operator">=</span> App\<span class="token package">Flight</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">firstOrNew</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'name'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'Flight 10'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Recupera por nombre o crea una instancia con los atributos name, delayed y arrival_time...</span>
<span class="token variable">$flight</span> <span class="token operator">=</span> App\<span class="token package">Flight</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">firstOrNew</span><span class="token punctuation">(</span>
    <span class="token punctuation">[</span><span class="token single-quoted-string string">'name'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'Flight 10'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token single-quoted-string string">'delayed'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'arrival_time'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'11:30'</span><span class="token punctuation">]</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="updateorcreate"><a href="#updateorcreate" aria-hidden="true" class="header-anchor">#</a> <code>updateOrCreate</code></h4> <p>También puedes encontrar situaciones donde quieras actualizar un modelo existente o crear un nuevo modelo si no existe. Laravel proporciona un  método <code>updateOrCreate</code> para hacer esto en un paso. Al igual que el método <code>firstOrCreate</code>, <code>updateOrCreate</code> persiste el modelo, para que no haya necesidad de ejecutar <code>save()</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">// Si hay un vuelo desde Oakland a San Diego, establece el precio a $99.</span>
<span class="token comment">// Si no existe un modelo que coincida, crea uno.</span>
<span class="token variable">$flight</span> <span class="token operator">=</span> App\<span class="token package">Flight</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">updateOrCreate</span><span class="token punctuation">(</span>
    <span class="token punctuation">[</span><span class="token single-quoted-string string">'departure'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'Oakland'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'destination'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'San Diego'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token single-quoted-string string">'price'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">99</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'discounted'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">]</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><a name="deleting-models"></a></p> <h2 id="eliminando-modelos"><a href="#eliminando-modelos" aria-hidden="true" class="header-anchor">#</a> Eliminando Modelos</h2> <p>Para eliminar un modelo, ejecuta el método <code>delete</code> en una instancia del modelo:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$flight</span> <span class="token operator">=</span> App\<span class="token package">Flight</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$flight</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="eliminando-un-modelo-existente-por-clave"><a href="#eliminando-un-modelo-existente-por-clave" aria-hidden="true" class="header-anchor">#</a> Eliminando Un Modelo Existente Por Clave</h4> <p>En el ejemplo anterior, estamos obteniendo el modelo de la base de datos antes de ejecutar el método <code>delete</code>. Sin embargo, si conoces la clave primaria del modelo, puedes eliminar el modelo sin obtenerlo primero. Para hacer eso, ejecuta el método <code>destroy</code>.  Además de recibir una sola clave primaria como argumento, el método <code>destroy</code> aceptará múltiples claves primarias, o una <a href="/docs/%7B%7Bversion%7D%7D/collections">collection</a> de claves primarias:</p> <div class="language-php extra-class"><pre class="language-php"><code>App\<span class="token package">Flight</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

App\<span class="token package">Flight</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

App\<span class="token package">Flight</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

App\<span class="token package">Flight</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="eliminando-modelos-por-consultas"><a href="#eliminando-modelos-por-consultas" aria-hidden="true" class="header-anchor">#</a> Eliminando Modelos Por Consultas</h4> <p>También puedes ejecutar una instrucción de eliminar en un conjunto de modelos. En este ejemplo, eliminaremos todos los vuelos que están marcados como inactivos. Al igual que las actualizaciones masivas, las eliminaciones masivas no dispararán cualquiera de los eventos de modelo para los modelos que son eliminados:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$deletedRows</span> <span class="token operator">=</span> App\<span class="token package">Flight</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'active'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="danger custom-block"><p class="custom-block-title">Nota</p> <p>Al momento de ejecutar una instrucción de eliminación masiva por medio de Eloquent, los eventos de modelo <code>deleting</code> and <code>deleted</code> no serán ejecutados para los modelos eliminados. Esto es debido a que los modelos nunca son obtenidos realmente al momento de ejecutar la instrucción de eliminación.</p></div> <p><a name="soft-deleting"></a></p> <h3 id="eliminacion-logica-soft-deleting"><a href="#eliminacion-logica-soft-deleting" aria-hidden="true" class="header-anchor">#</a> Eliminación Lógica (Soft Deleting)</h3> <p>Además de eliminar realmente los registros de tu base de datos, Eloquent también puede &quot;eliminar lógicamente&quot; los modelos. Cuando los modelos son borrados lógicamente, no son removidos realmente de tu base de datos. En lugar de eso, un atributo <code>deleted_at</code> es establecido en el modelo e insertado en la base de datos. Si un modelo tiene un valor <code>deleted_at</code> no nulo, el modelo ha sido eliminado lógicamente. Para habilitar eliminaciones lógicas en un modelo, usa el trait <code>Illuminate\Database\Eloquent\SoftDeletes</code> en el modelo:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>SoftDeletes</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Flight</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token package">SoftDeletes</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>El trait <code>SoftDeletes</code> convertirá (cast) automáticamente el atributo <code>deleted_at</code> a una instancia de <code>DateTime</code> / <code>Carbon</code> para ti.</p></div> <p>Debes añadir la columna <code>deleted_at</code> a tu tabla de base de datos. El <a href="/docs/%7B%7Bversion%7D%7D/migrations">constructor de esquemas</a> de Laravel contiene un método helper para crear esta columna:</p> <div class="language-php extra-class"><pre class="language-php"><code>Schema<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'flights'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>Blueprint <span class="token variable">$table</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$table</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">softDeletes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Ahora, cuando ejecutes el método <code>delete</code> en el modelo, la columna <code>deleted_at</code> será establecida con la fecha y hora actual. Y, al momento de consultar un modelo que use eliminaciones lógicas, los modelos eliminados lógicamente serán excluidos automáticamente de todos los resultados de consultas.</p> <p>Para determinar si una instancia de modelo ha sido eliminada lógicamente, usa el método <code>trashed</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$flight</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">trashed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//</span>
<span class="token punctuation">}</span>
</code></pre></div><p><a name="querying-soft-deleted-models"></a></p> <h3 id="consultando-modelos-eliminados-logicamente"><a href="#consultando-modelos-eliminados-logicamente" aria-hidden="true" class="header-anchor">#</a> Consultando Modelos Eliminados Lógicamente</h3> <h4 id="incluyendo-modelos-eliminados-logicamente"><a href="#incluyendo-modelos-eliminados-logicamente" aria-hidden="true" class="header-anchor">#</a> Incluyendo Modelos Eliminados Lógicamente</h4> <p>Como se apreció anteriormente, los modelos eliminados lógicamente serán excluidos automáticamente de los resultados de las consultas. Sin embargo, puedes forzar que los modelos eliminados lógicamente aparezcan en un conjunto resultante usando el método <code>withTrashed</code> en la consulta:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$flights</span> <span class="token operator">=</span> App\<span class="token package">Flight</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">withTrashed</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'account_id'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
                <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>El método <code>withTrashed</code> también puede ser usado en una consulta de <a href="/docs/%7B%7Bversion%7D%7D/eloquent-relationships">relación de Eloquent</a>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$flight</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">history</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">withTrashed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="obteniedo-modelos-individuales-eliminados-logicamente"><a href="#obteniedo-modelos-individuales-eliminados-logicamente" aria-hidden="true" class="header-anchor">#</a> Obteniedo Modelos Individuales Eliminados Lógicamente</h4> <p>El método <code>onlyTrashed</code> obtendrá <strong>solamente</strong> modelos eliminados lógicamente:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$flights</span> <span class="token operator">=</span> App\<span class="token package">Flight</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">onlyTrashed</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'airline_id'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
                <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="restaurando-modelos-eliminados-logicamente"><a href="#restaurando-modelos-eliminados-logicamente" aria-hidden="true" class="header-anchor">#</a> Restaurando Modelos Eliminados Lógicamente</h4> <p>Algunas veces puedes desear &quot;deshacer la eliminación&quot; de un modelo eliminado lógicamente. Para restaurar un modelo eliminado lógicamente a un estado activo, usa el método <code>restore</code> en una instancia de modelo:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$flight</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">restore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>También puedes usar el método <code>restore</code> en una consulta para restaurar rápidamente varios modelos. Otra vez, al igual que otras operaciones &quot;masivas&quot;, esto no disparará cualquiera de los eventos de modelo para los modelos que sean restaurados:</p> <div class="language-php extra-class"><pre class="language-php"><code>App\<span class="token package">Flight</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">withTrashed</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'airline_id'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">restore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Al igual que con el método <code>withTrashed</code>, el método <code>restore</code> también puede ser usado en <a href="/docs/%7B%7Bversion%7D%7D/eloquent-relationships">relaciones de Eloquent</a>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$flight</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">history</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">restore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="eliminando-modelos-permanentemente"><a href="#eliminando-modelos-permanentemente" aria-hidden="true" class="header-anchor">#</a> Eliminando Modelos Permanentemente</h4> <p>Algunas veces puedes necesitar eliminar verdaderamente un modelo de tu base de datos. Para remover permanentemente un modelo eliminado lógicamente de la base de datos, usa el método <code>forceDelete</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">// Obliga la eliminación de una instancia de un solo modelo...</span>
<span class="token variable">$flight</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">forceDelete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Obliga la eliminación de todos los modelos relacionados...</span>
<span class="token variable">$flight</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">history</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">forceDelete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><a name="query-scopes"></a></p> <h2 id="alcances-scopes-de-consultas"><a href="#alcances-scopes-de-consultas" aria-hidden="true" class="header-anchor">#</a> Alcances (Scopes) de Consultas</h2> <p><a name="global-scopes"></a></p> <h3 id="alcances-scopes-globales"><a href="#alcances-scopes-globales" aria-hidden="true" class="header-anchor">#</a> Alcances (scopes) Globales</h3> <p>Los alcances globales permiten que añadas restricciones a todas las consultas para un modelo dado. La propia funcionalidad de la <a href="#soft-deleting">eliminación lógica</a> de Laravel utiliza alcances globales para extraer solamente los modelos &quot;no-eliminados&quot; de la base de datos. Escribiendo tus propios alcances globales puede proporcionarte una forma conveniente y fácil de asegurar que cada consulta para un modelo dado reciba ciertas restricciones.</p> <h4 id="escribiendo-scopes-globales"><a href="#escribiendo-scopes-globales" aria-hidden="true" class="header-anchor">#</a> Escribiendo Scopes Globales</h4> <p>Escribir un alcance global es simple. Define una clase que implemente la interfaz <code>Illuminate\Database\Eloquent\Scope</code>. Esta interfaz requiere que implementes un método: <code>apply</code>. El método <code>apply</code> puede añadir restricciones <code>where</code> a la consulta como sea necesario:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Scopes</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Scope</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Builder</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">AgeScope</span> <span class="token keyword">implements</span> <span class="token class-name">Scope</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * Apply the scope to a given Eloquent query builder.
    *
    * @param  \Illuminate\Database\Eloquent\Builder  $builder
    * @param  \Illuminate\Database\Eloquent\Model  $model
    * @return void
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">apply</span><span class="token punctuation">(</span>Builder <span class="token variable">$builder</span><span class="token punctuation">,</span> Model <span class="token variable">$model</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$builder</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'age'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'&gt;'</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>Si tu scope global está agregando columnas a la cláusula select de la consulta, deberías usar el método <code>addSelect</code> en lugar de <code>select</code>. Esto evitará el reemplazo no intencional de la cláusula select existente de la consulta.</p></div> <h4 id="aplicando-scopes-globales"><a href="#aplicando-scopes-globales" aria-hidden="true" class="header-anchor">#</a> Aplicando Scopes Globales</h4> <p>Para asignar un scope global a un modelo, debes sobrescribir el método <code>boot</code> del modelo dado y usar el método <code>addGlobalScope</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Scopes<span class="token punctuation">\</span>AgeScope</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * The &quot;booting&quot; method of the model.
    *
    * @return void
    */</span>
    <span class="token keyword">protected</span> <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function">boot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">parent</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">boot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">static</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">addGlobalScope</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">AgeScope</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p>Después de agregar el scope, una consulta a <code>User::all()</code> producirá el siguiente código SQL:</p> <div class="language-php extra-class"><pre class="language-php"><code>select <span class="token operator">*</span> from `users` where `age` <span class="token operator">&gt;</span> <span class="token number">200</span>
</code></pre></div><h4 id="alcances-globales-anonimos"><a href="#alcances-globales-anonimos" aria-hidden="true" class="header-anchor">#</a> Alcances Globales Anónimos</h4> <p>Eloquent también permite que definas scopes globales usando Closures, lo cual es particularmente útil para scopes simples que no se crean en una clase separada:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Builder</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * The &quot;booting&quot; method of the model.
    *
    * @return void
    */</span>
    <span class="token keyword">protected</span> <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function">boot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">parent</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">boot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">static</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">addGlobalScope</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'age'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>Builder <span class="token variable">$builder</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$builder</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'age'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'&gt;'</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><h4 id="eliminar-scopes-globales"><a href="#eliminar-scopes-globales" aria-hidden="true" class="header-anchor">#</a> Eliminar Scopes Globales</h4> <p>Si prefieres remover un scope global para una consulta dada, puedes usar el método <code>withoutGlobalScope</code>. El método acepta el nombre de clase del scope global como su único argumento:</p> <div class="language-php extra-class"><pre class="language-php"><code>User<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">withoutGlobalScope</span><span class="token punctuation">(</span>AgeScope<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>O, si definiste el scope global usando un Closure:</p> <div class="language-php extra-class"><pre class="language-php"><code>User<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">withoutGlobalScope</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'age'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Si prefieres eliminar varios o incluso todos los scopes globales, puedes usar el método <code>withoutGlobalScopes</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">// Elimina todos los scopes globales...</span>
User<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">withoutGlobalScopes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Elimina algunos de los scopes globales...</span>
User<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">withoutGlobalScopes</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    FirstScope<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> SecondScope<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><a name="local-scopes"></a></p> <h3 id="alcances-scopes-locales"><a href="#alcances-scopes-locales" aria-hidden="true" class="header-anchor">#</a> Alcances (Scopes) Locales</h3> <p>Los scopes locales permiten que definas conjuntos de restricciones comunes que puedes reusar fácilmente a traves de tu aplicación. Por ejemplo, puedes necesitar obtener frecuentemente todos los usuarios que son considerados &quot;populares&quot;. Para definir un scope, agrega el prefijo <code>scope</code> a un método de modelo de Eloquent.</p> <p>Los scopes deberían devolver siempre una instancia del constructor de consultas:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * Scope a query to only include popular users.
    *
    * @param  \Illuminate\Database\Eloquent\Builder  $query
    * @return \Illuminate\Database\Eloquent\Builder
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">scopePopular</span><span class="token punctuation">(</span><span class="token variable">$query</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$query</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'votes'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'&gt;'</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
    * Scope a query to only include active users.
    *
    * @param  \Illuminate\Database\Eloquent\Builder  $query
    * @return \Illuminate\Database\Eloquent\Builder
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">scopeActive</span><span class="token punctuation">(</span><span class="token variable">$query</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$query</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'active'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><h4 id="utilizando-un-scope-local"><a href="#utilizando-un-scope-local" aria-hidden="true" class="header-anchor">#</a> Utilizando Un Scope Local</h4> <p>Una vez que el scope ha sido definido, puedes ejecutar los métodos de scope al momento de consultar el modelo. Sin embargo, no debes incluir el prefijo <code>scope</code> cuando ejecutas el método. Incluso puedes encadenar las ejecuciones a varios scopes, por ejemplo:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$users</span> <span class="token operator">=</span> App\<span class="token package">User</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">popular</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">active</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">orderBy</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'created_at'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>La combinación de múltiples scopes de modelo Eloquent a través de un operador de consulta <code>or</code> puede requerir el uso de funciones de retorno Closure como:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$users</span> <span class="token operator">=</span> App\<span class="token package">User</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">popular</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">orWhere</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>Builder <span class="token variable">$query</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$query</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">active</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Sin embargo, dado que esto puede ser engorroso, Laravel proporciona un método de &quot;orden superior&quot; <code>orWhere</code> que te permite encadenar estos scopes con fluidez sin el uso de Closure:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$users</span> <span class="token operator">=</span> App\<span class="token package">User</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">popular</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">orWhere</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">active</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="scopes-dinamicos"><a href="#scopes-dinamicos" aria-hidden="true" class="header-anchor">#</a> Scopes Dinámicos</h4> <p>Algunas veces, puedes desear definir un scope que acepte parámetros. Para empezar, sólo agrega tus parámetros adicionales a tu scope. Los parámetros de scope deben ser definidos después del parámetro <code>$query</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * Scope a query to only include users of a given type.
    *
    * @param  \Illuminate\Database\Eloquent\Builder  $query
    * @param  mixed  $type
    * @return \Illuminate\Database\Eloquent\Builder
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">scopeOfType</span><span class="token punctuation">(</span><span class="token variable">$query</span><span class="token punctuation">,</span> <span class="token variable">$type</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$query</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'type'</span><span class="token punctuation">,</span> <span class="token variable">$type</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p>Ahora, puedes pasar los parámetros cuando llamas al scope:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$users</span> <span class="token operator">=</span> App\<span class="token package">User</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">ofType</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'admin'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><a name="comparing-models"></a></p> <h2 id="comparando-modelos"><a href="#comparando-modelos" aria-hidden="true" class="header-anchor">#</a> Comparando Modelos</h2> <p>En ocasiones necesitarás determinar si dos modelos son &quot;el mismo&quot;. El método <code>is</code> puede ser usado para verificar rápidamente dos modelos que comparten llave principal, tabla y conexión a base de datos:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$post</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">is</span><span class="token punctuation">(</span><span class="token variable">$anotherPost</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//</span>
<span class="token punctuation">}</span>
</code></pre></div><p><a name="events"></a></p> <h2 id="eventos"><a href="#eventos" aria-hidden="true" class="header-anchor">#</a> Eventos</h2> <p>Los modelos de Eloquent ejecutan varios eventos, permitiendo que captes los siguientes puntos en un ciclo de vida del modelo: <code>retrieved</code>, <code>creating</code>, <code>created</code>, <code>updating</code>, <code>updated</code>, <code>saving</code>, <code>saved</code>, <code>deleting</code>, <code>deleted</code>, <code>restoring</code> y <code>restored</code>. Los eventos permiten que ejecutes fácilmente código cada vez que una clase de modelo específica es guardada o actualizada en la base de datos.</p> <p>El evento <code>retrieved</code> se disparará cuando un modelo existente es obtenido de la base de datos. Cuando un nuevo modelo es guardado la primera vez, los eventos <code>creating</code> y <code>created</code> se disparan. Si un modelo ya existe en la base de datos y el método <code>save</code> es ejecutado, los eventos <code>updating</code> / <code>updated</code> se dispararán. Sin embargo, en ambos casos, los eventos <code>saving</code> / <code>saved</code> se dispararán.</p> <div class="danger custom-block"><p class="custom-block-title">Nota</p> <p>Al realizar una actualización masiva a través de Eloquent, los eventos de modelo <code>saved</code> y <code>updated</code> no se activarán para los modelos actualizados. Esto se debe a que los modelos nunca se recuperan cuando se emite una actualización masiva.</p></div> <p>Para empezar, define una propiedad <code>$dispatchesEvents</code> en tu modelo Eloquent que mapee varios puntos del ciclo de vida de modelo de Eloquent a tus propias <a href="/docs/%7B%7Bversion%7D%7D/events">clases de eventos</a>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Events<span class="token punctuation">\</span>UserSaved</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Events<span class="token punctuation">\</span>UserDeleted</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Notifications<span class="token punctuation">\</span>Notifiable</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Foundation<span class="token punctuation">\</span>Auth<span class="token punctuation">\</span>User</span> <span class="token keyword">as</span> Authenticatable<span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">Authenticatable</span>
<span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token package">Notifiable</span><span class="token punctuation">;</span>

    <span class="token comment">/**
    * The event map for the model.
    *
    * @var array
    */</span>
    <span class="token keyword">protected</span> <span class="token variable">$dispatchesEvents</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token single-quoted-string string">'saved'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> UserSaved<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'deleted'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> UserDeleted<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p>Después de definir y mapear tus eventos Eloquent, puedes usar <a href="https://laravel.com/docs/%7B%7Bversion%7D%7D/events#defining-listeners" target="_blank" rel="noopener noreferrer">listeners de eventos<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> para manejar los eventos.</p> <p><a name="observers"></a></p> <h3 id="observadores"><a href="#observadores" aria-hidden="true" class="header-anchor">#</a> Observadores</h3> <h4 id="definiendo-observadores"><a href="#definiendo-observadores" aria-hidden="true" class="header-anchor">#</a> Definiendo Observadores</h4> <p>Si estás escuchando muchos eventos en un modelo dado, puedes usar observadores para agrupar todos tus listeners dentro de una sola clase. Las clases observadoras tienen nombres de métodos que reflejan los eventos de Eloquent que deseas escuchar. Cada uno de estos métodos reciben el modelo como su único argumento. El comando <code>make:observer</code> Artisan es la forma más sencilla de crear una nueva clase de observador:</p> <div class="language-php extra-class"><pre class="language-php"><code>php artisan make<span class="token punctuation">:</span>observer UserObserver <span class="token operator">--</span>model<span class="token operator">=</span>User
</code></pre></div><p>Este comando colocará el nuevo observador en tu directorio <code>App/Observers</code>. Si este directorio no existe, Artisan lo creará por ti. Tu nuevo observador lucirá como lo siguiente:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Observers</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>User</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">UserObserver</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * Handle the User &quot;created&quot; event.
    *
    * @param  \App\User  $user
    * @return void
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">created</span><span class="token punctuation">(</span>User <span class="token variable">$user</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
    * Handle the User &quot;updated&quot; event.
    *
    * @param  \App\User  $user
    * @return void
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">updated</span><span class="token punctuation">(</span>User <span class="token variable">$user</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
    * Handle the User &quot;deleted&quot; event.
    *
    * @param  \App\User  $user
    * @return void
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">deleted</span><span class="token punctuation">(</span>User <span class="token variable">$user</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p>Para registrar un observador, usa el método <code>observe</code> en el modelo que deseas observar. Puedes registrar los observadores en el método <code>boot</code> de uno de tus proveedores de servicio. En este ejemplo, registraremos el observador en el <code>AppServiceProvider</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Providers</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>User</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Observers<span class="token punctuation">\</span>UserObserver</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Support<span class="token punctuation">\</span>ServiceProvider</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">AppServiceProvider</span> <span class="token keyword">extends</span> <span class="token class-name">ServiceProvider</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * Register any application services.
    *
    * @return void
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
    * Bootstrap any application services.
    *
    * @return void
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">boot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        User<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">observe</span><span class="token punctuation">(</span>UserObserver<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/redis.html" class="prev">
          Redis
        </a></span> <span class="next"><a href="/eloquent-relationships.html">
          Eloquent: Relaciones
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/app.bf22240a.js" defer></script><script src="/assets/js/32.6657300b.js" defer></script>
  </body>
</html>
