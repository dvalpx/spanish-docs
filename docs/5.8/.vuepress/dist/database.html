<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Bases de Datos: Primeros Pasos | Documentación de Laravel en Español</title>
    <meta name="description" content="Documentación de Laravel en Español">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Catamaran:300,700|Miriam+Libre">
    
    <link rel="preload" href="/assets/css/0.styles.0cc2d3c3.css" as="style"><link rel="preload" href="/assets/js/app.bf22240a.js" as="script"><link rel="preload" href="/assets/js/24.534e59f1.js" as="script"><link rel="prefetch" href="/assets/js/10.8a8a99df.js"><link rel="prefetch" href="/assets/js/11.ec476e2f.js"><link rel="prefetch" href="/assets/js/12.6db1eb13.js"><link rel="prefetch" href="/assets/js/13.92d78bb5.js"><link rel="prefetch" href="/assets/js/14.1a0ad5f1.js"><link rel="prefetch" href="/assets/js/15.abc982c9.js"><link rel="prefetch" href="/assets/js/16.7cf1a759.js"><link rel="prefetch" href="/assets/js/17.4abfc664.js"><link rel="prefetch" href="/assets/js/18.85b19837.js"><link rel="prefetch" href="/assets/js/19.8c9dfcd5.js"><link rel="prefetch" href="/assets/js/2.dcb6cf45.js"><link rel="prefetch" href="/assets/js/20.c1b9de54.js"><link rel="prefetch" href="/assets/js/21.469ffab3.js"><link rel="prefetch" href="/assets/js/22.2d14e150.js"><link rel="prefetch" href="/assets/js/23.7a4dcc9a.js"><link rel="prefetch" href="/assets/js/25.eaac1c07.js"><link rel="prefetch" href="/assets/js/26.8e9180e0.js"><link rel="prefetch" href="/assets/js/27.2cd2ace8.js"><link rel="prefetch" href="/assets/js/28.9f7dcf6d.js"><link rel="prefetch" href="/assets/js/29.06a87f0d.js"><link rel="prefetch" href="/assets/js/3.b62bf0b4.js"><link rel="prefetch" href="/assets/js/30.b03f86ec.js"><link rel="prefetch" href="/assets/js/31.edce81f6.js"><link rel="prefetch" href="/assets/js/32.6657300b.js"><link rel="prefetch" href="/assets/js/33.8dc49209.js"><link rel="prefetch" href="/assets/js/34.03cbee56.js"><link rel="prefetch" href="/assets/js/35.5439db2e.js"><link rel="prefetch" href="/assets/js/36.83d5a264.js"><link rel="prefetch" href="/assets/js/37.4066824e.js"><link rel="prefetch" href="/assets/js/38.c3fe05aa.js"><link rel="prefetch" href="/assets/js/39.52ef8667.js"><link rel="prefetch" href="/assets/js/4.bd0ebba2.js"><link rel="prefetch" href="/assets/js/40.2c54d702.js"><link rel="prefetch" href="/assets/js/41.775bc6e1.js"><link rel="prefetch" href="/assets/js/42.6541d60b.js"><link rel="prefetch" href="/assets/js/43.20091aea.js"><link rel="prefetch" href="/assets/js/44.75b71ccc.js"><link rel="prefetch" href="/assets/js/45.6b36a3a8.js"><link rel="prefetch" href="/assets/js/46.6ea236af.js"><link rel="prefetch" href="/assets/js/47.0e0ee374.js"><link rel="prefetch" href="/assets/js/48.b6beb9b8.js"><link rel="prefetch" href="/assets/js/49.ae33b521.js"><link rel="prefetch" href="/assets/js/5.2c350d8b.js"><link rel="prefetch" href="/assets/js/50.5cb081e0.js"><link rel="prefetch" href="/assets/js/51.3e0281e2.js"><link rel="prefetch" href="/assets/js/52.e1fae1d6.js"><link rel="prefetch" href="/assets/js/53.0a9d4aed.js"><link rel="prefetch" href="/assets/js/54.55bc9113.js"><link rel="prefetch" href="/assets/js/55.e964fdb4.js"><link rel="prefetch" href="/assets/js/56.3abed8a0.js"><link rel="prefetch" href="/assets/js/57.df09269b.js"><link rel="prefetch" href="/assets/js/58.3ce37458.js"><link rel="prefetch" href="/assets/js/59.7a840aeb.js"><link rel="prefetch" href="/assets/js/6.6fce793d.js"><link rel="prefetch" href="/assets/js/60.b4fe788b.js"><link rel="prefetch" href="/assets/js/61.e45356bb.js"><link rel="prefetch" href="/assets/js/62.0d75cf78.js"><link rel="prefetch" href="/assets/js/63.0ecae205.js"><link rel="prefetch" href="/assets/js/64.90fb2c2d.js"><link rel="prefetch" href="/assets/js/65.7c476002.js"><link rel="prefetch" href="/assets/js/66.802dee8b.js"><link rel="prefetch" href="/assets/js/67.ae965c66.js"><link rel="prefetch" href="/assets/js/68.220c04d8.js"><link rel="prefetch" href="/assets/js/69.bf607b92.js"><link rel="prefetch" href="/assets/js/7.b956f78c.js"><link rel="prefetch" href="/assets/js/70.dea3d878.js"><link rel="prefetch" href="/assets/js/71.1f786e34.js"><link rel="prefetch" href="/assets/js/72.4bd65b39.js"><link rel="prefetch" href="/assets/js/73.414b29bd.js"><link rel="prefetch" href="/assets/js/74.b5ab4f13.js"><link rel="prefetch" href="/assets/js/75.f12fbb27.js"><link rel="prefetch" href="/assets/js/76.a140d22b.js"><link rel="prefetch" href="/assets/js/77.2595933c.js"><link rel="prefetch" href="/assets/js/78.46bb4eff.js"><link rel="prefetch" href="/assets/js/79.c549a0e3.js"><link rel="prefetch" href="/assets/js/8.3be12d8d.js"><link rel="prefetch" href="/assets/js/80.1b9cd731.js"><link rel="prefetch" href="/assets/js/81.6aa05825.js"><link rel="prefetch" href="/assets/js/9.60a01cba.js">
    <link rel="stylesheet" href="/assets/css/0.styles.0cc2d3c3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Documentación de Laravel en Español</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Inicio</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Inicio</a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading"><span>Primeros Pasos</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Conceptos De Arquitectura</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Fundamentos</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Frontend</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Seguridad</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Profundizando</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>Bases De Datos</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/database.html" class="active sidebar-link">Bases de Datos: Primeros Pasos</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/database.html#introduccion" class="sidebar-link">Introducción</a></li><li class="sidebar-sub-header"><a href="/database.html#ejecutando-consultas-sql-nativas" class="sidebar-link">Ejecutando Consultas SQL Nativas</a></li><li class="sidebar-sub-header"><a href="/database.html#transacciones-de-bases-de-datos" class="sidebar-link">Transacciones de Bases de Datos</a></li></ul></li><li><a href="/queries.html" class="sidebar-link">Base de datos: Constructor de Consultas (Query Builder)</a></li><li><a href="/pagination.html" class="sidebar-link">Base de datos: Paginación</a></li><li><a href="/migrations.html" class="sidebar-link">Base de datos: Migraciones</a></li><li><a href="/seeding.html" class="sidebar-link">Base de datos: Seeding</a></li><li><a href="/redis.html" class="sidebar-link">Redis</a></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>ORM Eloquent</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Pruebas</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Paquetes oficiales</span> <span class="arrow right"></span></p> <!----></div></li></ul> </div> <div class="page"> <div class="content"><div><h1 id="bases-de-datos-primeros-pasos"><a class="header-anchor" href="#bases-de-datos-primeros-pasos" aria-hidden="true">#</a> Bases de Datos: Primeros Pasos</h1> <ul><li><a href="#introduction">Introducción</a> <ul><li><a href="#configuration">Configuración</a></li> <li><a href="#read-and-write-connections">Conexiones de Lectura &amp; Escritura</a></li> <li><a href="#using-multiple-database-connections">Usando Múltiples Conexiones de Bases de Datos</a></li></ul></li> <li><a href="#running-queries">Ejecutando Consultas SQL Nativas</a> <ul><li><a href="#listening-for-query-events">Listeners de Eventos de Consultas</a></li></ul></li> <li><a href="#database-transactions">Transacciones de Bases de Datos</a></li></ul> <p><a name="introduction"></a></p> <h2 id="introduccion"><a class="header-anchor" href="#introduccion" aria-hidden="true">#</a> Introducción</h2> <p>Laravel hace que la interacción con las bases de datos sea extremadamente fácil a través de una variedad de backends de bases de datos usando SQL nativo, el constructor de consultas <a href="/docs/%7B%7Bversion%7D%7D/queries">query builder</a> y el <a href="/docs/%7B%7Bversion%7D%7D/eloquent">ORM Eloquent</a>. Actualmente, Laravel soporta cuatro bases de datos.</p> <ul><li>MySQL</li> <li>PostgreSQL</li> <li>SQLite</li> <li>SQL Server</li></ul> <p><a name="configuration"></a></p> <h3 id="configuracion"><a class="header-anchor" href="#configuracion" aria-hidden="true">#</a> Configuración</h3> <p>La configuración de base de datos para tu aplicación está localizada en <code>config/database.php</code>. Puedes definir todo lo concerniente a tus conexiones de bases de datos, y también especificar qué conexión debería ser usada por defecto. Ejemplos para la mayoría de los sistemas de bases de datos soportados son proporcionados en este archivo.</p> <p>Por defecto, la <a href="/docs/%7B%7Bversion%7D%7D/configuration#environment-configuration">configuración de entorno</a> de muestra de Laravel está lista para usar con <a href="/docs/%7B%7Bversion%7D%7D/homestead">Laravel Homestead</a>, la cual es una máquina virtual conveniente para el desarrollo con Laravel en tu máquina local. Eres libre de modificar esta configuración de acuerdo a tus necesidades de tu base de datos local.</p> <h4 id="configuracion-sqlite"><a class="header-anchor" href="#configuracion-sqlite" aria-hidden="true">#</a> Configuración SQLite</h4> <p>Después de la creación de una nueva base de datos SQLite usando un comando tal como <code>touch database/database.sqlite</code>, puedes configurar fácilmente tus variables de entorno para apuntar a esta base de datos creada recientemente al usar la ruta absoluta a la base de datos.</p> <div class="language-php extra-class"><pre v-pre class="language-php"><code><span class="token constant">DB_CONNECTION</span><span class="token operator">=</span>sqlite
<span class="token constant">DB_DATABASE</span><span class="token operator">=</span><span class="token operator">/</span>absolute<span class="token operator">/</span>path<span class="token operator">/</span>to<span class="token operator">/</span>database<span class="token punctuation">.</span>sqlite
</code></pre></div><p>Para habilitar las claves foráneas en conexiones de SQLite, debes agregar la opción <code>foreign_key_constraints</code> en tu archivo de configuración <code>config/database.php</code>:</p> <div class="language-php extra-class"><pre v-pre class="language-php"><code><span class="token single-quoted-string string">'sqlite'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
    <span class="token comment">// ...</span>
    <span class="token single-quoted-string string">'foreign_key_constraints'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre></div><h4 id="configuracion-usando-urls"><a class="header-anchor" href="#configuracion-usando-urls" aria-hidden="true">#</a> Configuración Usando URLs</h4> <p>Típicamente, las conexiones a bases de datos son configuradas usando múltiples valores de configuración como <code>host</code>, <code>database</code>, <code>username</code>, <code>password</code>, etc. Cada uno de esos valores de configuración tiene su propia variable de entorno correspondiente. Esto quiere decir que al configurar tu información de conexión a la base de datos en un servidor de producción, necesitas administrar múltiples variables de entorno.</p> <p>Algunos proveedores de bases de datos administrados como Heroku proporcionan una única &quot;URL&quot; de base de datos que contiene toda la información de conexión para la base de datos en una única cadena. Una URL de base de datos de ejemplo podría verse de la siguiente manera:</p> <div class="language-php extra-class"><pre v-pre class="language-php"><code>mysql<span class="token punctuation">:</span><span class="token comment">//root:password@127.0.0.1/forge?charset=UTF-8</span>
</code></pre></div><p>Estas URLs típicamente siguen una convención de esquema estándar:</p> <div class="language-php extra-class"><pre v-pre class="language-php"><code>driver<span class="token punctuation">:</span><span class="token comment">//username:password@host:port/database?options</span>
</code></pre></div><p>Por conveniencia, Laravel soporta dichas URLs como alternativa a configurar tu base de datos con múltiples opciones de configuración. Si la opción de configuración <code>url</code> (o variable de entorno <code>DATABASE_URL</code> correspondiente) está presente, esta será usada para extraer la conexión a la base de datos y la información de credenciales.</p> <p><a name="read-and-write-connections"></a></p> <h3 id="conexiones-de-lectura-escritura"><a class="header-anchor" href="#conexiones-de-lectura-escritura" aria-hidden="true">#</a> Conexiones de Lectura &amp; Escritura</h3> <p>Algunas veces puedes desear contar con una conexión de base de datos para los comandos SELECT y otra para los comandos UPDATE y DELETE. Laravel hace esto una tarea fácil, y las conexiones propias siempre serán usadas si estás usando consultas nativas, el constructor de consultas Query Builder o el ORM Eloquent.</p> <p>Para ver cómo las conexiones de lectura / escritura deberían ser configuradas, vamos a mirar este ejemplo:</p> <div class="language-php extra-class"><pre v-pre class="language-php"><code><span class="token single-quoted-string string">'mysql'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
    <span class="token single-quoted-string string">'read'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
        <span class="token single-quoted-string string">'host'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
            <span class="token single-quoted-string string">'192.168.1.1'</span><span class="token punctuation">,</span>
            <span class="token single-quoted-string string">'196.168.1.2'</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'write'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
        <span class="token single-quoted-string string">'host'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
            <span class="token single-quoted-string string">'196.168.1.3'</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'sticky'</span>    <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'driver'</span>    <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'mysql'</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'database'</span>  <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'database'</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'username'</span>  <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'root'</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'password'</span>  <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">''</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'charset'</span>   <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'utf8mb4'</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'collation'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'utf8mb4_unicode_ci'</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'prefix'</span>    <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">''</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre></div><p>Observa que tres claves han sido agregadas al arreglo de configuración: <code>read</code>, <code>write</code> y <code>sticky</code>. Las claves <code>read</code> y <code>write</code> tienen valores de arreglo conteniendo una sola clave: la dirección ip del <code>host</code>. El resto de las opciones de la base de datos para las conexiones <code>read</code> y <code>write</code> serán tomadas del arreglo principal <code>mysql</code>.</p> <p>Únicamente necesitas colocar elementos en los arreglos <code>read</code> y <code>write</code> si deseas sobreescribir los valores del arreglo principal. Así, en este caso, <code>192.168.1.1</code> será usado como la máquina para la conexión de &quot;lectura&quot;, mientras que <code>192.168.1.3</code> será usada para la conexión de &quot;escritura&quot;.  Las credenciales de bases de datos, prefijo, conjunto de caracteres, y todas las demás opciones en el arreglo principal <code>mysql</code> serán compartidas a través de ambas conexiones.</p> <h4 id="la-opcion-sticky"><a class="header-anchor" href="#la-opcion-sticky" aria-hidden="true">#</a> La Opción <code>sticky</code></h4> <p>La opción <code>sticky</code> es un valor <em>opcional</em> que puede ser usado para permitir la lectura inmediata de registros que han sido escritos a la base de datos durante el ciclo de solicitudes actual. Si la opción <code>sticky</code> está habilitada y una operación de &quot;escritura&quot; ha sido ejecutada contra la base de datos durante el ciclo de solicitudes actual, cualquiera de las operaciones de &quot;lectura&quot; hasta aquí usarán la conexión &quot;write&quot;. Esto asegura que cualquier dato escrito durante el ciclo de solicitud pueda ser leído inmediatamente de la base de datos durante la misma solicitud. Es posible para ti decidir si este es el comportamiento deseado para tu aplicación.</p> <p><a name="using-multiple-database-connections"></a></p> <h3 id="usando-conexiones-de-bases-de-datos-multiples"><a class="header-anchor" href="#usando-conexiones-de-bases-de-datos-multiples" aria-hidden="true">#</a> Usando Conexiones de Bases de Datos Múltiples</h3> <p>Cuando estamos usando conexiones múltiples, puedes acceder a cada conexión por medio del método <code>connection</code> en el Facade <code>DB</code>.  El nombre <code>name</code> pasado al método de conexión <code>connection</code> debería corresponder a una de las conexiones listadas en tu archivo de configuración <code>config/database.php</code>:</p> <div class="language-php extra-class"><pre v-pre class="language-php"><code><span class="token variable">$users</span> <span class="token operator">=</span> <span class="token constant">DB</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">connection</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'foo'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>También puedes acceder a los datos nativos de la instancia PDO subyacente que usa el método <code>getPdo</code> en una instancia de conexión:</p> <div class="language-php extra-class"><pre v-pre class="language-php"><code><span class="token variable">$pdo</span> <span class="token operator">=</span> <span class="token constant">DB</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">connection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getPdo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><a name="running-queries"></a></p> <h2 id="ejecutando-consultas-sql-nativas"><a class="header-anchor" href="#ejecutando-consultas-sql-nativas" aria-hidden="true">#</a> Ejecutando Consultas SQL Nativas</h2> <p>Una vez que has configurado tu conexión de base de datos, puedes ejecutar consultas usando el Facade <code>DB</code>. La clase facade <code>DB</code> proporciona métodos para cada tipo de consulta: <code>select</code>, <code>update</code>, <code>insert</code>, <code>delete</code> y <code>statement</code>.</p> <h4 id="ejecutando-una-consulta-select"><a class="header-anchor" href="#ejecutando-una-consulta-select" aria-hidden="true">#</a> Ejecutando una consulta Select</h4> <p>Para ejecutar una consulta básica, puedes usar el método <code>select</code> en el facade <code>DB</code>:</p> <div class="language-php extra-class"><pre v-pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Controllers</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Support<span class="token punctuation">\</span>Facades<span class="token punctuation">\</span>DB</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Controllers<span class="token punctuation">\</span>Controller</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token keyword">extends</span> <span class="token class-name">Controller</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * Muestra una lista de todos los usuarios de la aplicación.
    *
    * @return Response
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$users</span> <span class="token operator">=</span> <span class="token constant">DB</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'select * from users where active = ?'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token function">view</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'user.index'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token single-quoted-string string">'users'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$users</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p>El primer argumento pasado al método <code>select</code> es la consulta SQL nativa; en este caso está parametrizada, mientras el segundo argumento es cualquier parámetro a enlazar que necesita estar conectado a la consulta. Típicamente, estos son los valores de las restricciones de cláusula <code>where</code>. El enlazamiento de parámetro proporciona protección contra ataques de inyección SQL.</p> <p>El método <code>select</code> siempre devolverá un arreglo de resultados. Cada resultado dentro del arreglo será un objeto <code>stdClass</code> de PHP, permitiendo que accedas a los valores de los resultados:</p> <div class="language-php extra-class"><pre v-pre class="language-php"><code><span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$users</span> <span class="token keyword">as</span> <span class="token variable">$user</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">echo</span> <span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">name</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="usando-enlaces-nombrados"><a class="header-anchor" href="#usando-enlaces-nombrados" aria-hidden="true">#</a> Usando Enlaces Nombrados</h4> <p>En lugar de usar <code>?</code> para representar tus enlaces (bindings) de parámetros, puedes ejecutar una consulta usando enlaces nombrados:</p> <div class="language-php extra-class"><pre v-pre class="language-php"><code><span class="token variable">$results</span> <span class="token operator">=</span> <span class="token constant">DB</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'select * from users where id = :id'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token single-quoted-string string">'id'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="ejecutando-una-instruccion-insert"><a class="header-anchor" href="#ejecutando-una-instruccion-insert" aria-hidden="true">#</a> Ejecutando una Instrucción Insert</h4> <p>Para ejecutar una instrucción <code>insert</code>, puedes usar el método <code>insert</code> en la clase facade <code>DB</code>. Igual que <code>select</code>, este método toma la consulta SQL nativa como su argumento inicial y lo enlaza con su argumento secundario:</p> <div class="language-php extra-class"><pre v-pre class="language-php"><code><span class="token constant">DB</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'insert into users (id, name) values (?, ?)'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'Dayle'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="ejecutando-una-instruccion-update"><a class="header-anchor" href="#ejecutando-una-instruccion-update" aria-hidden="true">#</a> Ejecutando una Instrucción Update</h4> <p>El método <code>update</code> debería ser usado para actualizar los registros existentes en la base de datos. El número de filas afectadas por la instrucción serán devueltas:</p> <div class="language-php extra-class"><pre v-pre class="language-php"><code><span class="token variable">$affected</span> <span class="token operator">=</span> <span class="token constant">DB</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'update users set votes = 100 where name = ?'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token single-quoted-string string">'John'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="ejecutando-una-instruccion-delete"><a class="header-anchor" href="#ejecutando-una-instruccion-delete" aria-hidden="true">#</a> Ejecutando una Instrucción Delete</h4> <p>El método <code>delete</code> debería ser usado para eliminar registros de la base de datos. Al igual que <code>update</code>, el número de filas afectadas será devuelto:</p> <div class="language-php extra-class"><pre v-pre class="language-php"><code><span class="token variable">$deleted</span> <span class="token operator">=</span> <span class="token constant">DB</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'delete from users'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="ejecutando-una-instruccion-general"><a class="header-anchor" href="#ejecutando-una-instruccion-general" aria-hidden="true">#</a> Ejecutando una Instrucción General</h4> <p>Algunas instrucciones de bases de datos no devuelven algún valor. Para estos tipos de operaciones, puedes usar el método <code>statement</code> en la clase facade <code>DB</code>:</p> <div class="language-php extra-class"><pre v-pre class="language-php"><code><span class="token constant">DB</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">statement</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'drop table users'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><a name="listening-for-query-events"></a></p> <h3 id="listeners-de-eventos-de-consultas"><a class="header-anchor" href="#listeners-de-eventos-de-consultas" aria-hidden="true">#</a> Listeners de Eventos de Consultas</h3> <p>Si prefieres recibir cada consulta SQL ejecutada por tu aplicación, puedes usar el método <code>listen</code>. Este método es útil para registrar consultas o depurar. Puedes registrar tus listeners de consultas en un <a href="/docs/%7B%7Bversion%7D%7D/providers">proveedor de servicio</a>:</p> <div class="language-php extra-class"><pre v-pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Providers</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Support<span class="token punctuation">\</span>Facades<span class="token punctuation">\</span>DB</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Support<span class="token punctuation">\</span>ServiceProvider</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">AppServiceProvider</span> <span class="token keyword">extends</span> <span class="token class-name">ServiceProvider</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * Inicializa cualquiera de los servicios de la aplicación.
    *
    * @return void
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">boot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token constant">DB</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$query</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// $query-&gt;sql</span>
            <span class="token comment">// $query-&gt;bindings</span>
            <span class="token comment">// $query-&gt;time</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
    * Registra el proveedor de servicio.
    *
    * @return void
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p><a name="database-transactions"></a></p> <h2 id="transacciones-de-bases-de-datos"><a class="header-anchor" href="#transacciones-de-bases-de-datos" aria-hidden="true">#</a> Transacciones de Bases de Datos</h2> <p>Puedes usar el método <code>transaction</code> en la clase facade <code>DB</code> para ejecutar un conjunto de operaciones dentro de una transacción de base de datos. Si un error de excepción es arrojado dentro del código <code>Closure</code> de la transacción, la transacción automáticamente terminará con un rollback. Si el código <code>Closure</code> se ejecuta correctamente, la transacción terminará automáticamente con un commit. No necesitas preocuparte por hacer rollback o commit manualmente mientras estés usando el método <code>transaction</code>:</p> <div class="language-php extra-class"><pre v-pre class="language-php"><code><span class="token constant">DB</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token constant">DB</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'users'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'votes'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token constant">DB</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'posts'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="manejando-deadlocks-bloqueo-mutuo"><a class="header-anchor" href="#manejando-deadlocks-bloqueo-mutuo" aria-hidden="true">#</a> Manejando Deadlocks (Bloqueo mutuo)</h4> <p>El método <code>transaction</code> acepta un segundo argumento opcional el cual define el número de veces que la ejecución de una transacción debería ser reintentada cuando un ocurra un deadlock. Una vez que estos intentos hayan sido completados sin éxito, un error de excepción será arrojado:</p> <div class="language-php extra-class"><pre v-pre class="language-php"><code><span class="token constant">DB</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token constant">DB</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'users'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'votes'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token constant">DB</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'posts'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="usando-transacciones-manualmente"><a class="header-anchor" href="#usando-transacciones-manualmente" aria-hidden="true">#</a> Usando Transacciones Manualmente</h4> <p>Si prefieres empezar una transacción manualmente y tener control total sobre rollbacks y commits, podrías usar el método <code>beginTransaction</code> de la clase facade <code>DB</code>:</p> <div class="language-php extra-class"><pre v-pre class="language-php"><code><span class="token constant">DB</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">beginTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Puedes hacer rollback de la transacción por medio del método <code>rollback</code>:</p> <div class="language-php extra-class"><pre v-pre class="language-php"><code><span class="token constant">DB</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">rollBack</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Finalmente, puedes confirmar una transacción por medio del método <code>commit</code>:</p> <div class="language-php extra-class"><pre v-pre class="language-php"><code><span class="token constant">DB</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>Los métodos de transacción del Facade <code>DB</code> controlan las transacciones para ambos backends de bases de datos del constructor de consultas <a href="/docs/%7B%7Bversion%7D%7D/queries">query builder</a> y el <a href="/docs/%7B%7Bversion%7D%7D/eloquent">ORM Eloquent</a>.</p></div></div></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/scheduling.html" class="prev">
          Programación de tareas
        </a></span> <span class="next"><a href="/queries.html">
          Base de datos: Constructor de Consultas (Query Builder)
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/app.bf22240a.js" defer></script><script src="/assets/js/24.534e59f1.js" defer></script>
  </body>
</html>
